(function(){var c={expand_tips:'展开<i class="icon-arrow-down"></i>',show_tips:'收起<i class="icon-arrow-up"></i>',underPoints:"您的积分不足",underStock:"库存不足",phoneIllegal:"请输入合法的联系电话",numOverflow:"当前兑换数量不足",numError:"兑换数量必须为数值类型",exchangeSuccess:"兑换成功",otherError:"网络异常，请稍候重试",notLogin:"未登录，请先登录",nameError:"收货人不能为空",phoneError:"请输入合法的联系电话",addressError:"收货地址不能为空",exchangeFail:"兑换失败",unshelve:"商品已下架",postError:"请求异常，请刷新重试",timeOut:"请求超时"};
var a={network:"gamehall.hasnetwork",alert:"gamehall.alert",logout:"gamehall.clearlogin",finish:"gamehall.finish",islogin:"gamehall.islogin",getPoint:"gamehall.daily.task",login:"gamehall.account",statis:"gamehall.sendstatis",welfare:"gamehall.welfare",boradcast:"gamehall.money.change"};
var b={locked:false,getUrlParam:function(d){var e=new RegExp("(^|&)"+d+"=([^&]*)(&|$)");var f=window.location.search.substr(1).match(e);if(f!=null){return unescape(f[2]);
}return null;},lazyLoad:function(e,d){var f={};var h=$(e).find('img[src$="blank.gif"],img[src$="blankAvator.gif"]'),g=function(k){var j=k.getAttribute("data-src");
f.__IMAGE_CACHE=f.__IMAGE_CACHE||{};if(!j){return;}if(!f.__IMAGE_CACHE[j]){var i=new Image();i.src=j;i.onload=function(){k.src=j;f.__IMAGE_CACHE[j]=true;
$(k).attr("data-src",j);i=null;};}else{k.src=j;$(k).attr("data-src",j);}};h.each(function(k,j){d?setTimeout(function(){g(j);},k*d):g(j);});},openPageByViewType:function(){$("body").delegate("[data-infpage]","click",function(){var g=$(this).attr("data-infpage").split(",");
if(!(window.gamehall||navigator.gamehall)){location.href=g[1];return;}var k=$(this).attr("data-type"),h=$(this).attr("data-viewType"),d=$(this).attr("data-source")||"",e=g[1],l=g[0];
var j={};j.args={},j.type="list";j.args.newArgs={viewType:h,param:{url:e,title:l,source:d}};var f=errCal=function(){},i=window.gamehall?window.gamehall:navigator.gamehall;
i.startlistactivity(f,errCal,JSON.stringify(j.args));});},onEventAction:function(f,e){if(window.gamehall){var d=window.gamehall.onEvent(f,JSON.stringify(e));
}else{if(f="gamehall.alert"){}}},getValueAction:function(f,e){if(window.gamehall){var d=window.gamehall.getValue(f,JSON.stringify(e));d=JSON.parse(d);return d;
}},expand:function(){$(".J-expand").click(function(){var d=$(this).html()==c.expand_tips?true:false;if(d){$(this).html(c.show_tips);$(".J_content").addClass("h-auto");
}else{$(this).html(c.expand_tips);$(".J_content").removeClass("h-auto");}});},scroll:function(){if($(".J_ac_anno").length){$(document).on({scroll:function(){d();
}});function d(){var f=$(".J_ac_anno").height(),g=window.scrollY;if(g>f){$(".J_ac_anno").addClass("ac-fixed");}else{$(".J_ac_anno").removeClass("ac-fixed");
}}}if($(".J_loadMore").length){var e=$(window).height();$(document).on({scroll:function(){var h=$(".J_loadMore").attr("data-hasnext");if(h=="false"||h==0){return;
}if(b.locked){return;}var i=document.body.clientHeight,f=document.documentElement.clientHeight,j=document.body.scrollTop;if(Math.abs(i-f)<j){var g=b.getValueAction(a.network,{});
if(g==false){b.onEventAction(a.alert,{alertStr:c.otherError});return;}b.getAjaxData();}}});}},moreWelfare:function(){$("#more").click(function(){b.onEventAction(a.welfare,{});
});},getAjaxData:function(){var k=$(".J_loadMore");k.removeClass("invisible");b.locked=true;var h=k.attr("data-ajaxurl"),g=parseInt(k.attr("data-curpage"),10);
var j=$("#coinList").length?true:false,i,e;var d=$("#playerList").length?true:false;var f=$("#goodsList").length?true:false;i={page:g+1,token:token,};if(j){i={page:g+1,token:token,uuid:uuid};
}if(f){i={page:g+1,token:token,puuid:b.getUrlParam("puuid"),sp:b.getUrlParam("sp"),uname:b.getUrlParam("uname")};}$.ajax({type:"POST",url:h,dataType:"json",data:i,success:function(o){b.locked=false;
var t;if(!o||(typeof o=="string")||!o.success){k.addClass("invisible");var l=c.postError;if(o&&o.msg){l=o.msg;}b.onEventAction(a.alert,{alertStr:l});return;
}var r=o.data;hasNext=r.hasNext,g=r.curPage,html="";if(j){e=$("#coinList");for(var p=0,q=r.list.length;p<q;p++){var m=r.list[p],s="",n="";if(m.status=="no"){n="即将生效";
}if(m.status=="available"){if(m.leftMount==0){n="已使用";s="disable";}else{n="可用"+m.leftMount;}}if(m.status=="outdate"){n="已过期";s="disable";}html+='<li class="'+s+'">									<div class="toLeft">										<span class="mount">'+m.chargeMount+'</span>										<span class="status">'+n+'</span>									</div>									<div class="toRright">										<span class="origion">'+m.origin+'</span>										<span class="riqi">'+m.startDate+"至"+m.endDate+"</span>									</div>								</li>";
}}if(d){e=$("#playerList");for(var p=0,q=r.list.length;p<q;p++){html+="<li class='tline'>"+r.list[p]["no"]+"."+r.list[p]["nickname"]+"</li>";}}if(f){e=$("#goodsList");
for(var p=0,q=r.list.length;p<q;p++){var m=r.list[p];html+='<li ">										<a data-type="0" data-viewtype="WebView" data-source="prizeexchange" data-infpage="'+m.title+","+m.redirectLink+'">											<div class="goods-list border-1px">												<img src="http://assets.gionee.com/apps/game/apkv1/pic/blank.gif" alt="" data-src="'+m.img+'">												<span class="consume-points">消耗积分：<em>'+m.consumePoints+'</em></span>												<span class="exchange-num">剩余数量：<em>'+m.remaindNum+"</em></span>											</div>										</a>								</li>";
}}setTimeout(function(){if(hasNext==0||hasNext=="false"){k.html('<span class="bottom">到底了，去其它页面看看吧</span>');}else{k.addClass("invisible");}e.append(html);
k.attr("data-hasnext",hasNext);k.attr("data-curpage",g);b.lazyLoad(e[0],100);},100);},error:function(){b.locked=false;k.addClass("invisible");}});},checkLoginStatus:function(){if(typeof isLogin=="undefined"){return;
}if(isLogin!=undefined&&isLogin=="false"){b.onEventAction(a.finish,{});b.onEventAction(a.logout,{});b.onEventAction(a.login,{});}},dialogShow:function(d){$("body").bind("touchmove",function(f){f.preventDefault();
},false);var e=(3-document.body.scrollTop)+"px";d.show().animate({display:"block",bottom:e,},300,function(){$(".J_dialog").removeClass("invisible");});
},dialogHide:function(e){$("body").unbind("touchmove");var d=e.height();e.animate({display:"block",bottom:-d,},300,function(){$(this).hide();$(".J_dialog").addClass("invisible");
});},pointExAcoin:function(){var e=$("#exAcoinBtn");if(!e[0]){return;}var i=b.getUrlParam("goodId"),g=b.getUrlParam("puuid"),d=b.getUrlParam("uname"),h=b.getUrlParam("sp"),f=e.attr("data-ajaxurl");
e.click(function(){var j=parseInt($("#canExchangeNums").html(),10),k=$("#num").val(),l=$(".J_loading");if(!$.isNumeric(k)){b.onEventAction(a.alert,{alertStr:c.numError});
return;}b.dialogShow(l);b.onEventAction(a.boradcast,{});var m={action:"exchange",object:"goods"+i};b.onEventAction(a.statis,m);$.ajax({type:"POST",url:f,dataType:"json",timeout:5000,data:{goodId:i,puuid:g,exchangeNums:k,uname:d,token:token,sp:h},success:function(p){var o;
if(!p||(typeof p=="string")||!p.success){b.dialogHide(l);var r=c.postError;if(p&&p.msg){r=p.msg;}b.onEventAction(a.alert,{alertStr:r});return;}var q=p.data;
if(q.isLogin!=undefined&&q.isLogin==false){b.onEventAction(a.finish,{});b.onEventAction(a.logout,{});b.onEventAction(a.login,{});return;}if(q.exchangeStatus){var n=q.exchangeStatus;
switch(parseInt(n,10)){case 1:o=c.exchangeSuccess;break;case 2:o=c.underPoints;break;case 3:o=c.exchangeFail;break;case 4:o=c.underStock;break;case 5:o=c.underStock;
break;case 6:o=c.unshelve;break;}}setTimeout(function(){b.onEventAction(a.alert,{alertStr:o});b.dialogHide(l);setTimeout(function(){if(parseInt(n,10)==6){location.href=q.url;
}else{location.reload();}},1500);},300);},error:function(o,p){b.dialogHide(l);var n=c.otherError;if(p=="timeout"){n=c.timeOut;}b.onEventAction(a.alert,{alertStr:n});
return;}});});$("#num").keypress(function(j){var k=j.which;if(k==46||(k>=48&&k<=57)){return true;}else{return false;}}).focus(function(){this.style.imeMode="disabled";
});},pointExEntity:function(){var f=$("#exEntityBtn");if(!f[0]){return;}var k=b.getUrlParam("goodId"),h=b.getUrlParam("puuid"),d=b.getUrlParam("uname"),g=f.attr("data-ajaxurl"),j=$(this).attr("data-ajaxUrl"),i=b.getUrlParam("sp"),e=$(".J_loading");
f.click(function(){var n=$("#name").val().trim(),m=$("#phone").val().trim(),l=$("#address").val().trim();if($.isEmptyObject(n)){b.onEventAction("gamehall.alert",{alertStr:c.nameError});
return;}var o=/^1[34578]{1}[0-9]{9}$/;if(!o.test(m)){b.onEventAction("gamehall.alert",{alertStr:c.phoneError});return;}if($.isEmptyObject(l)){b.onEventAction("gamehall.alert",{alertStr:c.addressError});
return;}b.dialogShow(e);b.onEventAction(a.boradcast,{});var p={action:"exchange",object:"goods"+k};b.onEventAction(a.statis,p);$.ajax({type:"POST",url:g,dataType:"json",timeout:5000,data:{goodId:k,puuid:h,uname:d,token:token,exchangeNums:1,receiverphone:m,receiver:n,address:l,sp:i},success:function(s){var r;
if(!s||(typeof s=="string")||!s.success){b.dialogHide(e);var u=c.postError;if(s&&s.msg){u=s.msg;}b.onEventAction(a.alert,{alertStr:u});return;}var t=s.data;
if(t.isLogin!=undefined&&t.isLogin==false){b.onEventAction(a.finish,{});b.onEventAction(a.logout,{});b.onEventAction(a.login,{});return;}if(t.exchangeStatus){var q=t.exchangeStatus;
switch(parseInt(q,10)){case 1:r=c.exchangeSuccess;break;case 2:r=c.underPoints;break;case 3:r=c.exchangeFail;break;case 4:r=c.underStock;break;case 5:r=c.underStock;
break;case 6:r=c.unshelve;break;}}setTimeout(function(){b.onEventAction(a.alert,{alertStr:r});b.dialogHide(e);setTimeout(function(){if(parseInt(q,10)==6){location.href=t.url;
}else{location.reload();}},1500);},300);},error:function(r,s){b.dialogHide(e);var q=c.otherError;if(s=="timeout"){q=c.timeOut;}b.onEventAction(a.alert,{alertStr:q});
return;}});});},setDialogHeight:function(){if($("#myAcoin").length>0){return;}$(".J_dialog").height($(document).height());var f=[".J_loading"];for(var e=0,d=f.length;
e<d;e++){var g=$(f[e]);g.css("bottom",-g.height());g.removeClass("invisible").hide();}},init:function(){this.checkLoginStatus();this.pointExAcoin();this.pointExEntity();
this.setDialogHeight();this.scroll();this.openPageByViewType();this.expand();this.moreWelfare();this.lazyLoad(document.body,100);}};$(function(){b.init();
FastClick.attach(document.body);});})();