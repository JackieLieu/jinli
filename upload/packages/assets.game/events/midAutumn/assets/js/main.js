(function(){function d(){return !!document.createElement("canvas").getContext;}function b(){var f=$("script[data-main]")[0],h=f.hasAttribute?f.src:f.getAttribute("src",4);var g=h.replace(/assets\/js\/.*/g,"pic");return g;}if(hasChance&&parseInt(WinCheck,10)>0){$("#getPrize").click(function(){$(".J_mask").removeClass("hidden");$("#submit").click(function(){var g=$(".telephone").val().trim();var h=/^1[34578]{1}[0-9]{9}$/;if(!h.test(g)){$(".mask-content").addClass("error");return false;}else{$(".mask-content").removeClass("error");$(".telephone").focus();var f=$(this).attr("data-ajaxUrl");$.ajax({type:"POST",url:f,data:{mobile:g,name:$(".username").val().trim(),prize:WinCheck,token:token,sign:sign,ret_id:ret_id},dataType:"json",complete:function(i){e();$(".J_mask").addClass("hidden");$("#getPrize").unbind("click");}});}});});}function e(){var f=$(".share").attr("href");window.location.href=f;}$("#shareToHer").click(function(){e();});showAlert=true;perctenge=50;showLog=true;logPerct=30;function c(g){var h=(this.fullAmount(32)*100)|0;if(h>=logPerct){if(showLog==true){var f=$("#Scratch_Holder").attr("data-href");$.post(f,{prize:WinCheck,token:token,sign:sign,ret_id:ret_id},function(i){ret_id=i.data.ret_id;});showLog=false;}}if(h>=perctenge){if(showAlert==true){if(hasChance){if(parseInt(WinCheck,10)>0){$("#shareToHer").addClass("hidden");$("#getPrize").removeClass("hidden");}else{$("#shareToHer").removeClass("invisible");$("#getPrize").addClass("hidden");}}showAlert=false;}}$("#scraPercent").html(""+h+"%");}function a(){if(!hasChance){$(".J_prizetips").css("display","none");$("#scratcher").css("display","none");$(".chance-tips").removeClass("hidden");$("#shareToHer").removeClass("invisible");return false;}var j="scratcher",i=b(),h=i+"/top.png",f;switch(WinCheck.toString()){case"0":f=i+"/bottom-none.png";break;case"1":f=i+"/bottom-full.png";break;case"2":f=i+"/bottom-half.png";break;case"3":f=i+"/bottom-quarter.png";break;default:f=i+"/bottom-none.png";}scratcher=new Scratcher(j,f,h);function g(k){scratcher.reset();scratcher.addEventListener("scratch",c);}scratcher.addEventListener("imagesloaded",g);}$(function(){if(d()){a();}else{$("#scratcher-box").hide();alert("浏览器不支持canvas！");}});})();