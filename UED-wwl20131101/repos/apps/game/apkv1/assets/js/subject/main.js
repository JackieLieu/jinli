var action={network:"gamehall.hasnetwork",alert:"gamehall.alert",listener:"gamehall.gamestatus.listener",getGameStatus:"gamehall.getGameStatus",startDownLoad:"gamehall.startDownload",pauseDownLoad:"gamehall.pauseDownload",resumeDownLoad:"gamehall.resumeDownload",openGame:"gamehall.openGame",upgradeGame:"gamehall.upgrade",installGame:"gamehall.installGame",statusChange:"gamehall.gameStatusChange",finish:"gamehall.finish",startRewardDownload:"gamehall.startRewardDownload",};
var gameStatus={100:"J_download_start,下载,"+action.startDownLoad,102:"J_download_resume,继续,"+action.resumeDownLoad,101:"J_download_pause,暂停,"+action.pauseDownLoad,103:"J_download_installing,安装中,",104:"J_download_install,安装,"+action.installGame,105:"J_download_open,打开,"+action.openGame,106:"J_download_upgrade,升级,"+action.startDownLoad,107:"J_download_fail,重试,"+action.resumeDownLoad,108:"hidden,,",109:"J_download_reward,有奖下载,"+action.startRewardDownload,110:"J_download_rewardUpgrade,有奖升级,"+action.startRewardDownload,111:"J_remove,,",};
var subject={gameList:{},lazyload:function(b,a){var d=$(b).find('img[src$="blank.gif"]'),c=function(h){var g=h.getAttribute("data-src");var f={};f.__IMAGE_CACHE=f.__IMAGE_CACHE||{};
if(!g){return;}if(!f.__IMAGE_CACHE[g]){var e=new Image();e.src=g;e.onload=function(){h.src=g;f.__IMAGE_CACHE[g]=true;$(h).attr("data-src",g);e=null;};}else{h.src=g;
$(h).attr("data-src",g);}};d.each(function(f,e){a?setTimeout(function(){c(e);},f*a):c(e);});},getUrlParam:function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)");
var c=window.location.search.substr(1).match(b);if(c!=null){return unescape(c[2]);}return null;},skipPage:function(){$("body").delegate(".J_subjectDetail","click",function(){var b=$(this).attr("data-type"),e=$(this).attr("data-subjectid"),a=$(this).attr("data-url"),d=$(this).attr("data-title"),c=$(this).attr("data-source");
viewType=b=="custom"?"WebView":"TopicDetailView";subject.openPage(0,viewType,e,"",d,a,c);if(b=="custom"){subject.onEventAction(action.finish,{});}});$("body").delegate(".J_gotoDetail","click",function(){var a=$(this).siblings(".J_btn"),c=a.attr("data-source"),e=subject.getUrlParam("id"),d=a.attr("data-name"),b=a.attr("data-gameId");
subject.openPage(1,"GameDetailView",e,b,d,"",c);});},openPage:function(e,a,h,d,g,c,f){var b={};b.args={};if(a=="GameDetailView"){if(f==""){f="gltj"+h;}}b.args.newArgs={viewType:a,param:{contentId:h,gameId:d,url:a=="WebView"?c:"",title:a=="WebView"?g:"",source:f}};
if(e==0){b.type="list";}else{if(e==1||e==2){b.type="detail";}else{if(e==3){b={};b.type="browser";b.args={url:e==-1?g:c};}}}this.startActivity(b);},startActivity:function(a){var d=errCal=function(){},c=window.gamehall?window.gamehall:navigator.gamehall,b=JSON.stringify(a.args);
switch(a.type){case"list":c.startlistactivity(d,errCal,b);break;case"detail":c.startdetailsactivity(d,errCal,b);break;case"browser":c.startlocalbrowser(d,errCal,b);
break;}},onEventAction:function(b,a){if(window.gamehall){window.gamehall.onEvent(b,JSON.stringify(a));}},getValueAction:function(c,b){if(window.gamehall){var a=window.gamehall.getValue(c,JSON.stringify(b));
a=JSON.parse(a);return a;}},addListener:function(){this.onEventAction(action.listener,{});$("body").delegate(".J_btn[data-action]","click",function(){var e=$(this).attr("data-action"),c=$(this).attr("data-gameId"),f={};
f.list=[];if(e!=undefined&&e!=""){var d=subject.gameList.list;for(var b=0,a=d.length;b<a;b++){if(c==d[b].gameId){f.list.push(d[b]);break;}}subject.onEventAction(e,f);
}});},getGameInfoFromPage:function(){var a=$(".J_btn"),c=[],b={};a.each(function(l,g){var m=$(this).attr("data-gameId"),j=$(this).attr("data-gameName"),e=$(this).attr("data-source"),i=$(this).attr("data-downUrl"),f=$(this).attr("data-packageName"),h=$(this).attr("data-gameSize"),d=$(this).attr("data-iconUrl"),k=$(this).attr("data-freedl");
c[l]={};c[l].gameId=m;c[l].gameName=j;c[l].source=e;c[l].downUrl=i;c[l].packageName=f;c[l].gameSize=h;c[l].iconUrl=d;c[l].freedl=k;if($(this).attr("data-reward")){c[l].reward={};
c[l].reward.rewardTypeCount=$(this).attr("data-rewardTypeCount");c[l].reward.remindDes=$(this).attr("data-remindDes");c[l].reward.rewardStatisId=$(this).attr("data-rewardStatisId");
console.log(c[l]);}});b.list=c;this.gameList=b;},getGameStatusFromClient:function(){var a=this.getValueAction(action.getGameStatus,this.gameList);this.setGameStatus(a);
},setGameStatus:function(k){if(!k){return;}var f=k.list;for(var c=0,e=f.length;c<e;c++){var d=$(".J_btn[data-packageName='"+f[c].packageName+"']");if(!d.length){continue;
}var a=gameStatus[f[c].status].split(",");var g=a[0],j=a[1],b=a[2];if(g=="J_remove"){d.parent("li.single").remove();var h=d.parent("div.game-list");if(h.siblings("div.game-list").length==0){h.parent("li.multiple").remove();
}else{h.remove();}}else{d.attr("class","J_btn btn "+g);d.html(j);if(b){d.attr("data-action",b);}else{d.removeAttr("data-action");}}}},init:function(){this.addListener();
this.lazyload(document.body,100);this.skipPage();this.getGameInfoFromPage();this.getGameStatusFromClient();}};$(function(){subject.init();});