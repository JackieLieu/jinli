(function(){var b={loginFirst:"请先登录",answeringFinish:"今天题目已答完",hasAnswering:"亲，这道题已经答过了哦",networkError:"网络异常，请稍候重试"};var a={ajaxUrl:$("body").attr("data-ajaxurl"),loginUrl:$("body").attr("data-href"),uid:$(".nickname").attr("data-uid")?$(".nickname").attr("data-uid"):"",startAnswering:function(){var c=$(".J_next"),d=$(".J_subject"),e="";d.find("span[data-answer]").click(function(){e=$(this).attr("data-answer");a.getData(e);});c.click(function(){e="";a.getData(e,-1,"");});$("#J_help").click(function(){$(".J_questionBank").addClass("hidden");$(".J_help").removeClass("hidden");$(".J_close").click(function(){$(".J_questionBank").removeClass("hidden");$(".J_help").addClass("hidden");});});},getData:function(f){var e=$(".J_subject").attr("data-id")?$(".J_subject").attr("data-id"):-1,d=$(".J_subject").attr("data-number")?$(".J_subject").attr("data-number"):"",c=$("body").attr("data-sign")?$("body").attr("data-sign"):"";e=arguments[1]!=undefined?arguments[1]:e;d=arguments[2]!=undefined?arguments[2]:d;$.ajax({url:a.ajaxUrl,timeout:8000,dataType:"json",type:"POST",data:{id:e,number:d,uname:a.uid,daan:f,sign:c,token:token},success:function(i){var h=i.success;var i=i.data;if(i.score!=undefined){$("#points").html(i.score);}if(i.sign!=undefined){$("body").attr("data-sign",i.sign);}if((h!=undefined&&h==false)||(i.isLogin&&i.isLogin==-1)){a.showTip(b.loginFirst);location.href=a.loginUrl;return false;}if(i.end!=undefined&&i.end==-1){$(".quizContainer").empty().html('<div class="acFinish "><h1>活动已结束</h1>本次活动已结束，谢谢您的参与。</div>');}if(i.hasChance!=undefined&&i.hasChance=="false"){a.showTip(b.answeringFinish);$(".J_begin").addClass("hidden");$(".J_questionBank").removeClass("hidden");$(".bankArea").addClass("hidden");$(".J_finishContainter").removeClass("hidden");if(e!=-1){a.getRankData();}return false;}if(i.status!=undefined&&i.status==2){a.showTip(b.hasAnswering);a.getData("",-1,"");return false;}else{if(i.daan){$("span[data-answer="+i.daan+"]").addClass("right");$("span[data-answer="+f+"]").addClass("wrong");$(".J_subject").find("span[data-answer]").unbind("click");$(".J_next").removeClass("hidden");}else{$(".J_subject").attr("data-id",i.id).attr("data-number",i.number);$("span[data-answer]").removeClass("right").removeClass("wrong");$(".J_next").addClass("hidden");var g="问题"+i.number+":"+i.title;$(".J_title").html(g);$(".J_answerA").html("A:"+i.wenti.A);$(".J_answerB").html("B:"+i.wenti.B);$(".J_answerC").html("C:"+i.wenti.C);$(".J_answerD").html("D:"+i.wenti.D);$(".J_begin").addClass("hidden");$(".J_questionBank").removeClass("hidden");$("span[data-answer]").unbind("click");$("span[data-answer]").bind("click",function(){f=$(this).attr("data-answer");a.getData(f);});}}},error:function(){a.showTip(b.networkError);return false;}});},showTip:function(f){var e=$(".J_tipBox"),d=$(document).width(),g=e.width();e.find("p").html(f);var c=f.length*6;e.css("left",((d-g)/2-c)+"px").removeClass("hidden");setTimeout(function(){e.addClass("hidden");e.find("p").html("");},1000);},getRankData:function(){var c=$(".J_rank").attr("data-ajaxurl");$.ajax({url:c,dataType:"json",type:"POST",timeout:8000,data:{token:token},success:function(j){var j=j.data;var g=$("ul.list").find(".first")[0].outerHTML;for(var f=0,e=j.length;f<e;f++){var h=f+1;g+="<li><span class='rank'>TOP"+h+"</span><span class='telephone'>"+j[f].uname+"</span><span class='points'>"+j[f].score+"</span></li>";$("ul.list").html(g);}},error:function(){a.showTip(b.networkError);return false;}});},init:function(){this.startAnswering();}};$(function(){a.init();});})();