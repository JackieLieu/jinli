(function(a,c){function b(){this.sHtml='<div class="popWrap msgMode hide" style="opacity:0;left:'+this.getPos().left+"px;top:"+this.getPos().top+'px;"></div>';this.wrap=c("#page");}b.prototype={construtor:b,templete:function(){c("#page").append(this.sHtml);},message:function(h,f){var g=c(".msgMode");if(!c("#page").find(".msgMode")[0]){this.templete();}c(".msgMode").html(h);c(".msgMode").removeClass("hide").addClass("show").animate({opacity:1},300,"linear");if(c(".msgMode").hasClass("show")){setTimeout(function(){c(".msgMode").animate({opacity:0},300,"linear",function(){c(".msgMode").removeClass("show").addClass("hide");});},1500);}return f;},getPos:function(){var f=c(window).width(),g=c(window).height();return{left:f/2-80,top:g-100};}};var d=new b();var e={order:{createdOrder:"订单已生成！",cneeInfoNull:"请完善收货人信息！",stopBuyTips:"您已经购买过了，此商品每人限购1个，再看看其他的吧。",cneeNameNull:"请填写收货人！",cneePhoneNull:"请填写联系方式！",cneeAddressNull:"请填写收货地址！",cneePostCodeNull:"请填写邮政编码！",cneeProvinceNull:"请选择省份！",cneeCityNull:"请选择城市！",accountUmidNull:"请输入帐号！",accountUnameNull:"请输入姓名！",phoneNull:"请填写您的充值号码",phoneNotConfirm:"两次输入不一致"},GOU_tips1:"商品加入心愿清单了！",GOU_tips2:"心愿清单中已有些商品。",GOU_tips3:"此商品每人限购一件哦！",GOU_tips4:"活动结束",GOU_tips5:"您已领取过，下次再来！",GOU_tips6:"请勿重复操作！",GOU_tips7:"服务器繁忙,请稍后重试！",GOU_tips8:"已到最后一页",GOU_tips9:"请勿频繁操作！",GOU_tips10:"反馈内容超过500字！",GOU_error1:"请填写正确的邮政编码！",GOU_error2:"请填写正确的11位手机号！",noLoginTip:"请登录!",feedbackNull:"内容不能为空！",resendInfo:"请勿重复提交！",realnameNull:"姓名不能为空！",bornDateNull:"请选择出生年月日！",};a.app("GOU",function(){return{version:"0.9.3",isLogin:false,currTime:0};});a.mix(GOU,{init:function(){this.slidePic();this.saveForm();this.orderList();this.morder();this.countdown();sessionStorage.setItem("curpage",location.href);var f=location.protocol+"//"+location.host;if(c("html").attr("manifest")){c("body").delegate("a","click",function(g){g.preventDefault();if(!this.getAttribute("data-ajaxUrl")){location.href=!navigator.onLine?f+"/offline":this.href;}});}(function(){function h(){var k=0,j=setInterval(function(){k++;if(k<=5){c(".goto-rule a").toggleClass("active");}else{clearInterval(j);}},600);}h();var g=0,i=setInterval(function(){g++;g==3?clearInterval(i):h();},5000);})();(function(){var g=c("input");g.focus(function(){c(document.body).css("padding-bottom","100px");}).blur(function(){c(document.body).css("padding-bottom","0");});})();},slidePic:function(){var f=c(".J_slide, .J_quickLinks");if(!f[0]){return;}a.incfile(["/zepto/touchSwipe.js","../slidePic.js"],function(){f.slidePic(f.hasClass("J_slide")?{circle:true,auto:true,disableFirst:true,disableLast:true}:{slidePanel:".slideWrap",slideItem:".slideWrap ul",prev:".J_quickLinks .prev",next:".J_quickLinks .next",speed:400});},true);},countdown:function(){if(c(".J_countDown")[0]){a.incfile([a.appRef+"/super/assets/js/countDown.js"],function(){c(".J_countDown").countDown({startHandle:function(f){c(".J_countDown").eq(f).parent("li").hide();},endHandle:function(f){c(".J_countDown").eq(f).parent().find(".button .btn").remove();c(".J_countDown").eq(f).parent().find(".button").html('<span class="btn gray-arrow">'+e.gng_tips4+"</span>");}});});}},checkForm:function(){var g={realname:c("input[name=realname]"),byear:c("select[name=year]"),bmonth:c("select[name=month]"),bday:c("select[name=day]"),};var f=null;if(g.realname&&g.realname.val()==""){return d.message(e.realnameNull,false);}if(g.byear&&g.byear.val()==0){return d.message(e.bornDateNull,false);}if(g.bmonth&&g.bmonth.val()==0){return d.message(e.bornDateNull,false);}if(g.bday&&g.bday.val()==0){return d.message(e.bornDateNull,false);}return true;},saveForm:function(){c("#J_saveForm").on("submit",function(f){f.preventDefault();if(!GOU.checkForm()){return false;}var i=c(this),g=i.attr("action");var h=i.serialize();a.mix(h,{token:token});i.addClass("required");if(i.hasClass("required")){c.post(g,h,function(j){if(j.success==false){i.removeClass("required");return d.message(j.msg,false);}else{if(d.message(j.msg,true)){if(j.data.type=="redirect"&&j.data.url){setTimeout(function(){window.location.href=j.data.url;},2000);}}}},"json");}});},orderList:function(){if(!c("#J_createOrder")[0]){return;}var n=c(".quantity"),j,t=c(".subtotal"),s,f=c(".total-price"),v,k=c(".maxLimitNum"),g,p=c(".coinNum"),o,m=c(".subcointotal"),r,u=c(".maxCoinLimit"),h,l=[],i=[],q="元";g=+k.text();j=+n.val();o=p.val();r=m.html().match(/\d+.\d+/ig)[0];h=u.html()==null?0:+u.html().match(/\d+.\d+/ig)[0];s=+t.html().match(/\d+.\d+/ig)[0];v=+f.html().match(/\d+.\d+/ig)[0];i.push(j);i.push(s);i.push(o);i.push(r);i.push(v);c(".quantity").bind("keypress",function(w){return w.keyCode>=48&&w.keyCode<=57;});n.bind("change",function(){if(n.val()>g){n.val(g);}if(n.val()==""||n.val()<1){n.val(i[0]);p.val(i[2]);}else{}console.log(n.val());s=parseInt(n.val())*i[1];t.html(s.toFixed(2)+q);o=parseInt(n.val())*i[2];if(o>h){o=h;}p.val(o.toFixed(2));m.html("-"+o.toFixed(2)+q);f.html((s-o).toFixed(2)+q);});p.bind("change",function(){if(p.val()>h){p.val(h);}if(p.val()==""){p.val(0);}r=parseInt(p.val());var w=parseInt(n.val())*i[2];if(r>w&&w<h){r=w;p.val(w);}m.html("-"+r.toFixed(2)+q);f.html((s-r).toFixed(2)+q);});},morder:function(){var g=c(".coinNum");var l=c("#goods_id");var k=c("#address_id");var j=c(".quantity");var m=new b();var i=c(".J_leaveMsg");var f=c(".J_phonePay");var h=c(".J_phonePay_again");c("#J_createOrder").bind("click",function(n){var q=c(this),o=q.attr("data-ajaxUrl"),p={token:token,number:j.val(),silver_coin:g.val(),goods_id:l.val(),address_id:k.val()};if(k.val()==""){return m.message(e.order.cneeInfoNull,false);}if(f[0]){if(f.val()==""){return m.message(e.order.phoneNull,false);}if(f.val()!==h.val()){return m.message(e.order.phoneNotConfirm,false);}}a.mix(p,!i[0]?{phone:f.val(),phone_conf:h.val()}:{gbook:i.val()});q.addClass("hadsend");c.post(o,p,function(s){var r=s;if(r.success){m.message(r.msg,true);if(r.data.url){setTimeout(function(){c(".msgMode").hide();window.location.href=r.data.url;},1000);}}else{q.removeClass("hadsend");return m.message(r.msg,false);}},"json");});c("#J_checkForm").bind("submit",function(n){n.preventDefault();});c("#J_getCoinLink").bind("click",function(n){n.preventDefault();var p=c(this),o=p.attr("data-ajaxUrl");c.getJSON(o,function(q){if(q.success){p.addClass("requested");if(q.data.type=="redirect"&&q.data.url){window.location.href=q.data.url;}else{return m.message(q.msg,true);}}else{return m.message(q.msg,false);}});});}});c(function(){GOU.init();c("input,select").on("click",function(){var f=Math.floor(c(this).offset().top);setTimeout(function(){window.scrollTo(0,f);},100);});});})(ICAT,Zepto);