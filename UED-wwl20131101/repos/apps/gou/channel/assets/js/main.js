(function(a){a.app("Gou",function(){a.PathConfig();return{version:"0.9.6",platform:function(){var c=location.host,b;if(/channel\./i.test(c)){b={prefix:"channel_"};}else{if(/market\./i.test(c)){b={prefix:"market_"};}else{if(/ios\./i.test(c)){b={prefix:"ios_",head:"header, ",layout:"header#iHeader.hd + div#iScroll"};}else{b={prefix:""};}}}return b;}()};});Gou.namespace("view","model","controller");a.mix(Gou,{init:function(){var b=a.Event,c=this,d=window.token||"";a.rentAjax($.ajax,{data:{token:d},success:function(){},error:function(){}});b.on(".J_unfoldWrap h2","@singleTap",c.unfold);b.on(".J_loadMore","@singleTap",c.loadmore);c.dialog().linkage().waterFall().scrollNav().refresh().scrollPic().lazyLoad(document.body,100);if(document.body.id==="prize"){b.on("#J_createLink button","@singleTap",function(){var e=$("#J_createLink input"),g=e.val(),f=e.attr("data-ajaxurl");if(!g){alert("手机号码不能为空！");return;}a.util.ajax({url:a.util.fullUrl(f,true),data:{phone:g},success:function(i){if(i.success){var h=i.data.url||i.data[0].ajax_url;$("#J_linkResult").removeClass("hidden").find("span").html(h);$(".share-list").hide();$(".bshare-custom").css("display","-webkit-box");bShare.addEntry({title:"#邀请好友送话费#",summary:"小伙伴们，点击下载购物大厅，从此免装淘宝天猫京东，购物更轻松，另有话费、实物多重大奖等你来拿！",url:h});}else{alert(i.msg);}}});});}},unfold:function(){var b=$(this),c=b.attr("data-ajaxUrl"),d=b.next(".desc"),e=d.find("ul");if(c&&!b.hasClass("done")){e.addClass("items-loading");a.util.ajax({url:a.util.fullUrl(c,true),success:function(f){if(f.success){a.util.render({tempId:$(".J_unfoldWrap script"),wrap:e,multiChild:true},f);e.removeClass("items-loading");if(f.data.hasnext==true&&!d.find(".J_loadMore")[0]){e.after('<div class="btn items J_loadMore"><span class="rount-rect gray">加载更多...</span></div>');}b.attr("data-hasnext",f.data.hasnext).attr("data-curpage",f.data.curpage);}}});b.addClass("done");}b.hasClass("up")?b.removeClass("up").addClass("down"):b.removeClass("down").addClass("up");d.toggleClass("hidden");},loadmore:function(){var b=$(this),h=b.prev("ul"),g,e,f;g=b.hasClass("items")?b.parent(".desc").prev("h2"):b;e=g.attr("data-ajaxurl");if(g.attr("data-hasnext")=="true"){var d=g.attr("data-curpage"),c=d?(e.indexOf("?")<0?"?":"&")+"page="+(parseInt(d)+1):"";b.removeClass("J_loadMore");h.addClass("items-loading");a.util.ajax({url:a.util.fullUrl(e+c,true),success:function(i){if(i.success){a.util.render({tempId:"templete",wrap:h,multiChild:true},i);b.addClass("J_loadMore");h.removeClass("items-loading");if(i.data.hasnext==false){b.remove();}g.attr("data-hasnext",i.data.hasnext).attr("data-curpage",i.data.curpage);}}});}},dialog:function(){var c=$(document).width(),f=$(document).height()+1000,e=$(".J_dialogBox"),b=e.width(),d=(c-b)/2;$(".J_showDialog").click(function(g){g.preventDefault();$("html").css("overflow","hidden");f=$(".J_showDialog").parent().hasClass("favor")?$(window).height():f;if(this.getAttribute("data-ajaxUrl")){var h=this.getAttribute("data-ajaxUrl");$.post(h,{token:token},function(i){var j=$.parseJSON(i);e.find("p").html(j.msg);if(j.success){e.find(".btn a").removeAttr("href");if($(".J_showDialog").parent().hasClass("favor")){$(".J_showDialog").addClass("selected");}}e.css("left",d+"px").show().find(".btn a").live("click",function(){$(".JS-dbMask").hide();e.hide();$("html").css("overflow","auto");});$(".JS-dbMask").height(f).show().live("click",function(){this.style.display="none";e.hide();$("html").css("overflow","auto");});});}else{e.css("left",d+"px").show().find(".btn span").live("click",function(){$(".JS-dbMask").hide();e.hide();$("html").css("overflow","auto");});$(".JS-dbMask").height(f).show().live("click",function(){this.style.display="none";e.hide();$("html").css("overflow","auto");});}});return this;},linkage:function(){var b=$(".J_areaWrap"),c=b.find("select");if(b[0]){a.include(["./plugin/dataArea.js","./plugin/linkage.js"],function(){a.widget.linkage({isArea:true,areaWrap:b,s1:c.eq(0),s2:c.eq(1),s3:c.eq(2),aNode:b.attr("old-aNode")||""});},true);}return this;},waterFall:function(){var c=$(".J_waterFall"),f=$(window),l=0,i=0,e,k=a.PathConfig.appRef.replace(/assets\/js\//g,"pic/blank.gif"),g=[];if(!c[0]){return this;}var d=c.find("li"),h=c.attr("data-ajaxUrl"),m=f.scrollTop(),b=function(s){if(!s.length){c.addClass("done");return;}var t=0;for(t;t<3;t++){var r=d.eq(t),n=r.height(),o=r.scrollTop(),p=f.scrollTop(),q=f.height();if(r[0]&&!c.hasClass("done")){if(n+o<p+q){j(r,s);}}}},j=function(n,o){n.append('<a href="'+o[0].url+'"><img src="'+k+'" data-src="'+o[0].img+'"><span>￥'+o[0].price+"</span></a>");a.util.lazyLoad(n[0]);o.shift();};$.ajax({type:"POST",timeout:10000,url:h,data:{token:token},cache:false,success:function(o){var n=JSON.parse(o);if(n.success){n.data.list.forEach(function(p,q){if(q<15){if(q%3==0){j(d.eq(0),[p]);}if((q-1)%3==0){j(d.eq(1),[p]);}if((q-2)%3==0){j(d.eq(2),[p]);}}else{g.push(p);}});if(g.length){f.scroll(function(){var p=this===window?document.body:this;l=p.scrollHeight;i=p.scrollTop;e=f.height();if(Math.abs(m-i)>40){m=i;b(g);}});}c.attr("data-hasnext",n.data.hasnext).attr("data-curpage",n.data.curpage);}},error:function(){}});return this;},scrollNav:function(){var b=$(".scroll-nav .wrap");if(!b[0]){return this;}var c=b.find("span").parent();b.scrollLeft(c.position().left);return this;},refresh:function(){var c=$(".J_refresh"),b=location.href;if(!c[0]){return this;}c.click(function(){location.href=b;});return this;},scrollPic:function(){var b=$(".J_scrollBanner"),c=b.find(".pic-box ul");if(!c[0]){return this;}if(c.find("img").length<=1){$(".handle").css("display","none");return this;}a.include(["lib/jquery/touchSwipe.js","./plugin/slidePic.js"],function(){b.slidePic({slidePanel:".pic-box>ul",slideItem:".pic-box>ul>li",auto:true,circle:true,isTouch:true});},true);return this;},lazyLoad:function(c,b){if(!c){return;}var e=c.querySelectorAll('img[src$="blank.gif"]'),d=function(h){var g=h.getAttribute("data-original");a.__IMAGE_CACHE=a.__IMAGE_CACHE||{};if(!g){return;}if(!a.__IMAGE_CACHE[g]){var f=new Image();f.src=g;f.onload=function(){if($(h).hasClass("lazy")){$(h).css("width","auto");}h.src=g;a.__IMAGE_CACHE[g]=true;f=null;};}else{h.src=g;}};a.foreach(e,function(g,f){b?setTimeout(function(){d(f);},g*b):d(f);});},});a.include("lib/jquery/jquery.js",function(){a.require({modName:"appMVC"});Gou.init();},true,false);})(ICAT);