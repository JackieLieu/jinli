(function(a,b){var c={order:{createdOrder:"\u8ba2\u5355\u5df2\u751f\u6210\uff01",cneeInfoNull:"\u8bf7\u5b8c\u5584\u6536\u8d27\u4eba\u4fe1\u606f\uff01",stopBuyTips:"\u60a8\u5df2\u7ecf\u8d2d\u4e70\u8fc7\u4e86\uff0c\u6b64\u5546\u54c1\u6bcf\u4eba\u9650\u8d2d1\u4e2a\uff0c\u518d\u770b\u770b\u5176\u4ed6\u7684\u5427\u3002",cneeNameNull:"\u8bf7\u586b\u5199\u6536\u8d27\u4eba\uff01",cneePhoneNull:"\u8bf7\u586b\u5199\u8054\u7cfb\u65b9\u5f0f\uff01",cneeAddressNull:"\u8bf7\u586b\u5199\u6536\u8d27\u5730\u5740\uff01",cneePostCodeNull:"\u8bf7\u586b\u5199\u90ae\u653f\u7f16\u7801\uff01",cneeProvinceNull:"\u8bf7\u9009\u62e9\u7701\u4efd\uff01",cneeCityNull:"\u8bf7\u9009\u62e9\u57ce\u5e02\uff01",accountUmidNull:"\u8bf7\u8f93\u5165\u5e10\u53f7\uff01",accountUnameNull:"\u8bf7\u8f93\u5165\u59d3\u540d\uff01"},gng_tips1:"\u5546\u54c1\u52a0\u5165\u5fc3\u613f\u6e05\u5355\u4e86\uff01",gng_tips2:"\u5fc3\u613f\u6e05\u5355\u4e2d\u5df2\u6709\u4e9b\u5546\u54c1\u3002",gng_tips3:"\u6b64\u5546\u54c1\u6bcf\u4eba\u9650\u8d2d\u4e00\u4ef6\u54e6\uff01",gng_tips4:"\u6d3b\u52a8\u7ed3\u675f",gng_tips5:"\u60a8\u5df2\u9886\u53d6\u8fc7\uff0c\u4e0b\u6b21\u518d\u6765\uff01",gng_tips6:"\u8bf7\u52ff\u91cd\u590d\u64cd\u4f5c\uff01",gng_tips7:"\u670d\u52a1\u5668\u7e41\u5fd9,\u8bf7\u7a0d\u540e\u91cd\u8bd5\uff01",gng_tips8:"\u5df2\u5230\u6700\u540e\u4e00\u9875",gng_tips9:"\u8bf7\u52ff\u9891\u7e41\u64cd\u4f5c\uff01",gng_tips10:"\u53cd\u9988\u5185\u5bb9\u8d85\u8fc7500\u5b57\uff01",gng_error1:"\u8bf7\u586b\u5199\u6b63\u786e\u7684\u90ae\u653f\u7f16\u7801\uff01",gng_error2:"\u8bf7\u586b\u5199\u6b63\u786e\u768411\u4f4d\u624b\u673a\u53f7\uff01",noLoginTip:"\u8bf7\u767b\u5f55!",feedbackNull:"\u5185\u5bb9\u4e0d\u80fd\u4e3a\u7a7a\uff01",resendInfo:"\u8bf7\u52ff\u91cd\u590d\u63d0\u4ea4\uff01"};b.fn.publ=function(r){var f=r||{},i=b.waterfall={},p=null;i.load_index=0;var q={column_width:200,column_count:0,column_className:"col",column_space:10,cell_selector:".cell",img_selector:"img",auto_imgHeight:true,fadein:true,fadein_speed:600,insert_type:1,getResource:function(s){}};q=b.extend(q,f);p=i.$container=b(this);i.$columns=l();e(b(this).find(q.cell_selector).remove(),false);i._scrollTimer2=null;b(window).bind("scroll",function(){clearTimeout(i._scrollTimer2);i._scrollTimer2=setTimeout(m,300)});i._scrollTimer3=null;b(window).bind("resize",function(){clearTimeout(i._scrollTimer3);i._scrollTimer3=setTimeout(d,300)});function l(){i.column_num=g();var t="";for(var s=0;s<i.column_num;s++){t+='<div><ul class="mod-item-list '+q.column_className+'"></ul></div>'}p.prepend(t);return b("."+q.column_className,p)}function g(){if(q.column_count>0){return q.column_count}var s=Math.floor((p.get(0).clientWidth)/(q.column_width+q.column_space));if(s<1){s=1}return s}function e(t,u){if(!b(t).length){return}var s=i.$columns;b(t).each(function(v){if(!q.auto_imgHeight||q.insert_type==2){if(q.insert_type==1){n(b(t).eq(v),q.fadein&&u)}else{if(q.insert_type==2){k(b(t).eq(v),v,q.fadein&&u)}}return true}if(b(this)[0].nodeName.toLowerCase()=="img"||b(this).find(q.img_selector).length>0){var w=new Image;var x=b(this)[0].nodeName.toLowerCase()=="img"?b(this).attr("src"):b(this).find(q.img_selector).attr("src");w.onload=function(){w.onreadystatechange=null;if(q.insert_type==1){n(b(t).eq(v),q.fadein&&u)}else{if(q.insert_type==2){k(b(t).eq(v),v,q.fadein&&u)}}w=null};w.onreadystatechange=function(){if(w.readyState=="complete"){w.onload=null;if(q.insert_type==1){n(b(t).eq(v),q.fadein&&u)}else{if(q.insert_type==2){k(b(t).eq(v),v,q.fadein&&u)}}w=null}};w.src=x}else{if(q.insert_type==1){n(b(t).eq(v),q.fadein&&u)}else{if(q.insert_type==2){k(b(t).eq(v),v,q.fadein&&u)}}}})}function h(s){e(s,true)}function n(s,t){if(t){s.css({opacity:0}).appendTo(i.$columns.eq(o())).animate({opacity:1},f.fadein_speed,"ease-in")}else{s.appendTo(i.$columns.eq(o()))}}function k(s,t,u){if(u){console.log(s);s.css({opacity:0}).appendTo(i.$columns.eq(t%i.column_num)).animate({opacity:1},f.fadein_speed,"ease-in")}else{s.appendTo(i.$columns.eq(t%i.column_num))}}function o(){var t=i.$columns.eq(0).height(),s=0;i.$columns.each(function(u){if(b(this).height()<t){t=b(this).height();s=u}});return s}function j(){b.waterfall.load_index++;return q.getResource(b.waterfall.load_index,h)}i._scrollTimer=null;function m(){clearTimeout(i._scrollTimer);i._scrollTimer=setTimeout(function(){var t=i.$columns.eq(o());var s=t.offset().top+t.height();var u=document.documentElement.scrollTop||document.body.scrollTop||0;var v=document.documentElement.clientHeight||document.body.clientHeight||0;if(u>=s-v){e(j(),true)}},100)}function d(){if(g()==i.column_num){return}var s=i.$container.find(q.cell_selector);i.$columns.remove();i.$columns=l();e(s,false)}};b.fn.scrollLoad=function(d){var f={currPage:0,ajaxUrl:"",token:token};var e=b.extend(f,d);var j=b(this);var i={};i.isGetData=false;i.curIndex=e.currPage;b(window).bind("scroll",function(){if(g()&&!i.isGetData){h(e.ajaxUrl)}});function h(k){b.ajax({url:k,type:"get",data:{token:e.token,page:i.curIndex+1},dataType:"json",beforeSend:function(){},success:function(l){if(l.success){i.curIndex=l.data.curpage;if(l.data.hasnext==false){i.isGetData=true}j.append(template("J_itemView",l))}}})}function g(){var m=0,l=0,k=0;if(document.documentElement&&document.documentElement.scrollTop){m=document.documentElement.scrollTop}else{if(document.body&&document.body.scrollTop){m=document.body.scrollTop}}if(document.body.clientHeight&&document.documentElement.clientHeight){k=(document.body.clientHeight<document.documentElement.clientHeight)?document.body.clientHeight:document.documentElement.clientHeight}else{k=(document.body.clientHeight>document.documentElement.clientHeight)?document.body.clientHeight:document.documentElement.clientHeight}l=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight);if(k+m==l){return true}else{return false}}};a.app("GNG",function(){return{version:"1.0",isLogin:false,currTime:0}});a.mix(GNG,{pop:{prompt:function(e,d){switch(d){case 0:window.prompt("['"+e+"']","gn://['GNAccount','getAccountInfo','1','false']");break;case 1:window.prompt("['"+e+"']","gn://['GNTips','GNTips','1','false']");break;case 2:window.prompt("['"+e+"']","gn://['GNPay','GNPay','1','false']");break}}}});a.mix(GNG,{init:function(){this._count();this.orderList();this.morder();this.slidePic();this.countdown();this.scrollLoad();this.publ()},_count:function(){var d=b("body").attr("dt-cr");if(d){b("a").click(function(e){e.preventDefault();var f=this.getAttribute("dt-labelCla")?"&tid="+this.getAttribute("dt-labelCla"):"";location.href=d+"?url="+encodeURIComponent(this.href)+f})}},checkLogin:function(){if(isLoginUrl=="undefined"){isLoginUrl=null}if(isLoginUrl){b.getJSON(isLoginUrl,function(d){if(!d.success){GNG.isLogin=false}else{GNG.isLogin=true}})}},checkForm:function(){var e={realname:b("input[name=realname]"),mobile:b("input[name=mobile]"),province:b("select[name=province]"),city:b("select[name=city]"),detail_address:b("input[name=detail_address]"),postcode:b("input[name=postcode]"),username:b("input[name=username]"),sex:b("input[name=sex]"),year:b("input[name=year]"),month:b("input[name=month]"),day:b("input[name=day]"),feedback:b("textarea[name=react]"),};var d=null;if(e.realname&&e.realname.val()==""){GNG.pop.prompt(c.order.cneeNameNull,1);return}if(e.username&&e.username.val()==""){GNG.pop.prompt(c.order.accountUnameNull,1);return}if(e.mobile&&e.mobile.val()==""){GNG.pop.prompt(c.order.cneePhoneNull,1);return}else{d=/^1[3|5|8][0-9]\d{8}$/ig;if(e.mobile.length&&d.test(e.mobile.val())==false){GNG.pop.prompt(c.gng_error2,1);return}}if(e.province&&e.province.val()=="\u8bf7\u9009\u62e9"){GNG.pop.prompt(c.order.cneeProvinceNull,1);return}if(e.city&&e.city.val()=="\u8bf7\u9009\u62e9"){GNG.pop.prompt(c.order.cneeCityNull,1);return}if(e.detail_address&&e.detail_address.val()==""){GNG.pop.prompt(c.order.cneeAddressNull,1);return}if(e.postcode&&e.postcode.val()==""){GNG.pop.prompt(c.order.cneePostCodeNull,1);return}else{d=/^\d{6}$/g;if(e.postcode.length&&d.test(e.postcode.val())==false){GNG.pop.prompt(c.gng_error1,1);return}}if(e.umid&&e.umid.val()==""){GNG.pop.prompt(c.order.accountUmidNull,1);return}if(e.feedback&&e.feedback.val()==""){GNG.pop.prompt(c.feedbackNull,1);return}if(e.feedback&&e.feedback.length!=0&&e.feedback.val().length>500){GNG.pop.prompt(c.gng_tips10,1);return}return true},slidePic:function(){if(!b(".mindex, .cate-detail nav, .J_slidePic")[0]){return}a.incfile(["/zepto/touchSwipe.js","../slidePic.source.js"],function(){b(".mindex").slidePic({circle:true,auto:true,disableFirst:true,disableLast:true});b(".J_slidePic").slidePic({slideWrap:".wrap",slidePanel:".pic",slideItem:".pic li"});b(".cate-detail nav .wrap").slidePic({slidePanel:".top-tags",slideItem:".top-tags li",prev:".cate-detail nav .prevBtn",next:".cate-detail nav .nextBtn",handleItem:"",disableFirst:true,disableLast:true,})})},scrollLoad:function(){if(!b(".lazyload")[0]){return}a.incfile("../tempcore.js",function(){var d=b(".lazyload").attr("data-ajaxUrl");b(".lazyload").scrollLoad({ajaxUrl:d,currPage:1})})},publ:function(){if(!b("#J_publWrap")[0]){return}var f=b("#J_publWrap").attr("data-ajaxUrl");var e=false;var d={page:1,getResource:function(g,h){if(!e){b.ajax({url:f,type:"get",dataType:"json",data:{page:g+1},success:function(m){if(m.success){if(m.data.hasnext==false){e=true}d.page=m.curpage;var l=m.data.list;for(var k=0,j=l.length;k<j;k++){h(template("J_itemView",{list:l[k]}))}}}})}else{GNG.pop.prompt(c.gng_tips8,1)}},auto_imgHeight:true,insert_type:1,cell_selector:"li",column_count:3};a.incfile("../tempcore.js",function(){b("#J_publWrap").publ(d)})},countdown:function(){if(b(".J_countDown")[0]){a.incfile(["../countDown.source.js"],function(){b(".J_countDown").countDown({startHandle:function(d){b(".J_countDown").eq(d).parent("li").hide()},endHandle:function(d){b(".J_countDown").eq(d).parent().find(".button .btn").remove();b(".J_countDown").eq(d).parent().find(".button").html('<span class="btn gray-arrow">'+c.gng_tips4+"</span>")}})})}},orderList:function(){if(!b("#J_createOrder")[0]){return}var l=b(".quantity"),h,r=b(".subtotal"),q,d=b(".total-price"),t,i=b(".maxLimitNum"),e,n=b(".coinNum"),m,k=b(".subcointotal"),p,s=b(".maxCoinLimit"),f,j=[],g=[],o="\u5143";e=+i.text();h=+l.val();m=n.val();p=k.html().match(/\d+.\d+/ig)[0];f=s.html()==null?0:+s.html().match(/\d+.\d+/ig)[0];q=+r.html().match(/\d+.\d+/ig)[0];t=+d.html().match(/\d+.\d+/ig)[0];g.push(h);g.push(q);g.push(m);g.push(p);g.push(t);b(".quantity").bind("keypress",function(u){return u.keyCode>=48&&u.keyCode<=57});l.bind("change",function(){if(l.val()>e){l.val(e)}if(l.val()==""||l.val()<1){l.val(g[0]);n.val(g[2])}else{}q=parseInt(l.val())*g[1];m=parseInt(l.val())*g[2];r.html(q.toFixed(2)+o);p=parseInt(n.val())*parseInt(l.val());if(p>f){m=f;p=f}n.val(m);k.html("-"+p.toFixed(2)+o);d.html((q-p).toFixed(2)+o)});n.bind("change",function(){if(n.val()>f){n.val(f)}if(n.val()==""){n.val(0)}p=parseInt(n.val());var u=parseInt(l.val())*g[2];if(p>u&&u<f){p=u;n.val(u)}k.html("-"+p.toFixed(2)+o);d.html((q-p).toFixed(2)+o)})},morder:function(){var d=b(".coinNum");var g=b("#goods_id");var f=b("#address_id");var e=b(".quantity");GNG.checkLogin();b("#J_createOrder").bind("click",function(i){if(GNG.isLogin==false){GNG.pop.prompt(location.href,0);return}var l=b(this),j=l.attr("data-ajaxUrl"),k={token:token,number:e.val(),silver_coin:d.val(),goods_id:g.val(),address_id:f.val()};if(f.val()==""){GNG.pop.prompt(c.order.cneeInfoNull,1);return}if(l.hasClass("disable")){GNG.pop.prompt(c.gng_tips9,1);return}l.addClass("disable").removeClass("orange");b.post(j,k,function(n){var m=n;if(m.success){GNG.pop.prompt(m.msg,1);if(m.data.iscash==2){GNG.pop.prompt(m.data.out_trade_no+"','"+m.data.url,2)}else{if(m.data.iscash==1){if(m.data.url){window.location.href=m.data.url}}else{}}}else{l.removeClass("disable").addClass("orange");GNG.pop.prompt(m.msg,1)}},"json")});b("#J_checkForm").bind("submit",function(i){i.preventDefault()});b("#J_saveForm").bind("click",function(i){i.preventDefault();if(!GNG.checkForm()){return false}if(b("#J_checkForm").attr("action")){var m=b(this),j=b("#J_checkForm"),k=j.attr("action");var l=j.serialize();if(m.hasClass("requested")){GNG.pop.prompt(c.gng_tips6,1);return}m.addClass("requested");b.post(k,l,function(o){var n=o;if(n.success){GNG.pop.prompt(n.msg,1);if(n.data.type=="redirect"&&n.data.url){window.location.href=n.data.url}if(n.data.feedback==1){b("textarea[name=react]").val("");m.removeClass("requested")}}else{m.removeClass("requested");GNG.pop.prompt(n.msg,1)}},"json")}});b(".J_cneeLink,.btn-buy").bind("click",function(i){if(GNG.isLogin==false){i.preventDefault();GNG.pop.prompt(location.href,0);return}});b("#J_goToPay").bind("click",function(i){var n=b(this);if(GNG.isLogin==false){i.preventDefault();GNG.pop.prompt(location.href,0);return}if(n.hasClass("required")){GNG.pop.prompt(c.gng_tips6,1);return}n.addClass("required");var m=b(".J_orderNo").attr("data-payUrl"),k=b(".J_orderNo").attr("data-tradeUrl"),j=b(".J_orderNo").attr("data-tradeNo");var l={trade_no:j,token:token};b.post(m,l,function(o){if(o.success){GNG.pop.prompt(j+"','"+k,2)}else{n.removeClass("required");GNG.pop.prompt(o.msg,1)}},"json")});b("#J_getCoinLink").bind("click",function(i){i.preventDefault();var k=b(this),j=k.attr("data-ajaxUrl");if(j&&k.hasClass("requested")){window.pop.prompt(c.gng_tips5,1);return}b.getJSON(j,function(l){if(l.success){k.addClass("requested");if(l.data.type=="redirect"&&l.data.url){GNG.pop.prompt(l.msg+"','"+l.data.url,1)}else{GNG.pop.prompt(l.msg,1)}}else{GNG.pop.prompt(l.msg,1)}})});if(b(".account .pindex")[0]){b(".pindex a").each(function(j){if(j==0||j==3||j==4){b(".pindex a").eq(j).bind("click",function(i){if(GNG.isLogin==false){i.preventDefault();GNG.pop.prompt(location.href,0);return}})}})}if(b(".J_selectProv")[0]){var h=[];if(b("#J_initProvVal")[0]){h=b("#J_initProvVal").val().split("-")}b(".J_selectProv").provCity({levelNum:2,defValue:h})}b(".J_WantBtn").bind("click",function(i){i.preventDefault();if(GNG.isLogin==false){GNG.pop.prompt(location.href,0);return}var k=b(".J_wantCount").html();if(b(this).attr("data-ajaxUrl")){var j=b(this).attr("data-ajaxUrl");b.getJSON(j,function(l){if(l.success){b(".J_wantCount").html(+k+1);GNG.pop.prompt(l.msg,1)}else{GNG.pop.prompt(l.msg,1)}})}})}});b(function(){GNG.init()})})(ICAT,Zepto);
