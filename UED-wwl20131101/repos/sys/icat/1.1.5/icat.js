/*!
 * Copyright 2011~2013, ICAT JavaScript Library v1.1.5
 * https://github.com/valleykid/icat
 *
 * Copyright (c) 2013 valleykid
 * Licensed under the MIT license.
 *
 * @Author valleykiddy@gmail.com
 * @Time 2013-06-02 09:00:00
 */
(function(){var b=this,e=document,a={version:"1.1.5"};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=a}exports.ICAT=a}else{b.ICAT=a}a.Shim=b.SHIM||{};a.$=b.jQuery||b.Zepto;a.embedjQuery=function(){var f=a.$,g=!!a.Event;if(!f){return}if(!(f.Event||f.event)){f.Event=function(h){return h};f.fn.bind=f.fn.on=function(h,i){if(g){a.Event.on(this,h,i)}};f.fn.unbind=f.fn.off=function(h){if(g){a.Event.off(this,h)}};f.fn.trigger=function(h,i){if(a.Event){a.Event.trigger(this,h)}}}};var d=Array.prototype;d.contains=function(f){return this.indexOf(f)<0?false:true};d.remove=function(g){var f=this;f.forEach(function(h,j){if(h===g){f.splice(j,1)}});return f};d.unique=function(){var f=this,h={},g=[];f.forEach(function(i){if(!h[i]){g.push(i);h[i]=true}});return g};["String","Boolean","Function","Array","Object"].forEach(function(f){a["is"+f]=function(g){if(f==="Array"&&Array.isArray){return Array.isArray(g)}return Object.prototype.toString.call(g)==="[object "+f+"]"}});a.isNull=function(f){return f===null};a.isNumber=function(f){return !/\D/.test(f)};a.isUndefined=function(f){return f===undefined};a.isjQueryObject=function(f){return !!a.$&&(!!f)&&a.isFunction(f.get)};a.isEmptyObject=function(g){for(var f in g){return false}return true};(function(){var g=location.href,h={DebugMode:/debug/i,DemoMode:/localhost|demo\.|\/{2}\d+(\.\d+){3}|file\:/i,IPMode:/\/{2}\d+(\.\d+){3}/};for(var f in h){a[f]=h[f].test(g)}})();(function(){var f=e.getElementsByTagName("script"),k=f[f.length-1],i=a.PathConfig={};var l=k.baseURI||e.baseURI||e.URL,h=k.getAttribute("refSlipt")||"";if(h&&l.indexOf(h)==-1){h=false}var j=a.DemoMode?(h?"("+h+"/).*":"(/)([\\w\\.]+)?\\?.*"):"(//[\\w\\.]+/).*",g=new RegExp(j,"g");l=(a.DemoMode&&!h)?l+"?":l;i.pageRef=l.replace(g,"$1");i.weinreRef=a.IPMode?l.replace(/(\d+(\.\d+){3}).*/g,"$1:8080/"):""})();a.mix=function(n,m,g,k){if(!m||!n){return n}if(a.isUndefined(k)){k=true}var j,o,f,h=true;if(g&&!Array.isArray(g)){g=g.replace(/\s+/g,"").split(",");h=false}if(g&&(f=g.length)){if(h){for(j=0;j<f;j++){o=g[j];if(o in m){if(k||!(o in n)){n[o]=m[o]}}}}else{for(o in m){if(g.indexOf(o)<0&&(k||!(o in n))){n[o]=m[o]}}}}else{for(o in m){if(k||!(o in n)){n[o]=m[o]}}}return n};a.mix(a,{contains:function(g,f){if(a.isArray(g)){return g.contains(f)}else{if(a.isObject(g)){return f in g}}return false},toArray:function(g){var f=[];a.foreach(g,function(j,h){f.push(h)});return f},foreach:function(m,f,j){var h,k=0,l=m.length,g=a.isUndefined(l)||a.isString(m)||a.isFunction(m);if(j){if(g){for(h in m){if(f.apply(m[h],j)===false){break}}}else{for(;k<l;){if(f.apply(m[k++],j)===false){break}}}}else{if(g){for(h in m){if(f.call(m[h],h,m[h])===false){break}}}else{for(;k<l;){if(f.call(m[k],k,m[k++])===false){break}}}}},Class:function(){var h=arguments,f=h.length,g,j,k,i;if(!f){return}g=h[1]||h[0];if(!a.isObject(g)){return}j=function(){if(g.Create){g.Create.apply(this,arguments)}};if(f>1){k=h[0];i=h[2]||b;if(!a.isString(k)){return}}a.mix(j.prototype,g,"Create");if(j.prototype.constructor==Object.prototype.constructor){j.prototype.constructor=j}return f===1?j:(i[k]=j)},widget:function(g,f){this.Class(g,f,a.widget)},util:function(f,g){if(a.isString(f)){a.util[f]=g}else{if(a.isFunction(f)){a.mix(a.util,f())}else{a.mix(a.util,f)}}},rentAjax:function(g,f){if(!g||!a.isFunction(g)){return function(){}}a.util.ajax=function(i){f=f||{};var h=a.mix({},i,"success, error");h=a.mix(h,f,"success, error",false);h.prevSuccess=f.success;h.nextSuccess=i.success;h.prevError=f.error;h.nextError=i.error;h.success=function(k){if(!k){return}k=a.isObject(k)||a.isArray(k)?k:JSON.parse(k);var j=h.prevSuccess?h.prevSuccess(k):"";if(h.nextSuccess){h.nextSuccess(j||k)}};h.error=function(){var j=h.prevError?h.prevError():"";if(h.nextError){h.nextError(j)}};g(h)}},namespace:function(){var g=arguments,f=g.length,n=null,k,h,m;for(k=0;k<f;++k){m=(""+g[k]).split(".");n=this;for(h=(b[m[0]]===n)?1:0;h<m.length;++h){n=n[m[h]]=n[m[h]]||{}}}return n},app:function(f,i){var g=a.isString(f),h=g?b[f]||{}:f;a.mix(h,a,["namespace"],true);a.mix(h,a.isFunction(i)?i():i);g&&(a.app[f]=b[f]=h);return h},log:function(h){if(e.all){b.console!==undefined&&console.log?console.log(h):alert(h)}else{try{__$abc_ICAT()}catch(g){var f=g.stack.replace(/\n\s+at\s+<.*>/g,"").split("\n")[2];f=f.replace(/.*[\(\s]|\).*/g,"").replace(/(.*):(\d+):\d+/g,"$1  line $2:\n");console.log(f,h)}}}});a.namespace("Once");var c=a.Shim.util||{};a.util({lazyLoad:function(g,f,h){if(!g){return}f=f||500;g=a.util.queryOne(g);h=h||'img[src$="blank.gif"]';setTimeout(function(){a.foreach(a.util.queryAll(h,g),function(i,m){var l=m.getAttribute("data-src");a.__cache_images=a.__cache_images||{};if(!l){return}if(!a.__cache_images[l]){var j=new Image();j.src=l;j.onload=function(){m.src=l;a.__cache_images[l]=true;j=null}}else{m.src=l}m.removeAttribute("data-src")})},f)},wait:function(l,h,k){h=h||100;k=k||1;var g=a.__cache_timers=a.__cache_timers||{};var f=0,j,i="icat_timer"+Math.floor(Math.random()*1000000+1);(j=function(){l(i,f);if(f<h&&g[i]===false){setTimeout(function(){f=f+k;j()},k)}})()},recurse:function(f,h){var g=function(j,i){while(j.length){if(i(j[0])===false){break}j.shift();g(j,i)}};a.isArray(f)?g(f.concat(),h):h(f)},fullUrl:function(h,f){var h=h||"",g=a.isString(f)?f:"",i=a.isBoolean(f)?f:false,j=/^\w+:\/\//.test(h);h=h.replace(/^\//g,"");if(a.DemoMode&&h!==""&&!j){h=/[\?#]/.test(h)?h.replace(/(\/\w+)([\?#])/g,"$1.php$2"):/(\.\w+)$/.test(h)?h:h.replace(/([^\.]\w+)$/g,"$1.php")}if(!i&&g){h=h+(h.indexOf("?")<0?"?":"&")+g.replace(/[\?&]+/g,"")}return(j?"":a.PathConfig.pageRef)+h},_jsonCompare:function(g,f){if(!g||!f){return false}var h=function(i){i=a.isString(i)?i:JSON.stringify(i);i=i.replace(/[\r\t\n\s'"]/g,"");return i};return h(g)===h(f)},_str2Hooks:function(i){if(!i){return[]}var g,f,h=[];g=i.match(/(\#[\w\-\d]+)|(\.[\w\-\d]+)/g);if(g!=null){g.forEach(function(j){/^\./.test(j)?h.push(j.substring(1)):(f=f||j.substring(1))})}return[f,h.unique()]},scroll:c.scroll||function(i,k){var h=a.isString(i)?a.util.queryOne(i,a.elCurWrap):i,j,g,f;if(!h){return}h=h.nodeType!==1?e.body:h;g=h.children;f=h===e.body;j=g[0];if(!h.bindScroll){(f?b:h).addEventListener("scroll",function(){var m=a.util.outerHeight(f?b:h),n=h.scrollTop,l=a.util.outerHeight(j);k(m,n,l)},false);h.bindScroll=true}}});a.util({_matches:c.matches||function(k,g){if(!k||!g){return false}if(k.nodeType!==1||k==e.body){return false}if(a.isjQueryObject(k)){return k.closest(g).length>0}else{var h=e.documentElement.webkitMatchesSelector;if(a.isString(g)){return h.call(k,g)}else{if(a.isArray(g)){for(var j=0,f=g.length;j<f;j++){if(h.call(k,g[j])){return j}}return false}}}},queryAll:c.queryAll||function(f,g){if(!f){return[]}return a.isString(f)?(g||a.elBodyWrap||e).querySelectorAll(f):f},queryOne:c.queryOne||function(f,g){if(a.isUndefined(f)){return}if(f===""){return a.elCurWrap}if(a.isString(f)){f=/\:[\d]+/.test(f)?f.replace(/(\:[\d]+).*/g,"$1").split(":"):[f];return a.util.queryAll(f[0],g)[f[1]||0]}else{return f}},addClass:function(g,h){if(!g){return}var f=g.className?g.className.split(/\s+/):[];if(!f.contains(h)){f.push(h)}g.className=f.join(" ")},removeClass:function(g,h){if(!g){return}var f=(g.className||"").split(/\s+/);if(f.contains(h)){f.remove(h)}g.className=f.join(" ")},hasClass:function(g,h){if(!g){return false}var f=(g.className||"").split(/\s+/);return f.contains(h.trim())}});a.util({storage:function(){if(!arguments.length||!b.localStorage||!b.sessionStorage){return}var f=b.localStorage,g=b.sessionStorage;if(arguments.length==1){var k=arguments[0];return a.isString(k)?(f.getItem(k)||g.getItem(k)):""}else{var k=arguments[0],i=arguments[1],j=arguments[2];if(a.isString(k)){var h=j?g:f;h.removeItem(k);h.setItem(k,a.isObject(i)?JSON.stringify(i):i)}}},clearStorage:function(h){if(!h||!b.localStorage||!b.sessionStorage){return}var f=b.localStorage,g=b.sessionStorage;if(h==f||h==g){h.clear()}else{if(f[h]){f.removeItem(h)}if(g[h]){g.removeItem(h)}}},cookie:function(){if(!arguments.length){return}if(arguments.length==1){var l=e.cookie;if(l.length<=0){return}var g=arguments[0],h=l.indexOf(g+"=");if(h!=-1){h=h+g.length+1;cEnd=l.indexOf(";",h);if(cEnd==-1){cEnd=l.length}return unescape(l.substring(h,cEnd))}}else{var g=arguments[0],k=arguments[1],j=arguments[2]||60,i=new Date(),f="";i.setTime(i.getTime()+(j*1000));f="; expires="+i.toGMTString();e.cookie=g+"="+escape(k)+f+"; path=/"}},clearCookie:function(f){a.View.cookie(f,"",-1)}});a.foreach({Height:"height",Width:"width"},function(f,g){a.foreach({padding:"inner"+f,content:g,"":"outer"+f},function(h,i){a.util[i]=function(j){if(!j){return 0}return(function(l,k){var m;if(l===b){return l.document.documentElement["client"+f]}if(l.nodeType===9){m=l.documentElement;return Math.max(l.body["scroll"+f],m["scroll"+f],l.body["offset"+f],m["offset"+f],m["client"+f])}return l["client"+f]})(j)}})});a.util(function(f){a.Class("Tools",{init:function(){var g=this;return{zenCoding:function(h){if(!h){return""}if(/(\<[^\>]+\>)/.test(h)){return h}return g._bracket(h.replace(/\s*/g,"")).replace(/\&nbsp;/g,"")},makeHtml:function(i,j,h,k){if(!i){return}if(a.isObject(i)){a.foreach(i,function(l,m){g._makeHtml(m,a.util.queryOne(l.trim()),h,k)})}else{if(a.isString(i)){g._makeHtml(i,a.util.queryOne(j),h,k)}}},unwrap:function(i){if(!i){return}var k=i.parentNode,j=i.className,h=i.childNodes;while(h.length>0){if(j){h[0].setAttribute("data-unclass",j)}k.insertBefore(h[0],i)}k.removeChild(i)},clearHtml:function(i){var h=i.childNodes;while(h.length){i.removeChild(h[0])}}}},_tag:function(i){if(!i){return""}var j=a.util._str2Hooks(i),h,k,g;k=j[1].length?(' class="'+j[1].join(" ")+'"'):"";h=j[0]?(' id="'+j[0]+'"'):"";g=/img|input|br|hr/i.test(i)?("<$1"+h+k+" />"):("<$1"+h+k+">&nbsp;</$1>");return i=i.replace(/^(\w+).*/g,g)},_repeat:function(j){if(!j){return""}var h=this;if(j.indexOf("*")<0){return h._tag(j)}j=j.split("*");var k="";for(var g=0;g<j[1];g++){k+=h._tag(j[0])}return k},_sibling:function(h){if(!h){return""}var g=this;if(h.indexOf("+")<0){if(h.indexOf("*")!=-1){return g._repeat(h)}else{if(h.indexOf(">")!=-1){return g._stack(h)}else{return g._tag(h)}}}h=h.split("+");var i="";h.forEach(function(j){if(j.indexOf("*")!=-1){i+=g._repeat(j)}else{if(j.indexOf(">")!=-1){i+=g._stack(j)}else{i+=g._tag(j)}}});return i},_stack:function(h){if(!h){return""}var g=this;if(h.indexOf(">")<0){if(h.indexOf("*")!=-1){return g._repeat(h)}else{if(h.indexOf("+")!=-1){return g._sibling(h)}else{return g._tag(h)}}}h=h.split(">");var i="&nbsp;";h.forEach(function(j){if(j.indexOf("*")!=-1){i=i.replace(/\&nbsp;/g,g._repeat(j))}else{if(j.indexOf("+")!=-1){i=i.replace(/\&nbsp;/g,g._sibling(j))}else{i=i.replace(/\&nbsp;/g,g._tag(j))}}});return i},_bracket:function(h){if(!h){return""}var g=this,i=function(j){if(!/\(|\)/.test(j)){return j.indexOf("+")?g._sibling(j):g._stack(j)}if(/\+\([^\)]+/.test(j)){var k="";j=j.replace(/\+\(([^\)]+)/g,",$1,");j=j.split(",");j.forEach(function(l){l=l.replace(/\(|\)\+?/g,"");k+=g._stack(l)});return k}};if(/\>\(/.test(h)){h=h.replace(/(\>)(\()/g,"$1,$2").split(">,");return g._stack(h[0]).replace(/\&nbsp;/g,i(h[1]))}else{return i(h)}},_makeHtml:function(i,j,g,k){var l=j,m,h;if(!l){return}if(g){a.util.clearHtml(l)}if(!l.childNodes.length||k){h=a.util.zenCoding(i);m=e.createElement("wrap");m.innerHTML=h||"";itemNodes=m.childNodes;while(itemNodes.length>0){l.appendChild(itemNodes[0])}m=null}}},a.Once);f=new a.Once.Tools();delete a.Once.Tools;return f.init()});a.util(function(f){a.Class("Tools",{init:function(){var g=this;return{render:function(s,p,v,r){if(s&&p){var u=a.util.queryOne(s.wrap,a.elCurWrap);a.isjQueryObject(u)&&(u=u[0]);var j=e.createElement("wrap"),w=(s.viewId||(a.isString(s.tempId)?s.tempId:"wrap"))+"-loaded",l=a.util.queryAll("*[data-unclass="+w+"]",u),m=!l.length,k,q="";try{q=g._fnTmpl(s.tempId)(p)}catch(t){}j.style.display="block";j.className=w;j.innerHTML=q;if(s.hooks){a.foreach(s.hooks,function(o,x){o=g._getWalker(o);if(!o){g._joinHook(x,u)}else{var i=g._walker(o,[j,u]);if(!i){return}i.length===undefined?g._joinHook(x,i):i.forEach(function(y){g._joinHook(x,y)})}})}q=j.innerHTML}else{return g._fnTmpl(s.tempId)}if(!u){return q}if(r||!s.multiChild){a.util.clearHtml(u)}if(m){v?u.insertBefore(j,u.firstChild):u.appendChild(j)}else{if(!u.childNodes.length){u.appendChild(j)}else{u.insertBefore(j,l[0]);for(var n=l.length-1;n>=0;n--){if(!v){u.removeChild(l[n]);j.insertBefore(l[n],j.firstChild)}}}}k=a.util.queryOne("."+w,u);s.loadCallback?s.loadCallback(k,!q):a.util.unwrap(k);a.util.lazyLoad(u,s.delayTime,s.blankPic);j=null;if(s.callback){s.callback(u,s,p)}var h=/form/i.test(u.tagName)?u:a.util.queryOne("form",u);if(!h){return}return function(o){o=o||"string";var x=/json/i.test(o),i=x?{}:"";a.foreach(h.elements,function(z,A){var y=A.getAttribute("name"),B=A.value;if(y){x?i[y]=B:i+="&"+y+"="+B}});return x?i:i.replace(/^&/,"")}},fetch:function(h,n){if(!h){return}var j,m=h.viewId?a.Model.ViewData(h.viewId):{},l=m.ownData,i=navigator.onLine==true,k=!!h.globalKey&&!!a.Model.GlobalData(h.globalKey);h.dataSave=h.isSave!==undefined?h.isSave:h.dataSave;h.dataKey=h.key!==undefined?h.key:h.dataKey;h.overwrite=h.repeatOverwrite!==undefined?h.repeatOverwrite:h.overwrite;if(h.dataSave){h.dataKey=h.dataKey||"";j=(h.viewId||h.tempId)+h.dataKey}if(i&&h.ajaxUrl&&!k){g._ajaxFetch(h,n,l,j)}else{k?g._globalFetch(h,n,l):g._storageFetch(h,n,l,j)}},save:function(h,j){if(a.isString(h)){return g._dataSave(h,j)}h.dataSave=h.isSave!==undefined?h.isSave:h.dataSave;h.dataKey=h.key!==undefined?h.key:h.dataKey;h.overwrite=h.repeatOverwrite!==undefined?h.repeatOverwrite:h.overwrite;if(h.dataSave){h.dataKey=h.dataKey||"";var i=(h.viewId||h.tempId)+h.dataKey;return g._dataSave(i,j,h.overwrite)}},remove:function(h){if(!h){return}a.isArray(h)?h.forEach(function(i){g._dataRemove(i)}):g._dataRemove(h)}}},_tmpl:function(i,l,h){if(!i){return}var k=a.__cache_funs=a.__cache_funs||{},j=function(){return""},g;if(k[i]){return l?k[i](l):k[i]}else{if(!h){return j}h=h.replace(/[\r\t\n]/g,"");g="var __p_fun = [], _self = jsonData;with(jsonData){__p_fun.push('"+h.replace(/<%=(.*?)%>/g,"',(typeof $1!='undefined'? $1:''),'").replace(/<%(.*?)%>/g,"');$1__p_fun.push('")+"');};return __p_fun.join('');";k[i]=new Function("jsonData",g);return l?k[i](l):k[i]}},_fnTmpl:function(h){h=a.isString(h)?h.trim():h;var g=a.__cache_tmpls=a.__cache_tmpls||{};var k=a.__cache_funs=a.__cache_funs||{};var m,l,j=this;if(a.isEmptyObject(g)){a.foreach(a.app,function(n,o){if(o.template){a.foreach(o.template,function(q,p){g[q]=p.replace(/[\r\t\n]/g,"")})}})}if(k[h]){m=k[h]}else{if(g[h]){m=j._tmpl(h,undefined,g[h]);k[h]=m}else{if(a.isjQueryObject(h)){m=j._tmpl(h,undefined,h.html());k[h]=m}else{if(a.isString(h)||a.isObject(h)){var i=a.isObject(h)?h:/\.|#|\[[\w\$\^\*\=]+\]/.test(h)?a.util.queryOne(h):e.getElementById(h);l=i?i.innerHTML.replace(/[\r\t\n]/g,"").replace(/\s+(<)|\s*$/g,"$1"):"";k[h]=m=j._tmpl(h,undefined,l);g[h]=l}}}}return m},_joinHook:function(g,h){if(!g||!h){return}g=a.isArray(g)?g:[g];g.forEach(function(i){if(!i){return}if(/\w*~.*/.test(i)){i=i.split("~");h.setAttribute(i[0],i[1])}else{i=a.util._str2Hooks(i);var j=h.className?h.className.trim().split(/\s+/):[],k=i[1].concat(j).unique();if(i[0]){h.id=i[0]}if(k.length){h.className=k.join(" ")}}})},_getWalker:function(g){if(!/^&[<>]\d+/.test(g)){return}return g.indexOf(">")!=-1?{c:g.replace(/^&>(\d+\:?[\d\w\.\*#]*).*/,"$1").split(":")}:{p:g.replace(/^&<(\d+).*/,"$1")}},_walker:c._walker||function(k,l){if(k.c){var t=parseInt(k.c[0]),s=k.c[1]||"*",g=!a.isNumber(s),j=null;s=g?s:parseInt(s);l=l[0];if(!l){return}if(t==0){if(g){var m=[];a.foreach(l.children,function(u,o){if(a.util._matches(o,s)){m.push(o)}});return m}else{return l.children[s]}}else{var h=e.createTreeWalker(l,NodeFilter.SHOW_ELEMENT,j,false),r,q;for(var n=0;n<t;n++){if(n==t-1){r=h.nextNode()}else{h.nextNode()}}if(g){q=[];while(r){a.foreach(r.children,function(u,o){if(a.util._matches(o,s)){q.push(o)}});r=h.nextSibling()}}else{q=r.children}return g?q:q[s]}}else{var p=parseInt(k.p)+1;return function(){var u=l[1];if(!u){return}for(var o=0;o<p;o++){u=u.parentNode;if(u===e.body){break}}return u}()}},_ajaxFetch:function(g,k,i,h){if(!a.util.ajax&&a.$){a.rentAjax(a.$.ajax)}var j=this;g.ajaxUrl=a.util.fullUrl(g.ajaxUrl,true);a.util.ajax({type:"POST",timeout:10000,url:g.ajaxUrl,cache:false,success:function(n){var m=JSON.stringify(n),l;if(g.globalKey){a.Model.GlobalData(g.globalKey,n)}if(h){l=j._dataSave(h,m,g.overwrite)}if(!!l&&a.isArray(l)){n={repeatData:l}}a.mix(n,i);if(k){k(n)}},error:function(){j._storageFetch(g,k,i,h)}})},_globalFetch:function(g,i,h){a.util.wait(function(j,l){var m=a.Model.GlobalData(g.globalKey);if(!m){a.__cache_timers[j]=false;return}delete a.__cache_timers[j];a.mix(m,h);if(i){i(m)}},1000,10)},_storageFetch:function(h,l,j,i){var k={},g=[];if(i){k=a.util.storage(i)||a.util.storage(i+"Repeat")||{}}if(a.isString(k)){if(/Repeat_\d+/.test(k)){k=k.split(",");k.forEach(function(m){var n=JSON.parse(a.util.storage(m));g.push(n)});k={repeatData:g}}else{k=JSON.parse(k)}}if(h.globalKey){if(a.isEmptyObject(k)){this._globalFetch(h,l,j);return}else{a.Model.GlobalData(h.globalKey,k)}}a.mix(k,j);if(l){l(k)}},_dataSave:function(j,m,i){if(!j||!m){return}if(a.isUndefined(i)||/(Repeat)_\d+/.test(j)){i=true}var n=a.util.storage(j),h=a.util.storage(j+"Repeat"),g=a.util.storage("repeatKeys"),l,k=function(r,o){if(a.isArray(r)){a.util.clearStorage(j);g[j]=true;a.util.storage("repeatKeys",g);r.forEach(function(s){k(s,o)})}else{var q=o[0]?a.util.storage(o[0]):"";if(a.util._jsonCompare(q,r)){return}var p=j+"Repeat_"+o.length+"_"+Math.floor(Math.random()*1000+1);o.unshift(p);a.util.storage(j+"Repeat",o.join(","));r.rkey=p;a.util.storage(p,r)}};g=g?JSON.parse(g):{};l=j.replace(/repeat_\d+.*/gi,"");if(a.isUndefined(g[l])||(g[l]===false&&a.isNull(a.util.storage(j)))||i){a.util.storage(j,m);if(a.isUndefined(g[l])){g[l]=false;a.util.storage("repeatKeys",g)}return}if(a.util._jsonCompare(n,m)){return}m=n?[JSON.parse(n),m]:m;h=h?h.split(","):[];k(m,h);return m},_dataRemove:function(i){if(i.indexOf("Repeat_")>0){var h=i.replace(/(Repeat)_\d+.*/g,"$1"),g=a.util.storage(h).split(",");g.remove(i);a.util.storage(h,g.join(","))}a.util.clearStorage(i)}},a.Once);f=new a.Once.Tools();delete a.Once.Tools;return f.init()});delete a.Once}).call(this);(function(a,c,d){var b=a.namespace("Event");a.mix(b,{_parentIfText:function(e){return e.nodeType===1?e:e.parentNode},_bubble:function(e,f){if(!e||e.nodeType!==1){return}while(e!==d.body){if(f&&f(e)==false){break}if(e.parentNode){e=e.parentNode}else{break}}},_bindEvent:function(g,f,e){g.events=g.events||{};g.types=g.types||[];var h=g.events[f]=e;!g.types.contains(f)&&g.types.push(f);if(g.addEventListener){g.addEventListener(f.replace(/\..*/g,""),h,false)}},_unbindEvent:function(g,f){if(!g.events||!g.types.contains(f)){return}var e=g.events[f];f=f.replace(/\..*/g,"");if(g.removeEventListener){g.removeEventListener(f,e,false)}if(a.isEmptyObject(g.events)||!g.types.length){g.events=null;g.types=null}},_execute:function(g,h,f,e){g=g.toLocaleLowerCase();if(e==="refuseSham"){e=true}b._bubble(h,function(l,i){i=a.util._matches(l,b.__event_selectors);var k=false,m=false;if(a.isNumber(i)){var j=b.items[b.__event_selectors[i]];if(j&&j.types.contains(g)){a.foreach(j.events,function(o,n){o=o.replace(/\.\w+/g,"").split("|");if(o[0]==g){e=e!==undefined?e:[];a.isArray(e)?e.push(f):e=[f,e];n.apply(l,e)}k=o[1]==0?false:true;m=o[2]==0?false:true});if(k){if(e===true){f.preventDefault()}else{b.on(l,"click.prevent",function(n){n.preventDefault()})}}}}if(m){if(e){f.stopPropagation()}return false}})},bind:function(g,f,e){if(!g){return}g=a.util.queryAll(g);g.length===undefined?b._bindEvent(g,f,e):a.foreach(g,function(j,h){b._bindEvent(h,f,e)})},unbind:function(f,e){if(!f){return}f=a.util.queryAll(f);f.length===undefined?b._unbindEvent(f,e):a.foreach(f,function(h,g){b._unbindEvent(g,e)})},trigger:function(h,g,f,e){if(a.isObject(h)&&!a.isjQueryObject(h)){h[g]&&h[g].apply(h,f);return}if(a.isjQueryObject(h)){h=h.get(0)}if(/^@\w+/i.test(g)){g=g.replace(/^@/i,"");h=a.util.queryOne(h);b._execute(g,h)}else{var i=d.createEvent("Event");i.initEvent(g.replace(/\.\w+/g,""),f,e);h.dispatchEvent(i)}},ready:function(h){var g=b.ready,e=function(){if(g.done){return false}if(d&&d.getElementsByTagName&&d.getElementById&&d.body){clearInterval(g.timer);g.timer=null;g.arrFuns.forEach(function(f){f()});g.arrFuns=null;g.done=true}};if(g.done){return h()}if(g.timer){g.arrFuns.push(h)}else{b.on(c,"load",e)}g.arrFuns=[h];g.timer=setInterval(e,15)},__event_selectors:[],delegate:function(e){if(!e){return}var g=b.__event_selectors;var f=b.items=b.items||{};a.util.recurse(e,function(k){if(a.isEmptyObject(k)){return}var j=/!$/.test(k.type);k.type=k.type.toLocaleLowerCase();k.type=j?k.type.replace(/!/g,""):k.type.replace(/click/g,"tap").replace(/mov/g,"swip");if(/blur|focus|load|unload|change/i.test(k.type)){a.util.wait(function(l){var m=a.util.queryAll(k.selector);if(!m||!m.length){a.__cache_timers[l]=false;return}delete a.__cache_timers[l];b.on(m,k.type,k.callback)},500,10)}else{k.selector=k.selector.trim().replace(/\s+/g," ");if(!g.contains(k.selector)){g.push(k.selector)}var i=f[k.selector]=f[k.selector]||{},h=k.type+"|"+(k.preventDefault?1:0)+"|"+(k.stopPropagation?1:0);i.events=i.events||{};i.types=i.types||[];k.type=k.type.replace(/\..*/g,"");i.types.indexOf(k.type)<0&&i.types.push(k.type);i.events[h]=k.callback;if(!/tap|swip|hover/i.test(k.type)||j){a.util.wait(function(l){if(!a.elBodyWrap){a.__cache_timers[l]=false;return}delete a.__cache_timers[l];if(!a.elBodyWrap.events[k.type]){b.on(a.elBodyWrap,k.type,function(m){b._execute(k.type,m.target,m,"refuseSham")})}})}}})},undelegate:function(e){if(!e){return}var g=b.__event_selectors;var f=b.items=b.items||{};a.util.recurse(e,function(k){if(a.isEmptyObject(k)){return}var i=/!$/.test(k.type),j=a.util.queryAll(k.selector);k.type=k.type.toLocaleLowerCase();k.type=i?k.type.replace(/!/g,""):k.type.replace(/click/g,"tap").replace(/mov/g,"swip");b.off(j,"click.prevent");if(/blur|focus|load|unload|change/i.test(k.type)){b.off(j,k.type)}else{k.selector=k.selector.trim().replace(/\s+/g," ");if(!g.contains(k.selector)||!f[k.selector]){return}g.remove(k.selector);var h=f[k.selector];if(h.types.contains(k.type)){h.types.remove(k.type);a.foreach(h.events,function(m,l){if(m.indexOf(k.type)!=-1){delete h.events[m]}})}if(!h.types.length&&a.isEmptyObject(h.events)){delete f[k.selector]}}})},on:function(h,g,f,e,i){if(a.isString(h)&&/^@\w+/i.test(g)){g=g.replace(/^@/i,"");b.delegate({selector:h,type:g,callback:f,preventDefault:e,stopPropagation:i})}else{b.bind(h,g,f)}},off:function(f,e){if(a.isString(f)&&/^@\w+/i.test(e)){e=e.replace(/^@/i,"");b.undelegate({selector:f,type:e})}else{b.unbind(f,e)}}});if(a.Shim.Event){a.mix(b,a.Shim.Event)}a.embedjQuery();b.ready(function(){var m={},h,n="ontouchstart" in c;var o=n?"touchstart":"mousedown",e=n?"touchmove":"mousemove",s=n?"touchend":"mouseup",i=n?"touchcancel":"mouseout";var k=a.elBodyWrap=a.util.queryOne("*[data-pagerole=body]"),r=a.Event,g,q,l=750,f,j=function(){if(f){clearTimeout(f)}f=null},p=function(u,t,w,v){var y=Math.abs(u-t),x=Math.abs(w-v);return y>=x?(u-t>0?"Left":"Right"):(w-v>0?"Up":"Down")};if(!k){a.elBodyWrap=d.body;return}r.on(k,o,function(t){t.stopPropagation();if(t.button&&t.button===2){return}var u=n?t.touches[0]:t;g=Date.now();q=g-(m.last||g);m.el=r._parentIfText(t.target);h&&clearTimeout(h);m.x1=u.pageX;m.y1=u.pageY;m.isScrolling=undefined;if(q>0&&q<=250){m.isDoubleTap=true}m.last=g;r._execute("hover",m.el,t,0);f=setTimeout(function(){f=null;if(m.last){r._execute("hover",m.el,t,1);r._execute("longtap",m.el,t);m={}}},l)});r.on(k,e,function(t){t.stopPropagation();if(t.button&&t.button===2){return}j();var w=n?t.touches[0]:t;m.x2=w.pageX;m.y2=w.pageY;var v=m.x2-m.x1,u=m.y2-m.y1;if(typeof m.isScrolling=="undefined"){m.isScrolling=!!(m.isScrolling||Math.abs(v)<Math.abs(u))}if(!m.isScrolling){r._execute("swiping",m.el,t,[m.x1,m.x2,m.y1,m.y2])}});r.on(k,s,function(t){t.stopPropagation();if(t.button&&t.button===2){return}r._execute("hover",m.el,t,1);j();if(!m.isScrolling){if(m.isDoubleTap){r._execute("dbltap",m.el,t);m={}}else{if("last" in m){if((m.x2&&Math.abs(m.x1-m.x2)<20)||(m.y2&&Math.abs(m.y1-m.y2)<20)){r._execute("tap",m.el,t)}h=setTimeout(function(){h=null;r._execute("singletap",m.el,t);m={}},250)}else{if((m.x2&&Math.abs(m.x1-m.x2)>30)||(m.y2&&Math.abs(m.y1-m.y2)>30)){var u="swipe"+p(m.x1,m.x2,m.y1,m.y2);r._execute(u,m.el,t);m={}}}}}else{m={}}});r.on(k,i,function(t){t.stopPropagation();if(h){clearTimeout(h)}if(f){clearTimeout(f)}f=h=null;m={}})})})(ICAT,this,document);(function(a,b,e){a.namespace("mvc");a.Class("Tools",{init:function(){var h=this;return{inherit:function(i,k){var j=function(){var l=a.toArray(arguments);if(k){l[1]=l[1]||{};l[1].config=l[1].config||{};a.mix(l[1].config,k.config,undefined,false);a.foreach(k,function(o,n){if(o!="config"&&!a.isFunction(n)){l[1][o]=n}})}var m=i.apply(this,l);if(m){return m}};a.mix(j.prototype,i.prototype);if(j.prototype.constructor==Object.prototype.constructor){j.prototype.constructor=j}if(k){a.foreach(k,function(m,l){if(a.isFunction(l)){j.prototype[m]=l}})}j.__super__=i;return j},dealHash:function(j,i){if(!j){return[""]}j=j.replace(/\s+/g,"").match(/[^\#]+/g)[0];if(j.indexOf("/")<0){return[j]}else{if(!i){return}var k;a.foreach(i,function(o,p){var q=new RegExp("^"+o+"$","i"),m=o.match(/\([^\)]+\)/g),n="",l;if(m&&(l=m.length)){m.forEach(function(r,s){n+="$"+(s+1)+(s==l-1?"":",")})}if(q.test(j)){j=j.replace(q,n);j=j.split(",");j.unshift(o);k=j;return false}});return k||[""]}},addItem:function(l,i,j,m){var k=i.viewId;if(!l[k]){if(m){if(i.model){delete i.model}else{if(!j){j=a.Model.__page_emptyModel||new f("__page_emptyModel")}}l[k]=j.modelId}else{if(j){i.setModel(j);l[k]=j.modelId}else{l[k]="__page_emptyModel"}}}},removeItem:function(k,i){if(!a.isString(i)||i.indexOf(",")>0){return}if(k[i]){var j=a.Model.ViewData(i).config.events;if(j){a.util.recurse(j,function(l){if(a.Event){a.Event.undelegate(l)}else{if(a.$&&a.$.event){l.type=l.type.replace(/!/g,"").replace(/(long|single)?tap/gi,"click");a.$(a.elCurWrap).undelegate(l.selector,l.type)}}})}delete k[i]}},regEvents:function(j,i){if(i.events){a.util.recurse(i.events,function(l){var k=l.callback;if(a.isString(k)){k=j[l.callback]}l.callback=function(){var m=a.toArray(arguments);m.unshift(j,j.model,i);k.apply(this,m)};if(a.Event){a.Event.delegate(l)}else{if(a.$&&a.$.event){a.$(a.elCurWrap).delegate(l.selector,l.type.replace(/!/g,""),l.callback)}}})}},multiPage:function(){h._baseInit.apply(h,arguments)},singleLayer:function(j,i){if(j.modsLoad_mode){delete j.modsLoad_mode}if(j.routes.scrollBox){delete j.routes.scrollBox}j.vmClear();h._baseInit(j,i)},multiLayer:function(r,l){var q=r.config,j=r.pageWraps,p=r.wrapGroup,s=r.hashArgus[0],n=q.currentCla||"icat-current-wrap",m,k,i;if(r.modsLoad_mode){delete r.modsLoad_mode}if(r.routes.scrollBox){delete r.routes.scrollBox}if(r.endVid){delete r.endVid}if(a.hashChange){delete a.hashChange}if(a.__back_history){delete a.__back_history}r.vmClear();if(a.elCurWrap){a.util.addClass(a.elCurWrap,"__prev_baseBed");a.util.removeClass(a.elCurWrap,n);delete a.elCurWrap}if(!p.contains(s)){if(j.length==p.length){k=a.util.queryOne(".__prev_baseBed");a.util.removeClass(k,"__prev_baseBed");a.util.addClass(k,n);console.log("The beds are not enough.");return}a.hashChange=true;m=a.elCurWrap=j[p.length];p.push(s)}else{m=a.elCurWrap=j[p.indexOf(s)];a.__back_history=true}a.util.addClass(m,n);k=a.util.queryOne(".__prev_baseBed");i=a.elCurWrap;if(l.switchPage){l.switchPage(k,i)}if(k){a.util.removeClass(k,"__prev_baseBed")}h._baseInit(r,l)},pageLoad:function(i){i.pageMods&&i.pageMods.length?h._modsLoad(i):h._commLoad(i)}}},_baseInit:function(k,j){var h=k.config,i=a.elCurWrap;if(!i){return}if(j.adjustLayout){a.util.makeHtml(j.adjustLayout,i,a.mode_singleLayer);delete j.adjustLayout}else{if(h.adjustLayout){a.util.makeHtml(h.adjustLayout,i,a.mode_singleLayer)}}if(j.baseBed){delete j.baseBed}if(h.scrollBox){k.routes.scrollBox=h.scrollBox}if(j.scrollBox){k.routes.scrollBox=j.scrollBox;delete j.scrollBox}if(j.setAjax){delete a.util.ajax;a.rentAjax(j.setAjax[0],j.setAjax[1])}if(j.modules){k.pageMods=j.modules.replace(/\s+/g,"").split(",");delete j.modules}if(j.vmGroups){j=j.vmGroups}k.vmAdd(j,true)},_modsLoad:function(j){var h=this;var i=function(p){if(!j.pageMods.length||!j.pageMods[0]){return}var q=j.pageMods[0],r=a.View[q],s=j.vmGroups[q],m=a.Model.ViewData(q),n=(m||{}).config;if(!r||!m){j.pageMods.shift();i(j,arguments);return}if(a.__back_history&&!j.endVid){var l=a.util.queryAll("*[data-unclass$=-loaded]",a.elCurWrap),k=l[l.length-1],o=k.getAttribute("data-unclass");j.endVid=o.replace(/\-loaded/g,"")}switch(p){case 0:if(a.__back_history){r.setModel(a.Model[s]);j.pageMods.shift();if(q!==j.endVid){i(0)}}else{n.loadCallback=function(t){j.pageMods.shift();if(t){a.util.unwrap(t)}i(0)};r.setModel(a.Model[s])}break;case 1:if(a.__back_history){r.setModel(a.Model[s]);j.pageMods.shift();if(q!==j.endVid){i(1)}}else{n.loadCallback=function(x){j.pageMods.shift();if(x){a.util.unwrap(x)}var w=a.util.queryOne(j.routes.scrollBox);w=w.nodeType!==1?e.body:w;var t=w.children[0],v=a.util.outerHeight(t),u=a.util.outerHeight(w===e.body?window:w);if(v<=u+50&&j.pageMods.length){i(1)}else{if(j.pageMods.length){a.util.scroll(j.routes.scrollBox,function(y,A,z){if(!j.pageMods.length){return}if(A+y+50>=z){i(2)}})}}};r.setModel(a.Model[s])}break;case 2:if(r.loaded==undefined){r.loaded=false;n.loadCallback=function(t,u){j.pageMods.shift();r.loaded=true;if(t){a.util.unwrap(t)}if(u){i(2)}};r.setModel(a.Model[s])}break}};if(j.routes.scrollBox){i(1)}else{i(0)}},_commLoad:function(h){a.foreach(h.vmGroups,function(j,k){var i=a.View[j],l=a.Model[k];i.setModel(l)})}},a.mvc);var d=new a.mvc.Tools().init();delete a.mvc.Tools;delete a.mvc;var g=function(h,i){this.viewId=h;this._init(i,h);if(!a.View[h]){a.View[h]=this}else{return a.View[h]}};g.prototype={_init:function(j,h){var i=this,k;k=a.Model.__pageData[h]=a.Model.ViewData(h)||{};k.ownData={};a.foreach(j,function(m,l){if(a.isFunction(l)){i[m]=l}else{if(m=="config"){k.config=l;k.config.viewId=h}else{i[m]=l;k.ownData[m]=l}}});if(i.model){i._htmlRender()}},_render:function(i,n,j,p){var r=this,o=r.viewId,m,l,k=a.Model.ViewData(o),q=k.ownData,h=k.config;if(r.model.dataChange(o,i)||a.hashChange||r.forcedChage||a.mode_singleLayer){if(r.forcedChage){delete r.forcedChage}if(p){m=r.model.save(h,i);if(!!m&&a.isArray(m)){i={repeatData:m}}a.mix(i,q)}if(i.repeatData){i.repeatData.forEach(function(t,s){a.util.render(h,t,n,s==0)})}else{l=a.util.render(h,i,n,j);if(l&&a.isFunction(l)){r.getFormData=l}}}},_htmlRender:function(l,k,h){var j=this,m=a.Model.ViewData(j.viewId),i=m.config;if(!l&&j.model){j.model.fetch(i,function(n){if(i.globalKey&&j.model.DataOutput){i.globalArgus=i.globalArgus||[];i.globalArgus.unshift(n);n=j.model.DataOutput.apply(j,i.globalArgus)}if(i.getBIData){n=i.getBIData(n)}j._render(n,k,h)})}else{if(l){j._render(l,k,h,true)}}},setModel:function(i,l,k,h){var j=this;if(!i||(a.isObject(i)&&i.constructor.__super__!==f)){i=a.Model.__page_emptyModel||new f("__page_emptyModel")}if(!j.model){j.model=i;if(j.init){l=j.init(j,i,true)}j._htmlRender(l,k,h)}else{j.model=i}},setConfig:function(i,l,h){var j=this,k=j.model.cfgChange(j.viewId,i);if(k[0]){if(k[1]){j.forcedChage=true}j._htmlRender(null,l,h)}},setAjaxUrl:function(i,j,h){this.setConfig({ajaxUrl:i},j,h)},setTempId:function(j,i,h){this.setConfig({tempId:j},i,h)},setWrap:function(i,j,h){this.setConfig({wrap:i},j,h)},setData:function(j,i,h){this._htmlRender(j,i,h)},update:function(h){this._htmlRender(null,h,true);this.forcedChage=true}};var f=function(h){this.modelId=h;if(!a.Model[h]){a.Model[h]=this}else{return a.Model[h]}};f.prototype={cfgChange:function(h,i){return a.Model.cfgChange(h,i)},dataChange:function(h,i){return a.Model.dataChange(h,i)},fetch:function(){a.util.fetch.apply(this,arguments)},save:function(){return a.util.save.apply(this,arguments)},remove:function(){a.util.remove.apply(this,arguments)}};var c=function(i,j){j=j||{};var h=this;h.ctrlId=i;h.config=j.config||{};h.routes=j.routes||{};h.vmGroups={};h.wrapGroup=[];h._init(i,j,h.config)};c.prototype={_init:function(i,k,h){var j=this,m,l;if(!a.Controller[i]){a.Controller[i]=j}a.foreach(j.routes,function(o,n){var p=o.replace(/\s+/g,"").replace(/\:num/gi,"(\\d+)").replace(/\:\w+/g,"(\\w+)");j.routes[p]=a.isFunction(n)?n:j[n];if(p!==o){delete j.routes[o]}});a.mix(j,k,"config, routes");a.util.wait(function(n,p){var o=a.util.queryAll(h.baseBed);if(!o||!o.length){a.__cache_timers[n]=false;if(p==1400){m=a.elBodyWrap||a.util.queryOne("*[data-pagerole=body]")||e.body;a.util.makeHtml(/^\w+/.test(h.baseBed)?h.baseBed:"div"+h.baseBed,m,false,true)}else{return}}delete a.__cache_timers[n];a.elBodyWrap=a.elBodyWrap||m||a.util.queryOne("*[data-pagerole=body]")||e.body;l=a.elBodyWrap.getAttribute("id");var q=function(t){var s=d.dealHash(t,j.routes);j.hashArgus=s;try{j.routes[s[0]].call(j)}catch(r){}d.pageLoad(j)};if(a.isNull(l)){q(location.hash);b.onhashchange=function(){q(location.hash)}}else{a.mode_multiPage=true;q(l)}},1500,10)},init:function(l){var j=this,i=j.config;if(a.mode_multiPage){a.elCurWrap=a.util.queryOne(i.baseBed);d.multiPage(j,l)}else{if(a.mode_singleLayer){d.singleLayer(j,l)}else{if(a.mode_multiLayer){d.multiLayer(j,l)}else{var k=j.pageWraps=a.util.queryAll(i.baseBed),h=k.length;if(!h){return}if(h==1){a.mode_singleLayer=true;a.elCurWrap=k[0];d.singleLayer(j,l)}else{a.mode_multiLayer=true;d.multiLayer(j,l)}}}}},vmAdd:function(i,k){if(!i){return}i=a.isArray(i)?i:[i];var h=this,j=h.vmGroups;a.util.recurse(i,function(n){if(!n.view||(a.isObject(n.view)&&n.view.constructor.__super__!==g)){return}if(a.isFunction(n.model)&&n.model.__super__==f){a.foreach(n.model.setting||{__page_mainModel:{}},function(p,o){n.model=a.Model[p]||new n.model(p,o)})}if(a.isFunction(n.view)&&n.view.__super__==g){a.foreach(n.view.setting||{__page_mainView:{config:{}}},function(r,p){if(k&&h.pageMods&&!h.pageMods.contains(r)){return}var o=a.View[r]||new n.view(r,p),q=p.config;d.addItem(j,o,n.model,k);d.regEvents(o,q)})}else{var l=n.view,m=a.Model.ViewData(l.viewId).config;d.addItem(j,l,n.model,k);d.regEvents(l,m)}})},vmRemove:function(h){if(!h){return}var i=this.vmGroups;h=a.isString(h)?h.split(","):h;h.forEach(function(j){d.removeItem(i,j)})},vmClear:function(){var h=this.vmGroups;a.foreach(h,function(i){d.removeItem(h,i)})},gotopage:function(h){location.href=a.util.fullUrl(h)}};a.namespace("View","Model","Controller");a.View.extend=function(h){return d.inherit(g,h)};a.Model.extend=function(h){return d.inherit(f,h)};a.Controller.extend=function(h){return d.inherit(c,h)};a.Model.__pageData=a.Model.__pageData||{};a.mix(a.Model,{cfgChange:function(h,l){var j=a.Model.ViewData(h).config,m=l.ajaxUrl&&j.ajaxUrl!=l.ajaxUrl,k=(l.tempId&&j.tempId!=l.tempId)||(l.wrap&&j.wrap!=l.wrap),i=m||k;if(i){a.mix(j,l)}return[i,k]},dataChange:function(h,k){var l=a.Model.ViewData(h),i=l.prevData,j=!a.util._jsonCompare(k,i);if(j){l.prevData=JSON.stringify(k)}return j},GlobalData:function(h,j){var i=a.Model.__globalData=a.Model.__globalData||{};if(!j){return i[h]}if(!i[h]){i[h]=j}},ViewData:function(h,j){var i=a.Model.__pageData=a.Model.__pageData||{};if(!j){return i[h]}if(!i[h]){i[h]=j}}})})(ICAT,this,document);(function(b,c,f){b.namespace("Loader");var e,d=b.Shim.loader||{};b.Class("Tools",{init:function(){var g=this;return{getCurrentJS:function(){var h=f.getElementsByTagName("script");return h[h.length-1]},getConcatUrl:function(k,j){var h=k.replace(/(\?{2}|\.js(?=\?))/g,"$1|").split("|"),i=h[0].replace(/\?+/g,"");j._webRoot=h[0];j.timestamp=h[2]||"";h[1].split(",").forEach(function(l){if(/\/sys\//i.test(l)){j._sysRef=l.replace(/(\/sys\/).*/ig,"$1")}if(/\/apps\//i.test(l)){j._appRef=l.replace(/(\/)\w+(\.\w+)?\.js/g,"$1")}});j.sysRef=(i+j._sysRef).replace(/([^:])\/{2,}/g,"$1/");j.appRef=(i+j._appRef).replace(/([^:])\/{2,}/g,"$1/")},getCommonUrl:function(j,i,h){if(h){i.sysRef=/\/sys\//i.test(j)?j.replace(/(\/sys\/).*/ig,"$1"):j.replace(/(\/)\w+(\.\w+)?\.js(.*)?/g,"$1");i.timestamp=j.replace(/.*\.js(\?)?/g,"$1")}else{i.appRef=j.replace(/(\/)\w+(\.\w+)?\.js(.*)?/g,"$1");if(!i.timestamp){i.timestamp=j.replace(/.*\.js(\?)?/g,"$1")}}},fnInc:function(h){h=b.isString(h)?[h]:h;g.getURL(h).forEach(function(i){if(!i){return}g.blockLoad(i)})},fnOption:function(h,i){g._fnOption.apply(g,arguments)},fnInclude:function(j,l,i,k,h){g._fnOption({files:j,callback:l,isDepend:i,isSingle:k,context:h})},fnRequire:function(k,i,l,j,h){g._fnOption({modName:k,files:i,callback:l,isSingle:j,context:h})},fnUse:function(){var h=arguments[0];if(!b.isObject(h)){return}b.util.wait(function(i,j){if(!g._modGroup[h.modName]){b.__cache_timers[i]=false;if(j==50&&b.ModsConfig[h.modName]){delete b.__cache_timers[i];b.require({modName:h.modName,files:b.ModsConfig[h.modName],callback:h.callback,context:h.context})}return}delete b.__cache_timers[i];if(h.callback){h.callback(h.context)}},60,10)}}},_fullUrl:function(l,h){var k=h?"_":"",g=b.PathConfig[k+"appRef"],i=b.PathConfig[k+"sysRef"],j=b.PathConfig.pageRef;l=l.replace(/\?.*/,"");if(/^\.{1,2}\//.test(l)){l=/^\.\//.test(l)?l.replace(/^\.\//g,g):l.replace(/^\.\.\//g,g.replace(/\w+\/$/g,""))}else{l=i+l}return l},_loadedGroup:{},_modGroup:{},_fnLoad:d._fnLoad||function(i,g,j){var h=this;j.onload=function(){h._loadedGroup[i.file]=true;if(i.callback&&b.isFunction(i.callback)){i.callback(i.context||b)}if(i.modName){h._modGroup[i.modName]=true}h._loadedGroup[i.file]=true;if(!b.$&&(c.jQuery||c.Zepto)){b.$=c.jQuery||c.Zepto;b.embedjQuery()}}},getURL:function(g,l){if(!b.isArray(g)||!g.length){return}if(g.length===1){l=true}var k=this,h=[],j=[],i=b.PathConfig._isConcat&&!l;g.forEach(function(m){m=m.replace(/([^\:])\/+/g,"$1/");if(b.DebugMode){m=m.indexOf("!")>=0?m.replace(/\!/g,""):m.replace(/(\.source)?(\.(js|css))/g,".source$2")}else{m=m.replace(/\!/g,"")}if(/^\w+:\/\/|^\/\w+/.test(m)){m=/^\/\w+/.test(m)?m.replace(/^\//g,b.PathConfig.pageRef):m;h.push(m)}else{m=k._fullUrl(m,i);j.push(m)}});j=i?[b.PathConfig._webRoot+j.join(",")]:j;return j.concat(h)},blockLoad:function(k){var m=this,j=k.indexOf("#")>0?k.replace(/(#.*)/,b.PathConfig.timestamp+"$1"):(k+b.PathConfig.timestamp);if(m._loadedGroup[j]){return}var l=k.replace(/.*\.(css|js)/g,"$1"),i=l=="css",h=i?"link":"script",g=i?' type="text/css" rel="stylesheet"':' type="text/javascript"',n=(i?"href":"src")+'="'+j+'"';f.write("<"+h+g+n+(i?"/>":"></"+h+">"));m._loadedGroup[k]=true;if(!b.$&&(c.jQuery||c.Zepto)){b.$=c.jQuery||c.Zepto}},unblockLoad:function(j){var i=this,g=j.file.indexOf("#")>0?j.file.replace(/(#.*)/,b.PathConfig.timestamp+"$1"):(j.file+b.PathConfig.timestamp);j.file=j.file.replace(/(#.*)/g,"");if(i._loadedGroup[j.file]){if(j.callback&&b.isFunction(j.callback)){j.callback(j.context||b)}if(j.modName){i._modGroup[j.modName]=true}return}var k,h=j.file.replace(/.*\.(css|js)/g,"$1");if(h==="css"){k=f.createElement("link");k.setAttribute("type","text/css");k.setAttribute("rel","stylesheet");k.setAttribute("href",g)}else{if(h==="js"){k=f.createElement("script");k.setAttribute("type","text/javascript");k.setAttribute("src",g);k.setAttribute("async",true)}}if(!k){return}b.util.wait(function(m){var l=f.body||f.getElementsByTagName("body")[0],n;if(!l){b.__cache_timers[m]=false;return}delete b.__cache_timers[m];n=f.head||f.getElementsByTagName("head")[0];if(h==="js"){i._fnLoad(j,n,k)}if(h==="css"){setTimeout(function(){if(j.callback&&b.isFunction(j.callback)){j.callback(j.context||b)}if(j.modName){i._modGroup[j.modName]=true}},5);i._loadedGroup[j.file]=true}n.appendChild(k)})},_fnOption:function(j,k){var i=this,g=j,h;if(k){if(b.isString(g)){g={modName:g}}if(!b.isObject(g)||!(g.files=g.files||b.ModsConfig[g.modName])){return}}else{if(b.isString(g)||b.isArray(g)){g={files:g}}if(!b.isObject(g)||!g.files){return}}g.files=b.isString(g.files)?i.getURL([g.files]):i.getURL(g.files,g.isSingle);if(k&&i._modGroup[g.modName]&&g.callback){g.callback();return}if(k){g.isDepend=true}(h=function(){if(!g.files.length){return}var l=g.files.shift();if(g.files.length){if(g.isDepend){i.unblockLoad({file:l,modName:g.modName,callback:function(){h(g.files)},context:g.context})}else{i.unblockLoad({file:l,context:g.context});h(g.files)}}else{i.unblockLoad({file:l,modName:g.modName,callback:g.callback,context:g.context})}})()}},b.Loader);var a=new b.Loader.Tools().init();delete b.Loader.Tools;delete b.Loader;(e=function(g){var i=b.PathConfig,h=a.getCurrentJS(),j=h.src;i._isConcat=j.indexOf("??")>=0;if(!i.appRef){i._isConcat?a.getConcatUrl(j,i):a.getCommonUrl(j,i,g===true)}if(b.isObject(g)){b.mix(i,g)}})(true);b.mix(b,{PathConfig:b.mix(e,b.PathConfig),ModsConfig:function(g){var h=b.ModsConfig;if(b.isArray(g)){b.foreach(g,function(j,i){h[i.modName]=(h[i.modName]||[]).concat(i.paths)})}else{if(g.modName&&g.paths){h[g.modName]=(h[g.modName]||[]).concat(g.paths)}else{b.foreach(g,function(j,i){h[j]=(h[j]||[]).concat(i)})}}},inc:function(){if(!arguments.length){return}a.fnInc(arguments[0])},include:function(){if(!arguments.length){return}arguments.length==1?a.fnOption(arguments[0]):a.fnInclude(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])},require:function(){if(!arguments.length){return}arguments.length==1?a.fnOption(arguments[0],true):a.fnRequire(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4])},use:function(g){if(!arguments.length){return}if(arguments.length==1){a.fnUse(arguments[0])}else{a.fnUse({modName:arguments[0],callback:arguments[1],delay:arguments[2],context:arguments[3]})}}});b.ModsConfig({zeptoAjax:["lib/zepto/src/zepto.js","lib/zepto/src/ajax.js"],zeptoAnim:["lib/zepto/src/zepto.js","lib/zepto/src/fx.js","lib/zepto/src/fx_methods.js"],zAjaxAnim:["lib/zepto/src/zepto.js","lib/zepto/src/ajax.js","lib/zepto/src/fx.js","lib/zepto/src/fx_methods.js"],appMVC:["./mvc/view.js","./mvc/model.js","./mvc/controller.js"]});b.weinreStart=function(){if(!b.PathConfig.weinreRef){return}var i=b.util.cookie("__w_hash")||"#anonymous",h=location.hash;if(h&&/^#[^\W]+$/.test(h)&&!i){b.util.cookie("__w_hash",h,3600)}var g=b.PathConfig.weinreRef+"target/target-script-min.js!"+i;b.include(g)};if(b.IPMode){b.weinreStart()}})(ICAT,this,document);
