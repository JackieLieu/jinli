var Com=Common,dataSp=Com.getUrlParam("sp"),source=Com.getUrlParam("source"),puuid=Com.getUrlParam("puuid");var Memory={file:{score:0,sp:dataSp,source:source,puuid:puuid,token:token,grant:{}}};
var endInterval=function(){$("#open").show();$("#time span").hide();$("#time").attr("value","end");$("#plate img").hide();$("#getIntegral h1").html("0");
$("#getIntegral ul").html("");clearInterval(inter);};var score=function(b){if(!gameData.props[b]){Memory.file.score=0;endInterval();gameM.send({data:Memory.file});
return;}var a=["<li><h2>+",gameData.props[b],"</h2></li>"].join("");Memory.file.score=Memory.file.score+gameData.props[b];console.log(Memory.file.grant[b]);
if(Memory.file.grant[b]){Memory.file.grant[b]++;}else{Memory.file.grant[b]=1;}$("#getIntegral h1").html(Memory.file.score);$("#getIntegral ul").append(a);
};var isCode=function(a){a.name="挑战成功";switch(a.code){case -2:a.msg="您非法修改了数据，不能在本活动周期内继续参与";break;case -1:a.msg="您今天的机会已用完，请明天继续接受挑战";break;case 0:isLoad("挑战失败");
return"over";case 1:a.msg="活动不再记分范围内，可以无限试玩。";break;case 2:a.name="挑战失败";a.msg="请再接再厉,今天还有"+a.remainTimes+"次机会";break;case 3:a.msg="今天还有"+a.remainTimes+"次机会";
break;case 4:a.msg="今日积分已达到上限";break;case 5:a.msg="你今天的机会用完了，分享获得额外一次机会";break;}if(a.code==5){$("#shareBut").show();$("#comeAgain").hide();}else{$("#shareBut").hide();
$("#comeAgain").show();}};var isLoad=function(a,b){if(a){$('#loadWindow [name="name"]').html(a).show();}else{$('#loadWindow [name="name"]').hide();}$("#loadWindow").show();
$('[name="window"]').show();if(b){b.stopPropagation();}return;};var ajaxInit=function(b){Memory.file.score=0;for(var a in Memory.file.grant){Memory.file.grant[a]=0;
}if(b){gameData.fish=b.fish;gameData.remainTimes=b.remainTimes;if(b.grant>gameData.historyScore&&b.code!=1){$('[name="load"] font span').html(b.grant);
gameData.historyScore=b.grant;}}};var gameM=new Model({url:gameData.submitUrl,succ:function(b){ajaxInit(b.data);if(!b.success){return alert(b.msg||"非法请求");
}if(isCode(b.data)=="over"){return;}var a=new Form("#window");a.setHtml(b.data);$("#window").show();$('[name="window"]').show();}});var shareM=new Model({url:gameData.share.ajax,succ:function(a){if(a.data.share){gameData.share.status=a.data.share;
gameData.remainTimes=a.data.remainTimes;}}});$(function(){var e=130,h=150,a=Common.client(),d=(a.width-e)/2,c=$("#cat").height(),g=a.height-c/1.55,b={left:d,top:h,position:"absolute"},f={left:d,top:130,position:"absolute"};
$("#cat").load(function(){c=$("#cat").height();g=a.height-c/1.55;});$("#open").click(function(i){if(!gameData.remainTimes){if(!gameData.share.status){$("#shareWindow").show();
i.stopPropagation();return;}$("#overWindow").show();i.stopPropagation();return;}$(this).hide();$("#time span").css("display","inline-block");$("#time").attr("value","statr");
$("#time span:eq(0)").html("30");$('#plate [index="'+gameData.fish[0]+'"]').show();inter=setInterval(function(){var j=parseInt($("#time span:eq(0)").html());
if(j){return $("#time span:eq(0)").html(--j);}endInterval();gameM.send({data:Memory.file});},800);});$('#explain [name="title"]').click(function(i){if($("#explain").hasClass("hide")){$("#explain").removeClass("hide");
}else{$("#explain").addClass("hide");}i.stopPropagation();});$("body").click(function(){if(!$("#explain").hasClass("hide")){$("#explain").addClass("hide");
}$("#guide").hide();$(".window").hide();$(".window-bg").hide();});$("#getIntegral").css("bottom",a.height/3);$("#state").swipe({swipeStatus:function(k,q,p,j,n,o){if(q=="move"||$("#time").attr("value")=="end"){return;
}var i=$('#plate [index="'+gameData.fish[0]+'"]'),m=i.clone(),s;if(p=="down"){i.hide();s=gameData.fish[0];gameData.fish.shift();$('#plate [index="'+gameData.fish[0]+'"]').show();
$("#state").append(m);var l=$("#state img").length-1,r=$("#state img").eq(l);r.css(b);r.animate({top:g},1000,function(){$(this).remove();});score(s);}if(p=="up"){i.hide();
gameData.fish.shift();$('#plate [index="'+gameData.fish[0]+'"]').show();$("#state").append(m);var l=$("#state img").length-1,r=$("#state img").eq(l);r.css(f);
r.animate({top:0},600,function(){$(this).remove();});return;}}});$('[name="load"]').click(function(){if(gameData.login){return;}if(dataSp){Com.onEvent("account");
Com.onEvent("finish");return;}window.location.href=gameData.loginUrl;});$('[name="share"]').click(function(i){if(gameData.source=="weixin"){$("#wxShare").show();
i.stopPropagation();return;}console.log(JSON.stringify(gameData.share));if(dataSp){shareM.send({data:{sp:dataSp,source:source,puuid:puuid,token:token}});
Com.onEvent("share",gameData.share);return;}});$("#comeAgain").click(function(){$("#window").hide();$('[name="window"]').hide();});$("#draw").click(function(k){if(!gameData.login){isLoad(null,k);
return;}var i=$(this).attr("data-url");var j={newArgs:{viewType:"webview",param:{url:i,title:"抽奖"}}};if(dataSp){Com.openPage({file:j});return;}$("#dow").show();
$(".window-bg").show();k.stopPropagation();});$("#mall").click(function(k){if(!gameData.login){isLoad(null,k);return;}var i=$(this).attr("data-url");var j={newArgs:{viewType:"webview",param:{url:i,title:"积分商城"}}};
if(dataSp){Com.openPage({file:j});return;}$("#dow").show();$(".window-bg").show();k.stopPropagation();});$("#ranking").click(function(){var i=$(this).attr("data-url");
var j={newArgs:{viewType:"webview",param:{url:i,title:"排行榜"}}};if(dataSp){Com.openPage({file:j});}else{window.location.href=i;}});$('#dow [type="button"]').click(function(){if(gameData.source=="weixin"){window.location.href=$(this).attr("weixinhref");
return;}window.location.href=$(this).attr("clienthref");});});