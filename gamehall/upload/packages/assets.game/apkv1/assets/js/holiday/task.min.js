(function(){var b=0,a=0;$('#download [name="gameList"] h1').each(function(){var c=$(this).height();if(c>b){b=c;}});$('#download [name="gameList"] h2').each(function(){var c=$(this).height();
if(c>a){a=c;}});$('#download [name="gameList"] h1').css("height",b).addClass("multi-line-omit");$('#download [name="gameList"] h2').css("height",a).addClass("multi-line-omit");
}());var Com=Common,gameStatus={100:["下载","startDownload"],101:["下载中",""],102:["继续","resumeDownload"],103:["安装中",""],104:["安装","installGame"],105:["启动","openGame"],106:["升级","startDownload"],107:["重试","resumeDownload"],109:["下载","startDownload"],110:["升级","startDownload"]},loadState=Validata.empty(Com.getVal("islogin")),dataSp=Com.getUrlParam("sp"),dataPuuid=Com.getUrlParam("puuid"),isAjax=false;
$(function(){var b=document.getElementById("msg"),c=document.getElementById("roll"),d=document.getElementById("copyRoll"),g,a=$("#layerPig img").attr("src");
(function(){var j=setButStatus(),k=holidayData.autoFinishTaskUrl;if(isAjax){return;}if(loadState=="false"){return;}if(!j.length){return;}isAjax=true;$.post(k,{token:token,sp:dataSp,puuid:dataPuuid,taskData:JSON.stringify(j)},function(n){var n=JSON.parse(n),m=new Form("#sign");
isAjax=false;if(!n.success){$("#ajaxTitle").show();$("#ajaxTitle [name=msg]").html(n.msg||"非法请求");return;}if(!n.data.status){$("#ajaxTitle").show();$("#ajaxTitle [name=msg]").html(n.msg||"自动完程任务失败");
return;}if(n.data.taskStatus){$("#sign .same-day").removeClass("same-day").addClass("signed");$('#sign [name="todayFinished"]').html("完成");}for(var l in n.data.reward){$('#prize [name="pig"]').eq(l-1).attr("data-status",n.data.reward[l]);
}m.setHtml(n.data);});}());var e=function(){var j=['<div name="pigMove"><div class="layer-bg-black"></div>','<div class="img-container">','<div class="img-wrapper">','<img name="poster" src=',a,">","</div>","</div>",'<div class="btn-container">努力追猪中...</div></div>'].join("");
$("#layerPig").html(j);$("#layerPig").show();return{remove:function(){$("#layerPig").find('[name="pigMove"]').remove();}};};Com.onEvent("gamestatus.listener");
if($("#roll p").length>10){d.innerHTML=c.innerHTML;if($("#roll p").length%2){$("#roll").append("<p>"+$("#roll p").eq(0).html()+"</p>");$("#copyRoll p").eq(0).remove();
}setInterval(function(){if(d.offsetTop-b.scrollTop<=0||g==b.scrollTop){b.scrollTop-=c.offsetHeight+56;}else{g=b.scrollTop;b.scrollTop++;}},80);}function h(j){j.preventDefault();
j.stopPropagation();}var f=function(j){if(j.top){$(j.id).css({top:j.top});$("body").unbind("touchmove");}$(j.id).show();$(j.id).find('[name="msg"]').html(j.data.title);
$(j.id).find('[name="poster"]').attr("src",j.data.prizeImg);};var i=function(){if(!Com.isVersionBiggerorEqual(dataSp.split("_")[1],holidayData.clientVersion)){$("body").bind("touchmove",h,false);
$("#source").show();return;}if(loadState=="false"){$("body").bind("touchmove",h,false);$("#load").show();return;}return true;};$("#download").on("click",'[name="gameList"] [name="dow"]',function(){var m=$(this).parents('[name="gameList"]'),k=m.attr("data-package"),j=m.attr("data-status"),n=Com.getDataStatus(holidayData.game,"packageName",k),l={list:[n]};
if(!i()){return;}Com.removeLetter(l.list,"gameSize");if(gameStatus[j][1]){Com.onEvent(gameStatus[j][1],l);if(j==105){$(this).val("已完成");}}});$("#download").on("click",'[name="gameList"] [name="gameDetails"]',function(){var j=$(this).parents('[name="gameList"]').attr("data-package"),k=Com.getDataStatus(holidayData.game,"packageName",j);
if(!i()){return;}var l={newArgs:{viewType:"GameDetailView",param:{title:"",url:"http://game.gionee.com",gameId:k.gameId,downUrl:k.downUrl,packageName:k.packagename,filesize:k.gameSize,sdkinfo:"android1.6",resolution:dataSp.split("_")[4]}}};
Com.openPage({file:l});});$("#prize").on("click",'[name="pig"]',function(){var n=parseInt($(this).attr("data-status")),q=$('#prize [name="pig"]').index(this),p=$(this).attr("data-ajaxUrl"),m=$(this).attr("data-condition"),r=$(this),j=$(this).attr("data-ajaxUrl"),o,k;
if(isAjax){return;}if(!i()){return;}$("body").bind("touchmove",h,false);if(!n){$("#unfinishedTask").show();$('#unfinishedTask [name="msg"]').html(m);return;
}if(n=="2"){$("#successPrize").show();return;}k=e();var l=setInterval(function(){if(o){k.remove();clearInterval(l);isAjax=false;if(!o.success){return;}if(o.success==0||o.data.status==0){$("#ajaxTitle").show();
$("#ajaxTitle [name=msg]").html(o.msg);return;}switch(parseInt(o.data.prizeType)){case 3:o.id="#layerEntity";o.top=document.body.scrollTop+"px";break;case 1:o.id="#voucher";
break;case 2:o.id="#integral";break;case 0:o.id="#layerNot";break;}f(o);r.attr("data-status","2");}},3200);isAjax=true;$.post(p,{token:token,sp:dataSp,puuid:dataPuuid},function(s){o=JSON.parse(s);
holidayData.prizeId=o.data.prizeId;holidayData.prizeItemId=o.data.prizeItemId;});return;});$('#layerEntity [name="ok"]').tap(function(){var k=new Form("#layerEntity"),j=k.getVals();
$error=$('#layerEntity [name="error"]');if(isAjax){return;}if(!Validata.empty(j.name)){$error.html("请输入收货人");$error.show();return;}if(!Validata.empty(j.phone)){$error.html("请输入手机号码");
$error.show();return;}if(!Validata.phone(j.phone)){$error.html("请输入正确的手机号码");$error.show();return;}if(!Validata.empty(j.address)){$error.html("请输入地址");
$error.show();return;}if(j.address.length<=6){$error.html("地址长度应大于六位");$error.show();return;}$error.hide();j.token=token;j.sp=dataSp;j.puuid=dataPuuid;
j.prizeId=holidayData.prizeId;j.prizeItemId=holidayData.prizeItemId;isAjax=true;$.post(holidayData.ajaxUrlEntity,j,function(l){isAjax=false;l=JSON.parse(l);
$("#layerEntity").hide();if(!l.success){$("#ajaxTitle").show();$("#ajaxTitle [name=msg]").html(l.msg);return;}if(!l.data.status){$("#ajaxTitle").show();
$("#ajaxTitle [name=msg]").html(l.msg);return;}$("#layerEntitySuccess").show();});});$('#load [name="ok"]').tap(function(){Com.onEvent("account");Com.onEvent("finish");
});$('input[name="but-hide"]').click(function(){$(this).parents(".layer").hide();$("body").unbind("touchmove");});$('#ajaxTitle [name="ok"]').tap(function(){$(this).parents(".layer").hide();
$("body").unbind("touchmove");});$('#voucher [name="ok"]').tap(function(){var j={newArgs:{viewType:"webview",param:{url:$("#voucher").attr("data-url"),title:"A券"}}};
Com.openPage({file:j});$("body").unbind("touchmove");});$('#source [name="ok"]').tap(function(){var j={newArgs:{viewType:"GameDetailView",param:{title:"客户端下载",url:holidayData.clientGameDetailUrl,gameId:holidayData.clientGameId,downUrl:holidayData.downurl,packageName:holidayData.packagename,filesize:holidayData.filesize,sdkinfo:"android1.6",resolution:dataSp.split("_")[4]}}};
Com.openPage({file:j});});$('#integral [name="ok"]').tap(function(){Com.onEvent("mypoint");$("body").unbind("touchmove");});$("#selectInfo").click(function(){var j={newArgs:{viewType:"webview",param:{url:$(this).attr("data-url"),title:"活动说明"}}};
Com.openPage({file:j});});});function setButStatus(){var h=Com.dowloadStatus({list:holidayData.game}),f,k,b,d=[],a,j,e,g=false;if(!h){return d;}f=h.list;
e=f.length;for(var c=0;c<e;c++){b=f[c].status;a=f[c].packageName;k=$('[data-package="'+a+'"]');k.attr("data-status",b);j=Com.getDataStatus(holidayData.game,"packageName",a);
if((b==105&&j.taskType==2&&loadState=="true")||j.taskStatus==1){k.find("input").val("已完成");}else{k.find("input").val(gameStatus[b][0]);}if(b==105&&loadState=="true"&&j.taskStatus==0){g=true;
}if(b==105&&j.taskType!=1&&j.taskStatus==0){d.push({taskId:j.taskId,taskType:j.taskType,gameId:j.gameId,packageName:a});}}if(g){$.post(holidayData.getTaskStatusUrl,{puuid:dataPuuid,token:token,sp:dataSp},function(n){var n=JSON.parse(n),m=new Form("#sign");
n=n.data;if(!parseInt(n.taskStatus)){return;}for(var l in n.reward){$('#prize [name="pig"]').eq(l-1).attr("data-status",n.reward[l]);}$('#download [name="dow"]').val("已完成");
$("#sign .same-day").removeClass("same-day").addClass("signed");$('#sign [name="todayFinished"]').html("完成");m.setHtml(n);});}return d;}function setGameStatus(a,b){if(a=="gamehall.gameStatusChange"){setButStatus();
}}