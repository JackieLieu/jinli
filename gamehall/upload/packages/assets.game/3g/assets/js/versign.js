(function(){var d={phoneAndPwdNull:"请输入账号、密码",pwdNull:"请输入密码",pwdNotEqual:"两次输入的密码不一致",pwdIllegal:"密码为4-16位的字母或数字",pwdError:"密码错误",phoneNull:"请输入手机号码",phoneIllegal:"手机号码有误",verifyFail:"验证失败",codeNull:"请输入验证码",codeError:"验证码错误",codeSendSuccess:"验证码发送成功",loginSuccess:"登录成功",registerSuccess:"注册成功"};
var e={1011:"账号或密码错误",1101:"验证码错误",1100:"账号已存在",unknow:"网络异常，请检查后重试",timeout:"请求超时"};var a={phone:/^1[34578]{1}[0-9]{9}$/,pwd:/^[\u0021-\u007E]{4,16}$/};
var c=60;var b={login:function(){$(".J_login").click(function(){var g=$("#phone").val(),i=$("#password").val(),f=!$(".J_code").hasClass("hidden"),h=f?$("#code").val():"";
if(g==""||i==""){b.showMsg(d.phoneAndPwdNull);return false;}if(f&&h==""){b.showMsg(d.codeNull);return false;}if(!a.phone.test(g)){b.showMsg(d.phoneIllegal);
return false;}if(i.length<4){b.showMsg(d.pwdError);return false;}if(f&&h.length<4){b.showMsg(d.codeError);return false;}$(".J_tips").addClass("invisible");
$(".J_mask").removeClass("hidden");$.ajax({url:$(this).attr("data-ajaxurl"),dataType:"json",timeout:10000,data:{tn:g,p:i,vid:$("#code").attr("data-vid"),vtx:h,vty:$("#code").attr("data-vty")},success:function(k){$(".J_mask").addClass("hidden");
var j=k.data;if((j.vmt&&j.vmt==1)){$(".J_code").removeClass("hidden");$("#code").attr("data-vty",j.vty[0]);$(".J_code img").trigger("click");}if(j.r){if(j.r=="1101"||f){$(".J_code").removeClass("hidden");
$(".J_code img").trigger("click");}if(e[j.r]){b.showMsg(e[j.r]);}else{b.showMsg(e.unknow);}return false;}else{b.showTip(d.loginSuccess);location.href=redirect;
}},error:function(j,k){$(".J_mask").addClass("hidden");if(k=="timeout"){b.showMsg(e.timeout);}else{b.showMsg(e.unknow);}}});});},getVerCode:function(){$(".J_loading img").click(function(f){$("#code").val("");
$(this).addClass("hidden");$(this).siblings("i").removeClass("hidden");$.ajax({url:$(this).attr("data-ajaxurl"),dataType:"json",timeout:10000,success:function(i){var i=i.data;
var g=$(".J_loading img");var h="data:image/png;base64,"+i.vda;g.attr("src",h);$("#code").attr("data-vid",i.vid);g.siblings("i").addClass("hidden");g.removeClass("hidden");
},error:function(h,i){var g=$(".J_loading img");g.siblings("i").addClass("hidden");g.removeClass("hidden");if(i=="timeout"){b.showMsg(e.timeout);}else{b.showMsg(e.unknow);
}return false;}});});$(".J_getCode").click(function(g){var f=$("#phone").val();b.countDown();$.ajax({url:$(".J_getCode").attr("data-ajaxurl"),dataType:"json",timeout:10000,data:{tn:f,s:$(".J_getCode").attr("data-s")},success:function(h){var h=h.data;
if(h.r){if(e[h.r]){b.showMsg(e[h.r]);}else{b.showMsg(e.unknow);}}else{b.showTip(d.codeSendSuccess);}},error:function(h,i){if(i=="timeout"){b.showMsg(e.timeout);
}else{b.showMsg(e.unknow);}}});});if(!$(".J_step1").hasClass("hidden")){$(".J_step1 .J_loading img").trigger("click");}},register:function(){$(".J_step1 .J_next").click(function(){var f=$("#phone").val(),g=$("#code").val();
if(f==""){b.showMsg(d.phoneNull);return false;}if(g==""){b.showMsg(d.codeNull);return false;}if(!a.phone.test(f)){b.showMsg(d.phoneIllegal);return false;
}if(g.length<4){b.showMsg(d.codeError);return false;}$(".J_tips").addClass("invisible");$(".J_mask").removeClass("hidden");$.ajax({url:$(this).attr("data-ajaxurl"),dataType:"json",timeout:10000,data:{tn:f,vid:$("#code").attr("data-vid"),vtx:g,vty:$("#code").attr("data-vty")},success:function(i){var i=i.data;
$(".J_mask").addClass("hidden");if(i.s){var h=$(".J_step2");$(".J_step1").addClass("hidden");h.removeClass("hidden");h.find(".J_getCode").attr("data-s",i.s);
h.find("#phone").val(f);h.find(".J_getCode").trigger("click");}if(i.r){if(i.r=="1101"){$(".J_step1 .J_code img").trigger("click");}if(e[i.r]){b.showMsg(e[i.r]);
}else{b.showMsg(e.unknow);}return false;}},error:function(h,i){$(".J_mask").addClass("hidden");if(i=="timeout"){b.showMsg(e.timeout);}else{b.showMsg(e.unknow);
}}});});$(".J_step2 .J_next").click(function(){var g=$(".J_step2"),f=g.find("#phone").val(),h=g.find("#code").val();if(h==""){b.showMsg(d.codeNull);return false;
}if(h.length<6){b.showMsg(d.codeError);return false;}$(".J_tips").addClass("invisible");$(".J_mask").removeClass("hidden");$.ajax({url:$(this).attr("data-ajaxurl"),dataType:"json",timeout:10000,data:{tn:f,sc:h,s:g.find(".J_getCode").attr("data-s")},success:function(j){var j=j.data;
$(".J_mask").addClass("hidden");if(j.s){var i=$(".J_step3");$(".J_step2").addClass("hidden");i.removeClass("hidden");i.find(".J_complete").attr("data-s",j.s);
}if(j.r){if(e[j.r]){b.showMsg(e[j.r]);}else{b.showMsg(e.unknow);}return false;}},error:function(i,j){$(".J_mask").addClass("hidden");if(j=="timeout"){b.showMsg(e.timeout);
}else{b.showMsg(e.unknow);}}});});$(".J_step3 .J_complete").click(function(){var g=$("#password").val(),f=$("#repassword").val();if(g==""||f==""){b.showMsg(d.pwdNull);
return false;}if(g!=f){b.showMsg(d.pwdNotEqual);return false;}if(!a.pwd.test(g)){b.showMsg(d.pwdIllegal);return false;}$(".J_tips").addClass("invisible");
$(".J_mask").removeClass("hidden");$.ajax({url:$(this).attr("data-ajaxurl"),dataType:"json",timeout:10000,data:{s:$(this).attr("data-s"),p:g},success:function(i){$(".J_mask").addClass("hidden");
var h=i.data;if(i.r){if(e[i.r]){b.showMsg(e[i.r]);}else{b.showMsg(e.unknow);}return false;}else{b.showTip(d.registerSuccess);location.href=redirect;}},error:function(h,i){$(".J_mask").addClass("hidden");
if(i=="timeout"){b.showMsg(e.timeout);}else{b.showMsg(e.unknow);}}});});},countDown:function(){var f=$(".J_getCode");if(c==0){f.removeAttr("disabled").removeClass("disabled").html("获取验证码");
c=60;}else{f.attr("disabled","disabled").addClass("disabled").html("重新发送"+c);c--;setTimeout(function(){b.countDown();},1000);}},showMsg:function(f){if(f!=""){$(".J_tips").removeClass("invisible").html(f);
}else{$(".J_tips").addClass("invisible").html(f);}},showTip:function(i){var h=$(".J_tipBox"),g=$(document).width(),j=h.width();h.find("p").html(i);var f=i.length*6;
h.css("left",((g-j)/2-f)+"px").removeClass("hidden");setTimeout(function(){h.addClass("hidden");h.find("p").html("");},1000);},init:function(){this.login();
this.register();this.getVerCode();}};$(function(){b.init();});})();