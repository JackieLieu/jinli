$(function(){var b={file:{prize:{},prizeConfig:[],},data:[]};if(holidayTaskData.prize){b.file.prize=holidayTaskData.prize;}else{b.file.prize["0"]=[];b.file.prize["1"]=[];
b.file.prize["2"]=[];}b.file.prizeConfig["0"]={};b.file.prizeConfig["1"]={};b.file.prizeConfig["2"]={};b.data["1"]=["probability","leastDate","maxQuantity","lotteryNumber","bigPoster","smallPoster","prizeName"];
b.data["2"]=["probability","leastDate","maxQuantity","lotteryNumber","validityPeriod","aSecuritiesTitle","amount","bigPoster","smallPoster","prizeName"];
b.data["3"]=["probability","leastDate","maxQuantity","lotteryNumber","integralTitle","amount","bigPoster","smallPoster","prizeName"];b.data["0"]=["productType","bigPoster","smallPoster","prizeName"];
$("#alert").dialog({autoOpen:false,title:"警告",buttons:{"确定":function(){$(this).dialog("close");}}});$("#progressbar").dialog({autoOpen:false});$("#loadIng").progressbar({value:37});
var a=function(c){$("#alert").dialog("open");$("#alert").find('[name="msg"]').html(c);};$("body").on("click",'[name="ok"]',function(){var h=$(this).parents('[js="layer"]').attr("id"),e=new Form("#"+h),c=new Form('#prizeForm table[name="'+h+'"]'),g=b.file.prize[b.prizeIndex],d=b.prizeLength,f=b.data[b.file.type];
g[d]=e.getArrayVal(f);g[d].type=b.file.type;c.setHtml(g[d]);if(!Number(b.file.type)){g[d].leastType=b.file.leastType;}console.log(JSON.stringify(g[d]));
$("#"+h).dialog("close");});$("body").on("change",'[name="leastType"]',function(){var c=$(this).val(),d=$(this).parents('[js="layer"]');if(c=="1"){d.find('input[name="integralNumber"]').show();
d.find('[name="integralNumberTitle"]').show();}else{$('input[name="integralNumber"]').hide();$('[name="integralNumberTitle"]').hide();}b.file.leastType=c;
});$("body").on("change",'[name="type"]',function(){var c=$(this).val(),e=b.data[c].length,f=$(this).parents('[js="layer"]');f.find("*[data-name]").hide();
for(var d=0;d<e;d++){f.find('[data-name="'+b.data[c][d]+'"]').show();}if(!Number(c)){f.find('[name="leastType"]').trigger("change");}b.file.type=c;});$("#prizeForm").on("click",'[name="update"]',function(){var c=$(this).parents("table").attr("name");
$("#"+c).dialog("open");$("#"+c).find('[name="type"]').trigger("change");});$("#prizeForm").on("click",'input[name="update"]',function(){var c=$('#prizeForm input[name="update"]').index(this);
$("#prizeForm [name='prizeConfig']:eq("+c+")").dialog("open");});$("#prizeForm").on("click",'input[name="add"]',function(){var c=$(this).attr("data-type"),e=b.file.prize[c],d=e.length,f="prizeConfig"+c+"-"+d;
e[d]={};$("body").append(prizeAllocation(f,c+"-"+d));$("#"+f).dialog({autoOpen:true,width:650,modal:true,title:"配置奖品"});$("#"+f).find('[name="type"]').trigger("change");
$(this).parents('[name="news-prize"]').append(prizeConfigIntr(f));b.prizeIndex=c;b.prizeLength=d;});$("#submit").click(function(){var e=["prizeName","prizeDescript","type","poster"],d=e.length;
b.file.descript=editor.html();b.file.name=$("#name").val();for(var c=0;c<d;c++){$('#prizeForm input[name="'+e[c]+'"]').each(function(f){b.file.prizeConfig[f][e[c]]=$(this).val();
});$('#prizeForm select[name="'+e[c]+'"]').each(function(f){b.file.prizeConfig[f][e[c]]=$(this).find(":selected").val();});}console.log(JSON.stringify(b.file));
$("#progressbar").dialog("open");$.post(ajaxUrl,b.file,function(f){$("#progressbar").dialog("close");if(!f.success){a(f.msg||"添加失败");return;}0;a("添加成功");
window.location.href=backUrl;});});});