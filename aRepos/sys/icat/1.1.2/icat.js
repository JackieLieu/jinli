/*!
 * Copyright 2011~2012, ICAT JavaScript Library v1.1.2
 * MIT Licensed
 * @Author valleykiddy@gmail.com
 * @Time 2012-08-13 14:50:00
 */
(function(f,e){if(e[f]===undefined){e[f]={}}f=e[f];var j=navigator.userAgent,o=/debug/i.test(window.location.href),g=function(i){return !i?false:i.constructor===Function},a={loadStore:{},modStore:{},mods:{},browser:{uc:/UC/i.test(j),safari:/webkit/i.test(j),opera:/opera/i.test(j),msie:/msie/i.test(j)&&!/opera/i.test(j),mozilla:/mozilla/i.test(j)&&!/(compatible|webkit)/i.test(j)},foreach:function(z,t,w){var v,x=0,y=z.length,u=y===undefined||g(z);if(w){if(u){for(v in z){if(t.apply(z[v],w)===false){break}}}else{for(;x<y;){if(t.apply(z[x++],w)===false){break}}}}else{if(u){for(v in z){if(t.call(z[v],v,z[v])===false){break}}}else{for(;x<y;){if(t.call(z[x],x,z[x++])===false){break}}}}},mix:function(y,w,A,v){if(!w||!y){return y}if(v===undefined){v=true}var u,z,t,x=function(D,C,B,i){if(i||!(D in C)){C[D]=B[D]}};if(A&&(t=A.length)){for(u=0;u<t;u++){z=A[u];if(z in w){x(z,y,w,v)}}}else{for(z in w){x(z,y,w,v)}}return y}};a.mix(f,a);delete a;var s=document,d=s.getElementsByTagName("script"),n=s.getElementsByName("appRef")[0],r=n.getAttribute("uc-wdpi")||"480|360",l,h,k,c="";f.appRef=n?n.content:"";if(f.browser.uc){var q=s.getElementsByName("viewport")[0],r=r.split("|"),m=q.content;q.content=m.replace(/device-width/i,r[0]).replace(/device-dpi/i,r[1])}for(var p=0,b;b=d[p++];){k=!!s.querySelector?b.src:b.getAttribute("src",4);if(k&&/icat(\.source)?\.js/i.test(k)){if(/\?(v|t)=\d+/.test(k)){c="?"+k.replace(/.*\?/,"")}f.sysRef=k.substr(0,k.lastIndexOf("/icat/"));l=b.getAttribute("corelib");h=b.getAttribute("main");break}}f.mix(f,{version:"1.1.2",isIE:f.browser.msie,ieVersion:f.browser.msie?j.match(/MSIE(\s)?\d+/i)[0].replace(/MSIE(\s)?/i,""):-1,isDebug:o,__APP_MEMBERS:["namespace"],__APP_INIT_METHODS:["__init"],__init:function(){var i=this;i.widget={};i.util={};i.sysPlugin=i.sysRef+"/icat/"+i.version+"/plugin/";i.appPlugin=i.appRef+"/assets/plugin/";i.jqPath=i.sysRef+"/lib/jquery/1.8.0/";i.timestamp=c;if(l){l=(o&&!/\.source/.test(l)?l.replace(/\.js/,".source.js"):l)+c;l=/^\//.test(l)?l:"/lib/"+l;l=l.replace(/\?.*/,"")+c;l=f.sysRef+l;s.write('<script src="'+l+'"><\/script>');f.loadStore[l.replace(/\?.*/,"")]=true}if(h){h=(o&&!/\.source/.test(h)?h.replace(/\.js/,".source.js"):h)+c;h=/^\//.test(h)?h:"/assets/js/"+h;h=h.replace(/\?.*/,"")+c;h=f.appRef+h;s.write('<script src="'+h+'"><\/script>');f.loadStore[h.replace(/\?.*/,"")]=true}},isFunction:g,isString:function(i){return !i?false:typeof i==="string"},isArray:function(i){return !i?false:i.constructor===Array},namespace:function(){var u=arguments,t=u.length,y=null,w,v,x;for(w=0;w<t;++w){x=(""+u[w]).split(".");y=this;for(v=(e[x[0]]===y)?1:0;v<x.length;++v){y=y[x[v]]=y[x[v]]||{}}}return y},app:function(t,w){var i=this,u=i.isString(t),v=u?e[t]||{}:t;i.mix(v,i,i.__APP_MEMBERS,true);i.mix(v,i.isFunction(w)?w():w);u&&(e[t]=v);return v},log:function(i){if(!this.isDebug){return}if(this.isIE){alert(i)}else{if(e.console!==undefined&&console.log){console.log(i)}}}});f.__init()})("ICAT",this);(function(a){var f=document,g=f.head||f.getElementsByTagName("head")[0],b=a.loadStore,c=a.modStore,e=function(i){if(!i){return}var h=i.replace(/\s/g,"");if(!h){return}if(a.isDebug){h=/\.source/i.test(h)?h:h.replace(/\.js|\.css/g,/\.css/i.test(h)?".source.css":".source.js")}if(/\w?:\/\//.test(h)){return h}else{if(/\.\/(~)?/.test(h)){if(/\.\/\w+/.test(h)){h=h.replace(/\.\//g,a.appRef+"/")}if(/\.\/~/.test(h)){h=h.replace(/\.\/~/g,a.appPlugin)}}else{if(/~\w+/.test(h)){h=h.replace(/~/g,a.sysPlugin)}else{h=a.sysRef+"/"+h}}}return h+a.timestamp},d=function(n,k){if(n.length==0){return}var o={};a.mix(o,k);var i=n[0],m=i.replace(/[\?#].*/,""),h=function(){if(n.length>0){d(n,k)}else{if(o.callback&&a.isFunction(o.callback)){o.callback(o.context||a)}if(o.mod){c[o.mod]=true}}};if(b[m]){h();return}n.shift();var l,p=m.replace(/.*\./g,"");if(p==="css"){l=f.createElement("link");l.setAttribute("type","text/css");l.setAttribute("rel","stylesheet");l.setAttribute("href",i)}else{if(p==="js"){l=f.createElement("script");l.setAttribute("type","text/javascript");l.setAttribute("src",i);l.setAttribute("async",true)}}if(!l){return}if(a.isIE){var j=setInterval(function(){try{document.documentElement.doScroll("left")}catch(q){return}clearInterval(j);if(p==="js"&&l.readyState){l.onreadystatechange=function(){if(l.readyState=="loaded"||l.readyState=="complete"){l.onreadystatechange=null;h();b[m]=true}}}g.appendChild(l)},1)}else{if(p==="js"){l.onload=function(){h();b[m]=true}}g.appendChild(l)}if(p==="css"){h();b[m]=true;g.appendChild(l)}};a.mix(a,{include:function(j,i){if(!j||!j.length){return}var h=[];if(a.isString(j)){h.push(e(j))}else{if(a.isArray(j)){a.foreach(j,function(){h.push(e(this))})}else{return}}d(h,{callback:i})},require:function(j,k,i){if(!j&&!k){return}if(c[j]){if(i){i(a)}}else{var h=[];if(a.isString(k)){h.push(e(k))}else{if(a.isArray(k)){a.foreach(k,function(){h.push(e(this))})}}d(h,{callback:i,mod:j})}},use:function(j,h,l){var k=0,l=l||500,n=setInterval(function(){k+=5;if(k>=l){clearInterval(n);a.require(j,a.mods[j],h)}else{if(c[j]){clearInterval(n);h(a)}}},5)}})})(ICAT);
