/*!
 * Copyright 2011~2012, ICAT JavaScript Library v1.1.1
 * MIT Licensed
 * @Author valleykiddy@gmail.com
 * @Time 2012-08-06 14:00:00
 */
(function(h,k){if(k[h]===undefined){k[h]={}}h=k[h];var m=navigator.userAgent,p=/debug/i.test(window.location.href),b=function(i){return !i?false:i.constructor===Function},n={loadStore:{},modStore:{},mods:{},browser:{uc:/UC/i.test(m),safari:/webkit/i.test(m),opera:/opera/i.test(m),msie:/msie/i.test(m)&&!/opera/i.test(m),mozilla:/mozilla/i.test(m)&&!/(compatible|webkit)/i.test(m)},foreach:function(w,q,t){var s,u=0,v=w.length,r=v===undefined||b(w);if(t){if(r){for(s in w){if(q.apply(w[s],t)===false){break}}}else{for(;u<v;){if(q.apply(w[u++],t)===false){break}}}}else{if(r){for(s in w){if(q.call(w[s],s,w[s])===false){break}}}else{for(;u<v;){if(q.call(w[u],u,w[u++])===false){break}}}}},mix:function(x,v,z,u){if(!v||!x){return x}if(u===undefined){u=true}var t,y,q,w=function(C,B,A,i){if(i||!(C in B)){B[C]=A[C]}};if(z&&(q=z.length)){for(t=0;t<q;t++){y=z[t];if(y in v){w(y,x,v,u)}}}else{for(y in v){w(y,x,v,u)}}return x}};n.mix(h,n);delete n;var o=document,g=o.getElementsByTagName("script"),e=o.getElementsByName("appRef")[0],d,f,a,l="";h.appRef=e?e.content:"";for(var j=0,c;c=g[j++];){a=!!o.querySelector?c.src:c.getAttribute("src",4);if(a&&/icat(\.source)?\.js/i.test(a)){if(/\?(v|t)=\d+/.test(a)){l="?"+a.replace(/.*\?/,"")}h.sysRef=a.substr(0,a.lastIndexOf("/icat/"));d=c.getAttribute("corelib");f=c.getAttribute("main");break}}h.mix(h,{version:"1.1.1",isIE:h.browser.msie,ieVersion:h.browser.msie?m.match(/MSIE(\s)?\d+/i)[0].replace(/MSIE(\s)?/i,""):-1,isDebug:p,__APP_MEMBERS:["namespace"],__APP_INIT_METHODS:["__init"],__init:function(){var i=this;i.widget={};i.util={};i.sysPlugin=i.sysRef+"/icat/"+i.version+"/plugin/";i.appPlugin=i.appRef+"/assets/plugin/";i.jqPath=i.sysRef+"/lib/jquery/1.8.0/";i.timestamp=l;if(d){d=(p&&!/\.source/.test(d)?d.replace(/\.js/,".source.js"):d)+l;d=/^\//.test(d)?d:"/lib/"+d;d=d.replace(/\?.*/,"")+l;d=h.sysRef+d;o.write('<script src="'+d+'"><\/script>');h.loadStore[d.replace(/\?.*/,"")]=true}if(f){f=(p&&!/\.source/.test(f)?f.replace(/\.js/,".source.js"):f)+l;f=/^\//.test(f)?f:"/assets/js/"+f;f=f.replace(/\?.*/,"")+l;f=h.appRef+f;o.write('<script src="'+f+'"><\/script>');h.loadStore[f.replace(/\?.*/,"")]=true}},isFunction:b,isString:function(i){return !i?false:typeof i==="string"},isArray:function(i){return !i?false:i.constructor===Array},namespace:function(){var r=arguments,q=r.length,v=null,t,s,u;for(t=0;t<q;++t){u=(""+r[t]).split(".");v=this;for(s=(k[u[0]]===v)?1:0;s<u.length;++s){v=v[u[s]]=v[u[s]]||{}}}return v},app:function(q,t){var i=this,r=i.isString(q),s=r?k[q]||{}:q;i.mix(s,i,i.__APP_MEMBERS,true);i.mix(s,i.isFunction(t)?t():t);r&&(k[q]=s);return s},log:function(i){if(!this.isDebug){return}if(this.isIE){alert(i)}else{if(k.console!==undefined&&console.log){console.log(i)}}}});h.__init()})("ICAT",this);(function(a){var f=document,g=f.head||f.getElementsByTagName("head")[0],b=a.loadStore,c=a.modStore,e=function(i){if(!i){return}var h=i.replace(/\s/g,"");if(!h){return}if(a.isDebug){h=/\.source/i.test(h)?h:h.replace(/\.js|\.css/g,/\.css/i.test(h)?".source.css":".source.js")}if(/\w?:\/\//.test(h)){return h}else{if(/\.\/(~)?/.test(h)){if(/\.\/\w+/.test(h)){h=h.replace(/\.\//g,a.appRef+"/")}if(/\.\/~/.test(h)){h=h.replace(/\.\/~/g,a.appPlugin)}}else{if(/~\w+/.test(h)){h=h.replace(/~/g,a.sysPlugin)}else{h=a.sysRef+"/"+h}}}return h+a.timestamp};function d(h,j,i){this.loadQueue=h;this.callback=j||function(){};this.mod=i}d.prototype={start:function(){var h=this;if(h.loadQueue.length==0){return}var i=h.loadQueue[0],j=i.replace(/[\?#].*/,""),n=function(q,p){if(q.loadQueue.length>0){q.next()}else{if(q.callback&&a.isFunction(q.callback)){q.callback(p)}if(q.mod){c[q.mod]=true}}};h.loadQueue.shift();if(b[j]){n(h,a);return this}var l,k=k||j.replace(/.*\./g,"");if(k==="css"){l=f.createElement("link");l.setAttribute("type","text/css");l.setAttribute("rel","stylesheet");l.setAttribute("href",i)}else{if(k==="js"){l=f.createElement("script");l.setAttribute("type","text/javascript");l.setAttribute("src",i);l.setAttribute("async",true)}}if(!l){return}if(a.isIE){var m=setInterval(function(){try{document.documentElement.doScroll("left")}catch(o){return}clearInterval(m);if(k==="js"&&l.readyState){l.onreadystatechange=function(){if(l.readyState=="loaded"||l.readyState=="complete"){l.onreadystatechange=null;n(h,a);b[j]=true}}}g.appendChild(l)},1)}else{if(k==="js"){l.onload=function(){n(h,a);b[j]=true}}g.appendChild(l)}if(k==="css"){n(h,a);b[j]=true}},next:function(){var h=this;if(h.loadQueue.length>0){h.start(h.loadQueue[0])}}};a.mix(a,{include:function(k,j){if(!k||!k.length){return}var i=[];if(a.isString(k)){i.push(e(k))}else{if(a.isArray(k)){a.foreach(k,function(){i.push(e(this))})}else{return}}var h=new d(i,j).start();delete h},require:function(k,l,j){if(!k&&!l){return}if(c[k]){if(j){j(a)}}else{var i=[];if(a.isString(l)){i.push(e(l))}else{if(a.isArray(l)){a.foreach(l,function(){i.push(e(this))})}}var h=new d(i,j,k).start();delete h}},use:function(j,h,l){var k=0,l=l||500,n=setInterval(function(){k+=5;if(k>=l){clearInterval(n);a.require(j,a.mods[j],h)}else{if(c[j]){clearInterval(n);h(a)}}},5)}})})(ICAT);
