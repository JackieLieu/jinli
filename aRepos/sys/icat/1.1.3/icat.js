/*!
 * Copyright 2011~2012, ICAT JavaScript Library v1.1.2.b
 * MIT Licensed
 * @Author valleykiddy@gmail.com
 * @Time 2012-09-23 10:00:00
 */
(function(){var l=this;var f=navigator.userAgent,n=/debug/i.test(l.location.href),q=Object.prototype;var m=q.toString,a=Array.isArray;function h(y,w,A,v){if(!w||!y){return y}if(v===undefined){v=true}var u,z,t,x=function(D,C,B,i){if(i||!(D in C)){C[D]=B[D]}};if(A&&(t=A.length)){for(u=0;u<t;u++){z=A[u];if(z in w){x(z,y,w,v)}}}else{for(z in w){x(z,y,w,v)}}return y}function k(z,t,w){var v,x=0,y=z.length,u=y===undefined||e.isFunction(z);if(w){if(u){for(v in z){if(t.apply(z[v],w)===false){break}}}else{for(;x<y;){if(t.apply(z[x++],w)===false){break}}}}else{if(u){for(v in z){if(t.call(z[v],v,z[v])===false){break}}}else{for(;x<y;){if(t.call(z[x],x,z[x++])===false){break}}}}}var e=function(){var u=arguments,i=u.length;if(i==0){return null}if(i==1){var t=u[0];if(t!==Object(t)){return null}else{var v=t.Create,x=v.prototype;k(t,function(z,y){if(z!="Create"){x[z]=y}});return v}}if(i>=2){var w=u[0],t=u[1];if(m.call(w)!="[object String]"||t!==Object(t)){return null}else{l[w]=t.Create;var x=l[w].prototype;k(t,function(z,y){if(z!="Create"){x[z]=y}})}}};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=e}exports.ICAT=e}else{l.ICAT=e}e.browser={uc:/UC/i.test(f),safari:/webkit/i.test(f),opera:/opera/i.test(f),msie:/msie/i.test(f)&&!/opera/i.test(f),mozilla:/mozilla/i.test(f)&&!/(compatible|webkit)/i.test(f)};var s=document,d=s.getElementsByTagName("script"),r=s.getElementsByName("appRef")[0],o,c="";e.appRef=r?r.content:"";e.corecss=r?(r.getAttribute("corecss")||""):"";for(var p=0,b;b=d[p++];){o=!!s.querySelector?b.src:b.getAttribute("src",4);if(o&&/icat(\.source)?\.js/i.test(o)){var g=/icat\/\d+\.+/.test(o),j;if(g){j="/icat/"}else{j=r?(r.getAttribute("icatreg")||"/icat."):"/icat."}if(/\?(v|t)=\d+/.test(o)){c="?"+o.replace(/.*\?/,"")}e.refFile=b;e.sysRef=o.substr(0,o.lastIndexOf(j));e.libRef=e.sysRef+"/lib";break}}h(e,{version:"1.1.2.b",isIE:e.browser.msie,ieVersion:e.browser.msie?f.match(/MSIE(\s)?\d+/i)[0].replace(/MSIE(\s)?/i,""):-1,isDebug:n,__APP_MEMBERS:["namespace"],__APP_INIT_METHODS:["__init"],__init:function(){var t=this,i=/^\.{2}\//.test(e.refFile.getAttribute("main")||"");t.widget={};t.util={};t.sysPlugin=t.refFile.src.replace(/icat\..*/,"")+"plugin/";t.appPlugin=t.appRef+(i?"/assets":"")+"/plugin/";t.timestamp=c;t.loadStore={};t.modStore={};t.mods={}},isFunction:function(i){return m.call(i)=="[object Function]"},isString:isString=function(i){return m.call(i)=="[object String]"},isArray:a||function(i){return m.call(i)=="[object Array]"},isNull:function(i){return i===null},foreach:k,mix:h,namespace:function(){var u=arguments,t=u.length,y=null,w,v,x;for(w=0;w<t;++w){x=(""+u[w]).split(".");y=this;for(v=(l[x[0]]===y)?1:0;v<x.length;++v){y=y[x[v]]=y[x[v]]||{}}}return y},app:function(t,w){var i=this,u=i.isString(t),v=u?l[t]||{}:t;i.mix(v,i,i.__APP_MEMBERS,true);i.mix(v,i.isFunction(w)?w():w);u&&(l[t]=v);return v},log:function(i){if(!this.isDebug){return}if(this.isIE){alert(i)}else{if(l.console!==undefined&&console.log){console.log(i)}}}});e.__init()}).call(this);(function(d){var i=document,a=i.head||i.getElementsByTagName("head")[0],k=d.loadStore,g=d.modStore,f=function(p){if(!p){return}var n=p.replace(/\s|[\?#].*/g,""),o=n.replace(/.*\./g,""),l=o=="css";if(!n){return}if(d.isDebug){n=/\.source/i.test(n)?n:(l?n.replace(/\.css/g,".source.css"):n.replace(/\.js/g,".source.js"))}if(/^(http|ftp|https):\/\/.*/i.test(n)){return n}else{if(/^\.(\.|~)?\//g.test(n)){if(/^\.\//.test(n)){n=n.replace(/^\./,d.appRef)}if(/^\.{2}\//.test(n)){n=n.replace(/^\.{2}/,d.appRef+(l?"/assets/css":"/assets/js"))}if(/^\.~\//.test(n)){n=n.replace(/^\.~\//,d.appPlugin)}}else{if(/^\/{1,2}/.test(n)){if(/^\/{2}/.test(n)){var m=n.replace(/^\/{2}|.source|.css|.js/ig,"");m=/\d|\./.test(m)?m.replace(/\d(\/)?|\./g,""):m;n=n.replace(/^\//,d.libRef+"/"+m)}else{n=n.replace(/^\//,d.libRef+"/")}}else{if(/^~\//.test(n)){n=n.replace(/^~\//,d.sysPlugin)}else{n=d.sysRef+"/"+n}}}}return n+d.timestamp},e=function(s){var o=s,p=o.replace(/[\?#].*/,"");if(k[p]){return}var q=p.replace(/.*\./g,""),n=q=="css",m=n?"link":"script",l=n?' type="text/css" rel="stylesheet"':' type="text/javascript"',r=(n?"href":"src")+'="'+o+'"';i.write("<"+m+l+r+(n?"/>":"></"+m+">"));k[p]=true},h=function(q,u,t,o){var m=q,r=m.replace(/[\?#].*/,""),l=function(){if(u&&d.isFunction(u)){u(o||d)}if(t){g[t]=true;d.mods[t]=d.mods[t]&&d.mods[t].length?d.mods[t]:[];d.mods[t].push(q)}};if(k[r]){l();return}var p,s=r.replace(/.*\./g,"");if(s==="css"){p=i.createElement("link");p.setAttribute("type","text/css");p.setAttribute("rel","stylesheet");p.setAttribute("href",m)}else{if(s==="js"){p=i.createElement("script");p.setAttribute("type","text/javascript");p.setAttribute("src",m);p.setAttribute("async",true)}}if(!p){return}if(d.isIE){var n=setInterval(function(){try{document.documentElement.doScroll("left")}catch(v){return}clearInterval(n);if(s==="js"&&p.readyState){p.onreadystatechange=function(){if(p.readyState=="loaded"||p.readyState=="complete"){p.onreadystatechange=null;l();k[r]=true}}}a.appendChild(p)},1)}else{if(s==="js"){p.onload=function(){l();k[r]=true}}a.appendChild(p)}if(s==="css"){l();k[r]=true;a.appendChild(p)}};d.mix(d,{inc:function(m){if(!m){return}var l=d.isString(m)?[m]:m;d.foreach(l,function(o,n){if(!n){return}e(f(n))})},incfile:function(n,m){if(!n||!n.length){return}if(d.isString(n)){h(f(n),m)}else{if(d.isArray(n)){var l=n.length-1;d.foreach(n,function(p,o){p==l?h(f(o),m):h(f(o))})}}},require:function(o,p,n){if(!o&&!p){return}if(g[o]){if(n){n(d)}}else{if(d.isString(p)){h(f(p),n,o)}else{if(d.isArray(p)){var l=p.length-1;d.foreach(p,function(q,m){q==l?h(f(m),n,o):h(f(m),undefined,o)})}}}},use:function(n,l,p){var o=0,p=p||500,q=setInterval(function(){o+=5;if(o>=p){clearInterval(q);d.require(n,d.mods[n],l)}else{if(g[n]){clearInterval(q);l(d)}}},5)}});var c=d.refFile.getAttribute("corelib")||"",b=d.refFile.getAttribute("main")||"",j=[];if(/,/.test(c)){c=c.split(",");j=[].concat(j,c);j=[].concat(j,[d.corecss,b])}else{j=[].concat(j,[d.corecss,c,b])}d.inc(j)})(ICAT);
