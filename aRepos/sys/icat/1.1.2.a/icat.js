/*!
 * Copyright 2011~2012, ICAT JavaScript Library v1.1.2.a
 * MIT Licensed
 * @Author valleykiddy@gmail.com
 * @Time 2012-08-20 19:10:00
 */
(function(f,j){if(j[f]===undefined){j[f]={}}f=j[f];var l=navigator.userAgent,p=/debug/i.test(window.location.href),b=function(i){return !i?false:i.constructor===Function},m={loadStore:{},modStore:{},mods:{},browser:{uc:/UC/i.test(l),safari:/webkit/i.test(l),opera:/opera/i.test(l),msie:/msie/i.test(l)&&!/opera/i.test(l),mozilla:/mozilla/i.test(l)&&!/(compatible|webkit)/i.test(l)},foreach:function(w,q,t){var s,u=0,v=w.length,r=v===undefined||b(w);if(t){if(r){for(s in w){if(q.apply(w[s],t)===false){break}}}else{for(;u<v;){if(q.apply(w[u++],t)===false){break}}}}else{if(r){for(s in w){if(q.call(w[s],s,w[s])===false){break}}}else{for(;u<v;){if(q.call(w[u],u,w[u++])===false){break}}}}},mix:function(x,v,z,u){if(!v||!x){return x}if(u===undefined){u=true}var t,y,q,w=function(C,B,A,i){if(i||!(C in B)){B[C]=A[C]}};if(z&&(q=z.length)){for(t=0;t<q;t++){y=z[t];if(y in v){w(y,x,v,u)}}}else{for(y in v){w(y,x,v,u)}}return x}};m.mix(f,m);m=null;var o=document,e=o.getElementsByTagName("script"),d=o.getElementsByName("appRef")[0],a,k="";f.appRef=d?d.content:"";f.corecss=d?(d.getAttribute("corecss")||""):"";for(var g=0,c;c=e[g++];){a=!!o.querySelector?c.src:c.getAttribute("src",4);if(a&&/icat(\.source)?\.js/i.test(a)){var h=/icat\/\d+\.+/.test(a),n;if(h){n="/icat/"}else{n=d?(d.getAttribute("icatreg")||"/icat."):"/icat."}if(/\?(v|t)=\d+/.test(a)){k="?"+a.replace(/.*\?/,"")}f.refFile=c;f.sysRef=a.substr(0,a.lastIndexOf(n));f.libRef=f.sysRef+"/lib";break}}f.mix(f,{version:"1.1.2.a",isIE:f.browser.msie,ieVersion:f.browser.msie?l.match(/MSIE(\s)?\d+/i)[0].replace(/MSIE(\s)?/i,""):-1,isDebug:p,__APP_MEMBERS:["namespace"],__APP_INIT_METHODS:["__init"],__init:function(){var q=this,i=/^\.{2}\//.test(f.refFile.getAttribute("main")||"");q.widget={};q.util={};q.sysPlugin=q.refFile.src.replace(/icat\..*/,"")+"plugin/";q.appPlugin=q.appRef+(i?"/assets":"")+"/plugin/";q.timestamp=k},isFunction:b,isString:function(i){return !i?false:typeof i==="string"},isArray:function(i){return !i?false:i.constructor===Array},namespace:function(){var r=arguments,q=r.length,v=null,t,s,u;for(t=0;t<q;++t){u=(""+r[t]).split(".");v=this;for(s=(j[u[0]]===v)?1:0;s<u.length;++s){v=v[u[s]]=v[u[s]]||{}}}return v},app:function(q,t){var i=this,r=i.isString(q),s=r?j[q]||{}:q;i.mix(s,i,i.__APP_MEMBERS,true);i.mix(s,i.isFunction(t)?t():t);r&&(j[q]=s);return s},extend:function(i,q){self.mix(self,{name:q})},register:function(i,r,q){f.mix(r.option,q);self.widget[i]=r.init},log:function(i){if(!this.isDebug){return}if(this.isIE){alert(i)}else{if(j.console!==undefined&&console.log){console.log(i)}}}});f.__init()})("ICAT",this);(function(e){var i=document,a=i.head||i.getElementsByTagName("head")[0],j=e.loadStore,h=e.modStore,g=function(o){if(!o){return}var m=o.replace(/\s|[\?#].*/g,""),n=m.replace(/.*\./g,""),k=n=="css";if(!m){return}if(e.isDebug){m=/\.source/i.test(m)?m:(k?m.replace(/\.css/g,".source.css"):m.replace(/\.js/g,".source.js"))}if(/^(http|ftp|https):\/\/.*/i.test(m)){return m}else{if(/^\.(\.|~)?\//g.test(m)){if(/^\.\//.test(m)){m=m.replace(/^\./,e.appRef)}if(/^\.{2}\//.test(m)){m=m.replace(/^\.{2}/,e.appRef+(k?"/assets/css":"/assets/js"))}if(/^\.~\//.test(m)){m=m.replace(/^\.~\//,e.appPlugin)}}else{if(/^\/{1,2}/.test(m)){if(/^\/{2}/.test(m)){var l=m.replace(/^\/{2}|.source|.css|.js/ig,"");m=m.replace(/^\//,e.libRef+"/"+l)}else{m=m.replace(/^\//,e.libRef+"/")}}else{if(/^~\//.test(m)){m=m.replace(/^~\//,e.sysPlugin)}else{m=e.sysRef+"/"+m}}}}return m+e.timestamp},f=function(r){var n=r,o=n.replace(/[\?#].*/,"");if(j[o]){return}var p=o.replace(/.*\./g,""),m=p=="css",l=m?"link":"script",k=m?' type="text/css" rel="stylesheet"':' type="text/javascript"',q=(m?"href":"src")+'="'+n+'"';i.write("<"+l+k+q+(m?"/>":"></"+l+">"));j[o]=true},d=function(q,n){if(q.length==0){return}var r={};e.mix(r,n);var l=q[0],p=l.replace(/[\?#].*/,""),k=function(){if(q.length>0){d(q,n)}else{if(r.callback&&e.isFunction(r.callback)){r.callback(r.context||e)}if(r.mod){h[r.mod]=true}}};if(j[p]){k();return}q.shift();var o,s=p.replace(/.*\./g,"");if(s==="css"){o=i.createElement("link");o.setAttribute("type","text/css");o.setAttribute("rel","stylesheet");o.setAttribute("href",l)}else{if(s==="js"){o=i.createElement("script");o.setAttribute("type","text/javascript");o.setAttribute("src",l);o.setAttribute("async",true)}}if(!o){return}if(e.isIE){var m=setInterval(function(){try{document.documentElement.doScroll("left")}catch(t){return}clearInterval(m);if(s==="js"&&o.readyState){o.onreadystatechange=function(){if(o.readyState=="loaded"||o.readyState=="complete"){o.onreadystatechange=null;k();j[p]=true}}}a.appendChild(o)},1)}else{if(s==="js"){o.onload=function(){k();j[p]=true}}a.appendChild(o)}if(s==="css"){k();j[p]=true;a.appendChild(o)}};e.mix(e,{inc:function(l){if(!l){return}var k=e.isString(l)?[l]:l;e.foreach(k,function(n,m){if(!m){return}f(g(m))})},include:function(m,l){if(!m||!m.length){return}var k=[];if(e.isString(m)){k.push(g(m))}else{if(e.isArray(m)){e.foreach(m,function(o,n){k.push(g(n))})}else{return}}d(k,{callback:l})},require:function(n,o,l){if(!n&&!o){return}if(h[n]){if(l){l(e)}}else{var k=[];if(e.isString(o)){k.push(g(o))}else{if(e.isArray(o)){e.foreach(o,function(p,m){k.push(g(m))})}}d(k,{callback:l,mod:n})}},use:function(l,k,o){var n=0,o=o||500,p=setInterval(function(){n+=5;if(n>=o){clearInterval(p);e.require(l,e.mods[l],k)}else{if(h[l]){clearInterval(p);k(e)}}},5)}});var c=e.refFile.getAttribute("corelib")||"",b=e.refFile.getAttribute("main")||"";e.inc([e.corecss,c,b])})(ICAT);(function(a){a.tempCache={};a.mix(a,{template:function(e,d){var b=a.tempCache,c=!/\W/.test(e)?b[e]=b[e]||this.temp(document.getElementById(e).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g,"").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return d?c(d):c},mergeTemp:function(b,f,c){if(!a.isString(b)||!/\{|\}/g.test(b)){return}var e=b.match(/\{\w+\}/g);if(!e.length){return}a.foreach(e,function(){var d=this.replace(/\{|\}/g,""),h=new RegExp("{"+d+"}"),g=f[d];b=b.replace(h,g?g:(c?"{"+d+"}":""))});return b},form2str:function(g){if(!g){return}var b="";for(var f=0,e=g.elements,d=e.length;f<d;f++){var c=$(e[f]);if(c.attr("name")){b+="&"+c.attr("name")+"="+e[f].value}}b=b.replace("&","?");return b},form2json:function(f){if(!f){return}var g={};for(var e=0,d=f.elements,c=d.length;e<c;e++){var b=$(d[e]);if(b.attr("name")){g[b.attr("name")]=d[e].value}}return g}})})(ICAT);
