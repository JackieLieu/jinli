(function(a,b){a.inc([".~/tempcore.js",".~/jtouchSwipe.js"]);a.app("GNG",function(){return{version:"0.8"}});a.mix(GNG,{init:function(){var c=this;c.slideAjax().dialog();c.slideImg().tabType();c.linkage();c.skipPage();c.scrollAjax();b(".J_showPwd input[type=checkbox]").click(function(){var e=b(".JS-showPwd"),d=e.prev("input");e.val(d.val());if(this.checked){e.show();d.hide()}else{e.hide();d.show()}e.change(function(){d.val(this.value)});d.change(function(){e.val(this.value)})})},linkage:function(){var c=b(".J_areaWrap"),d=c.find("select");if(!c[0]){return this}a.include([".~/dataArea.js",".~/linkage.js"],function(){a.widget.linkage({isArea:true,areaWrap:c,s1:d.eq(0),s2:d.eq(1),s3:d.eq(2),aNode:c.attr("old-aNode")||""})});return this},slideImg:function(){if(!b(".isTouch")[0]){return this}a.include(["../slideImg.js"],function(){b("#mainfocus").SlideImg({auto:true,loop:true});b(".J_scrollPro").SlideImg({css3:true})});return this},slideAjax:function(){var g=b(".J_slideAjax[data-ajaxUrl]"),f;if(!g[0]){return this}function e(k,i){var j=k.width();k.swipe({swipeStatus:function(x,v,t,l,s){var r=b(this),n=b(x.target).parents(".J_slideItem"),p=parseInt(n.attr("pid")),q=n.attr("hasnext");if(v=="start"){var m=new Date();s_time=m.getTime()}else{if(v=="move"){var y=r.find(".J_slideItem"),w=Math.round(100*l/j),o=100-w;if(t=="left"){if(q=="true"){y.eq(p-1).css("left",-w+"%");y.eq(p).css("left",o+"%")}}else{if(t=="right"){if(p!=1){y.eq(p-1).css("left",w+"%");y.eq(p-2).css("left",-o+"%")}}}}else{if(v=="cancel"){var m=new Date();e_time=m.getTime();var y=r.find(".J_slideItem"),w=Math.round(100*l/j);if(t=="right"){y.eq(p-1).animate({left:"0%"},500);y.eq(p-2).animate({left:"-100%"},500)}else{if(q=="true"){y.eq(p-1).animate({left:"0%"},500);y.eq(p).animate({left:"100%"},500)}}}else{if(v=="end"){var y=r.find(".J_slideItem"),w=Math.round(100*l/j);if(p!=1&&t=="right"){if(w>=25){y.eq(p-1).animate({left:"100%"},300);y.eq(p-2).animate({left:"0%"},300);var u=k.next(".J_slideSpan").find("span");u.removeClass("selected");u.eq(p-2).addClass("selected")}}else{if(q=="true"&&t=="left"){if(w>=25){y.eq(p-1).animate({left:"-100%"},300);y.eq(p).animate({left:"0%"},300);var u=k.next(".J_slideSpan").find("span");u.removeClass("selected");u.eq(p).addClass("selected")}}}}}}}},threshold:j/4,triggerOnTouchEnd:true,allowPageScroll:"vertical"})}function d(i){b.post(c,{token:token,page:i},function(j){var k=j;g.append(template("J_itemView",k));if(k.data.hasnext){d(i+1)}},"json")}function h(l,m,i){if(f&&m>f){return}if(!i){i="left"}var k=l.find(".J_slideItem");if(i=="left"){if(k.eq(m-1)[0]){var j=k.eq(m-1);j.animate({left:"0%"},500);k.eq(m-2).animate({left:"-100%"},500);l.height(j.attr("wrapHeight"))}else{b.post(c,{token:token,page:m},function(p){var q=b.parseJSON(p);if(!q.data.hasnext){f=m}l.append('<div class="J_slideItem loading" style="left:100%;"><img src="'+a.appRef+'/assets/img/loading.gif" alt="" /></div>');b(".J_slideItem.loading").replaceWith(template("J_itemView",q));var o=l.find(".J_slideItem"),n=o.eq(m-1).height();o.eq(m-1).animate({left:"0%"},500).attr("wrapHeight",n);o.eq(m-2).animate({left:"-100%"},500);l.height(n);if(!q.data.hasnext){o.eq(m-1).find(".r").addClass("disable")}})}}else{if(m>0&&i=="right"){var j=k.eq(m-1);k.eq(m).animate({left:"100%"},500);j.animate({left:"0%"},500);l.height(j.attr("wrapHeight"))}}}var c=g.attr("data-ajaxUrl");b.post(c,{token:token,page:1},function(l){var o=b.parseJSON(l);g.append(template("J_itemView",o));var m=g.find(".J_slideItem"),k=m.height();g.find(".J_slideItem").css("left","0%").attr("wrapHeight",k);g.height(k);if(g.find(".handle")[0]){if(!o.data.hasnext){g.find(".handle").addClass("disable");return}g.find(".handle").live("click",function(){var i=parseInt(b(this).parents(".J_slideItem").attr("pid"));b(this).hasClass("r")?h(g,i+1):h(g,i-1,"right")}).eq(0).addClass("disable");return}if(o.data.hasnext){d(2);e(g);if(g.next(".J_slideSpan")[0]){var n="";for(var j=0;j<o.data.total;j++){n+="<span"+(j==0?' class="selected"':"")+"></span>"}g.next(".J_slideSpan").html(n)}}});window.onorientationchange=window.onresize=window.onorientation=function(){var j=g.find(".J_slideItem"),i=g.width();j.each(function(){this.style.width=i+"px"})};return this},skipPage:function(){b(".J_skipLeft, .J_skipRight").swipe({swipe:function(c,h,i,g,d){var f=b(this),e=f.attr("data-toUrl");if(f.hasClass("J_skipLeft")){if(h=="left"){location.href=e}}if(f.hasClass("J_skipRight")){if(h=="right"){location.href=e}}},allowPageScroll:"vertical"})},dialog:function(){var d=b(document).width(),g=b(document).height(),f=b(".J_dialogBox"),c=f.width(),e=(d-c)/2;b(".J_showDialog").click(function(h){h.preventDefault();if(this.getAttribute("data-ajaxUrl")){var i=this.getAttribute("data-ajaxUrl");b.post(i,{token:token},function(j){var k=b.parseJSON(j);f.find("p").html(k.msg);if(k.success){f.find(".btn a").removeAttr("href")}f.css("left",e+"px").show().find(".btn a").live("click",function(){b(".JS-dbMask").hide();f.hide()});b(".JS-dbMask").height(g).show().live("click",function(){this.style.display="none";f.hide()})})}else{f.css("left",e+"px").show().find(".btn span").bind("click",function(){b(".JS-dbMask").hide();f.hide()});b(".JS-dbMask").height(g).show().bind("click",function(){this.style.display="none";f.hide()})}});b(".form-box form").submit(function(h){h.preventDefault();var l=b(this),i=l.attr("action"),k=this.elements,j={};a.foreach(k,function(o,m){var n=b(m);if(n.attr("name")){if(n.attr("type")=="radio"){if(m.checked){j[n.attr("name")]=m.value}}else{j[n.attr("name")]=m.value}}});a.mix(j,{token:token});b.post(i,j,function(m){var n=b.parseJSON(m);if(n.success){if(n.data.type=="redirect"&&n.data.url){location.href=n.data.url}return}f.find("p").html(n.msg);l.find("input").blur();f.css("left",e+"px").show().find(".btn span").live("click",function(){b(".JS-dbMask").hide();f.hide()});b(".JS-dbMask").height(g).show().live("click",function(){this.style.display="none";f.hide()})})});return this},tabType:function(){var c=b(".JS-tabItem");c.each(function(){var d=b(this),h=d.find("li"),e=d.attr("data-ajaxUrl"),g=d.next(".JS-tabMain");h.click(function(){var j=b(this),i=j.attr("data-type");j.addClass("selected").siblings("li").removeClass("selected");if(g.find(".pictext[type="+i+"]")[0]){g.find(".pictext[type="+i+"]").show().siblings(".pictext").hide()}else{b.post(e,{token:token,type:i},function(k){var l=b.parseJSON(k);l=a.mix(l,{type:i});g.append(template("J_itemView",l));g.find(".pictext").css({position:"static"}).hide();g.find(".pictext[type="+i+"]").show()})}});var f=h.eq(0).attr("data-type");b.post(e,{token:token,type:f},function(i){var j=b.parseJSON(i);j=a.mix(j,{type:f});g.append(template("J_itemView",j));g.find(".pictext").css({position:"static"})})})},scrollAjax:function(){if(!b(".JS-loadMore")[0]){return this}var e=b("#page"),d=e.attr("data-ajaxUrl"),c=e.find(".JS-loadMore");function f(){var h=parseInt(e.attr("data-curPage"))+1,g=e.find("input[name=keyword]").val();if(c.hasClass("disabled")){return}c.html('<a><img src="'+a.appRef+'/assets/img/loading.gif" alt="" /></a>');b.post(d,{token:token,page:h,keyword:g},function(i){var j=b.parseJSON(i);e.attr("data-curPage",h).find(".item-list ul, .item-grid ul").append(template("J_itemView",j));c.html('<a href="">\u70b9\u51fb\u52a0\u8f7d\u66f4\u591a</a>');if(!j.data.hasnext){c.addClass("disabled");e.addClass("disabled")}})}e.swipe({swipe:function(g,j,k,i,h){if(e.hasClass("disabled")){return}if(j=="up"&&k>=30){f()}},allowPageScroll:"auto"});c.bind("click",function(g){g.preventDefault();f()});b(window).bind("scroll",function(){var g=parseFloat(b(window).height())+parseFloat(b(window).scrollTop());if(b(document).height()<=g){f()}})}});b(function(){GNG.init()})})(ICAT,jQuery);
