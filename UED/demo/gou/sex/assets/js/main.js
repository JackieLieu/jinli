(function(a,b){a.app("Gsex");a.mix(Gsex,{init:function(){a.include({files:["./lib/zepto","./lib/iscroll"],callback:function(){if($(".J_tjList")[0]){Gsex.loaded()}if($(".comments")[0]){Gsex.commentMore()}},isCombo:true})},loadMore:function(f){var e=$(".J_tjList"),h=e.attr("data-ajaxurl"),g=e.attr("data-curpage")||1,c=e.attr("data-hasnext")==="true",d=parseInt(g)+1,i="";if(c&&f["page"+d]===b){i=(a.contains(h,"?")?"&":"?")+"page="+d;f["page"+d]=false;$.post(h+i,function(l){var k="",j=JSON.parse(l);if(j.success){a.foreach(j.data.list,function(m){k+='<li>										<a href="'+m.link+'">											<div class="pic">												<img src="'+m.img+'" alt="'+m.title+'">												<span class="price">￥'+m.price+'</span>											</div>											<div class="desc">'+m.title+"</div>										</a>									</li>"});e.find("ul").append(k);e.attr("data-hasnext",j.data.hasnext).attr("data-curpage",d);if(!j.data.hasnext){$("#pullUp").hide()}f["page"+d]=true;f.refresh()}})}else{f.refresh()}},pullUpAction:function(d){var c=this;setTimeout(function(){c.loadMore(d)},500)},loaded:function(){var c=this,f,e=$("#pullUp"),h=e[0],d=e.find("span.pullUpLabel"),g=$(".J_tjList");f=new iScroll("iScroll",{scrollbarClass:"myScrollbar",pullLock:true,useTransition:true,onRefresh:function(){if(e.hasClass("loading")){h.className="";d.html("滑动加载更多...")}},onScrollMove:function(){if(g.attr("data-hasnext")!=="true"){return}if(this.y<(this.maxScrollY-5)&&!e.hasClass("flip")){h.className="flip";d.html("松开后加载...");this.maxScrollY=this.maxScrollY}else{if(this.y>(this.maxScrollY+5)&&e.hasClass("flip")){h.className="";d.html("滑动加载更多...");this.maxScrollY=h.offsetHeight}}},onTouchEnd:function(){if(g.attr("data-hasnext")!=="true"){return}if(h.className.match("flip")){h.className="loading";d.html("加载中...");c.pullUpAction(f)}}});setTimeout(function(){$("#iScroll").css("left",0)},800)},commentMore:function(){var e=$("#content"),g=$(window),f=$(".comments"),d=e.attr("data-ajaxurl")||"",c='<%for(var i=0, lists=data.list, len=lists.length; i<len; i++){%>						<div class="item">							<div class="user-inf">								<em><%=lists[i].username%>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<%=lists[i].create_time%></em>								<span><%=lists[i].num%>楼</span>							</div>							<p><%=lists[i].content%></p>						</div>						<%}%>';g.on("scroll",function(){if(Gsex.ajaxEnd===false||Gsex.__comment_hasnext===false){return}var j=document.body.scrollTop,h=g.height(),i=e.height();console.log(j+" "+h+" "+i);if(j+h===i){Gsex.ajaxEnd=false;$.get(Gsex.__comment_ajaxurl||d,function(m){var l=m&&a.isString(m)?(/(.+:.+,?){1,}/.test(m)?JSON.parse(m):null):m,k="";Gsex.ajaxEnd=true;if(l){var n=l.data||{};n.curpage||(n.curpage=1);Gsex.__comment_hasnext=n.hasnext;Gsex.__comment_ajaxurl=d+"&page="+(n.curpage+1);if(l.success){k=a.render(c,l);f.append(k)}}})}})}});Gsex.init()})(ICAT);