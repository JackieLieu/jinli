/*! call 2015-07-09 */
define(["./zepto","./ajax","./scrollfix","./dialog","./tab"],function(){function a(a,b){_hmt=window._hmt||[],_hmt.push(["_trackEvent","gnnav-ucenter",a,b])}function b(a){$(".toast-wrap").show(),$(".toast-wrap p").html(a),setTimeout(function(){$(".toast-wrap").hide(),$(".toast-wrap p").html("")},1e3)}function c(b,c){return/^\d{5,14}$/.test($("#award-qq").val())?($("#js-error-tips").html(""),$("#award-detail-page #ui-actionsheet-text").html("您确定为QQ号码为"+$("#award-qq").val()+"进行充值？"),$("#triggerDialog").trigger("tap"),$(".gt_widget").css({visibility:"hidden"}),void $("#award-detail-page #js-actionsheet-ok").off("tap").on("tap",function(){var b=__config__.token,d=__config__.awardUrl,e=$("#award-qq").data("id");$.ajax({url:d,type:"post",dataType:"json",data:{token:b,number:$("#award-qq").val(),goods_id:e,geetest_challenge:c.challenge,geetest_validate:c.validate,geetest_seccode:c.seccode},success:function(b){b.success?(a("个人中心-兑换奖品次数","个人中心-兑换话费成功次数"),b.data.redirect&&(location.href=b.data.redirect)):($("#award-detail-page .ui-actionsheet-cancel").trigger("tap"),$("#js-error-tips").html(b.msg))}})})):($("#js-error-tips").html("请输入有效的QQ号码"),void f())}function d(b,c){var d=__config__.token,e=__config__.awardUrl;$.ajax({url:e,type:"post",dataType:"json",data:{token:d,geetest_challenge:c.challenge,geetest_validate:c.validate,geetest_seccode:c.seccode},success:function(b){b.success?(a("个人中心-兑换奖品次数","个人中心-兑换券成功次数"),b.data.redirect&&(location.href=b.data.redirect)):(f(),$("#js-error-tips").html(b.msg))}})}function e(b,c){var d=__config__.token,e=__config__.awardUrl,f=$("#award-tel"),g=f.val(),h=0,i=/\d{11}/g;return h=f.data("id"),i.test(f.val())?($("#js-error-tips").html(""),void $.ajax({url:f.data("url"),type:"get",dataType:"json",data:{mobile:g,goods_id:h},success:function(b){if(b.success){$("#award-detail-page #ui-actionsheet-text").html("您确定为"+b.data.area+g+"充值"+b.data.outprice+"元？"),$("#triggerDialog").trigger("tap");var f,i=!1,j=+new Date,k=1;$(".gt_widget").css({visibility:"hidden"}),$("#award-detail-page #js-actionsheet-ok").off("tap").on("tap",function(){if(f=+new Date-j,1!=k&&(i===!0||1e4>f))return++k,void(j=+new Date);++k;{var l=b.data.inprice;b.data.area}$.ajax({url:e,type:"post",dataType:"json",data:{token:d,number:g,goods_id:h,inprice:l,geetest_challenge:c.challenge,geetest_validate:c.validate,geetest_seccode:c.seccode},success:function(b){b.success?(i=!0,a("个人中心-兑换奖品次数","个人中心-兑换话费成功次数"),b.data.redirect&&(location.href=b.data.redirect)):($("#award-detail-page .ui-actionsheet-cancel").trigger("tap"),$("#js-error-tips").html(b.msg))}})})}else $("#js-error-tips").html(b.msg)}})):void $("#js-error-tips").html("请输入有效的电话号码")}function f(){$(".gt_refresh_button")[0]&&($(".gt_widget").css({visibility:"hidden"}),$(".gt_refresh_button")[0].click())}function g(){$(".gt_ads_bg,.gt_ads_tips").live(h,function(a){a.preventDefault()})}var h="touchstart"in window?"tap":"click";$("#award-page #js-actionsheet-ok").off(h).on(h,function(){$("#award-page .ui-actionsheet-cancel").trigger("tap")}),$(".ui-award-item .btn span").on(h,function(){a("个人中心-立即兑换点击次数","个人中心-立即兑换点击次数");var b=$(this),c=b.data("url"),d=b.data("type"),e=b.data("refurl");b.hasClass("done")||$.ajax({url:c,type:"get",data:{score_type:d,refurl:e},dataType:"json",success:function(a){a.success?a.data.redirect&&(location.href=a.data.redirect):($(".js-dialog-content").find("li:first-child").html(a.msg),$("#triggerDialog").trigger("tap")),b.removeClass("done")}})}),$("#province_id").on("change",function(){var a=$(this).val(),b=$(this).data("url"),c=[];$.ajax({url:b,type:"get",data:{province_id:a},dataType:"jsonp",success:function(a){a.success&&($.each(a.data,function(a,b){c.push('<option value="'+b.id+'">'+b.name+"</option>")}),$("#city_id").html(c.join()))}})}),$("#setting-form").on("submit",function(a){a.preventDefault();var c=$('input[name="nickname"]').val(),d=$('input[name="email"]').val(),e=$('input[name="qq"]').val(),f=$('input[name="sex"]:checked').val(),g=$('select[name="province_id"]').val(),h=$('select[name="city_id"]').val(),i=$('input[name="address"]').val(),j="/user/center/editPost";$.ajax({url:j,type:"post",data:{nickname:c,email:d,qq:e,province_id:g,city_id:h,sex:f,address:i,token:token},dataType:"json",success:function(a){a.success&&a.data.redirect?location.href=a.data.redirect:b(a.msg)},error:function(){b("网络请求失败！")}})}),$("#J_logout").on(h,function(a){window.UCenterJSInterface&&window.UCenterJSInterface.clearUser()}),$("#js-picture-list .ui-item .inner").on(h,function(b){a("个人中心-看图列表点击次数","个人中心-看图列表点击次数");var c=$(this),d=$("#js-picture-list").data("earn"),e=c.data("id"),f=c.data("type"),g=c.data("cat");c.hasClass("done")||$.ajax({url:d,type:"get",data:{goods_id:e,score_type:f,cat_id:g},dataType:"json",success:function(b){b.success&&(b.msg?(a("个人中心-看图列表点击成功次数","个人中心-看图列表点击成功次数"),c.addClass("done"),c.append('<span class="ui-picture-mask">已领取<span>'),b.data.redirect&&(location.href=b.data.redirect)):b.data.redirect&&(location.href=b.data.redirect))}})}),$("#award-addr-btn").on(h,function(){var a=$(this),b=$("#addr_name"),c=$("#addr_addr"),d=$("#addr_tel"),e=$("#province_id"),f=$("#city_id"),g=a.data("url");b.val()&&c.val()&&d.val()&&0!=e.val()&&0!=f.val()?$.ajax({url:g,type:"post",data:{token:token,receiver_name:b.val(),address:c.val(),mobile:d.val(),province_id:e.val(),city_id:f.val()},dataType:"json",success:function(a){a.success&&a.data.redirect?location.href=a.data.redirect:$("#award-addr-tips").html(a.msg).show()}}):$("#award-addr-tips").html("请填写完整有效信息，才可提交").show()}),window.gt_custom_ajax=function(a,b,f){if(a){var g={challenge:b(".geetest_challenge").value,validate:b(".geetest_validate").value,seccode:b(".geetest_seccode").value};$("#award-tel")[0]?e(a,g):$("#award-qq")[0]?c(a,g):d(a,g)}},$("#award-detail-page .ui-actionsheet-cancel").on("tap",function(){f()}),g(),$.scrollPage=$.extend({},{config:{pageData:{},dataLoding:!1,doneLoadData:!1,canStartLoadData:!1,pageNo:1,pageItem:10,currentPageItem:30,time:null,speed:10},init:function(a){var b=$.scrollPage;return $.extend(b.config,a),b},showLoading:function(){if($("#page-order")[0]){var a=$(".ui-button.js-active").data("index");$("#page1-tab"+a+" .ui-loading").html("正在努力加载中...")}else $(".ui-loading").html("正在努力加载中...")},closeLoading:function(){if($("#page-order")[0]){var a=$(".ui-button.js-active").data("index");$("#page1-tab"+a+" .ui-loading").html("上拉加载")}else $(".ui-loading").html("上拉加载")},doneLoading:function(){if($("#page-order")[0]){var a=$(".ui-button.js-active").data("index");$("#page1-tab"+a+" .ui-loading").remove()}else $(".ui-loading").remove()},loadData:function(a){var b=$.scrollPage,c=(b.config,b.isPageBottom());return c&&(b.showLoading(),b._startLoad(b._endLoad)),b},_startLoad:function(a){var b=$.scrollPage,c=b.config;c.dataLoding=!0;b.getNext();a&&a()},getNext:function(){},_endLoad:function(){var a=$.scrollPage,b=a.config;return b.dataLoding=!1,b.canStartLoadData=!1,setTimeout(function(){a.closeLoading()},2e3),a},isPageBottom:function(a){var b=0,c=0,d=0;return a=a||0,b=document.documentElement.scrollTop||document.body.scrollTop,c=document.documentElement.clientHeight||window.clientHeight,d=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),b+c+a>=d?!0:!1}}),$(window).on("scroll",function(){$("#page-order")[0]&&($.scrollPage.getNext=function(){var a=$.scrollPage,b=$(".ui-button.js-active"),c=b.data("index"),d=b.data("pindex")||2,e=[],f=b.data("url");b.data("loaded")||$.ajax({url:f,type:"get",dataType:"json",data:{token:token,page:d},success:function(f){f.success&&(f.data.hasNext===!1&&(b.attr("data-loaded","true"),a.doneLoading()),d++,b.attr("data-pindex",d),$.each(f.data.list,function(a,b){e.push("<li><span>"+b.score_type+"</span><span>"+b.affected_score+"</span><span>"+b.add_time+"</span></li>")}),$("#page1-tab"+c+" ul").append(e.join("")))}})}),$("#page-msg")[0]&&($.scrollPage.getNext=function(){var a=$.scrollPage,b=$("#js-msg-list"),c=b.data("url"),d=b.data("pindex")||2,e=[];b.data("loaded")||$.ajax({url:c,type:"get",dataType:"json",data:{page:d},success:function(c){c.success&&(d++,b.attr("data-pindex",d),c.data.hasNext===!1&&(b.attr("data-loaded","true"),a.doneLoading()),$.each(c.data.list,function(a,b){var c=1==b.status?'class="tips-success"':'class="tips-warning"';e.push('<li class="ui-item"><p '+c+">"+b.content+"</p><span>"+b.add_time+"</span></li>")}),b.append(e.join("")))}})}),$("#page-picture")[0]&&($.scrollPage.getNext=function(){var a=$.scrollPage,b=$("#js-picture-list"),c=b.data("url"),d=b.data("pindex")||2,e=[];b.data("loaded")||$.ajax({url:c,type:"get",dataType:"json",data:{token:token,page:d},success:function(c){c.success&&(d++,b.attr("data-pindex",d),c.data.hasNext===!1&&(b.attr("data-loaded","true"),a.doneLoading()),$.each(c.data.list,function(a,b){e.push(1===b.get?'<li class="ui-item"><a class="link" href="'+b.link+'" data-id="'+b.id+'" data-type="'+c.data.score_type+'"><img src="'+c.data.attachPath+"/"+b.image+'" alt=""><span class="ui-picture-mask">已领取</span></a></li>':'<li class="ui-item"><span class="link" data-id="'+b.id+'" data-type="'+c.data.score_type+'"><img src="'+c.data.attachPath+"/"+b.image+'" alt=""></span></li>')}),b.append(e.join("")))}})}),$.scrollPage.loadData()}),$(".rank_desc div:nth-child(1)").on(h,function(a){$(".rank_desc div:nth-child(2)").hide(),$(this).find(".icon-dropdown").hasClass("icon-packup")?($(".rank_desc div:nth-child(1) .icon-dropdown").removeClass("icon-packup"),$(this).next().hide()):($(".rank_desc div:nth-child(1) .icon-dropdown").removeClass("icon-packup"),$(this).find(".icon-dropdown").addClass("icon-packup"),$(this).next().show())})});