/*! call 2015-07-09 */
require(["./pro","./ajax"],function(){function a(a){var b=/^dev.|demo.*/g;return b.test(location.host)===!0?"/3g/"+a+".php":a}function b(a){var b=a.el,d={callee:a.callee,type:a.type,token:token,name:a.name};$.ajax({url:a.url,type:"post",data:d,dataType:"json",success:function(d){function e(a){$(".ui-button-blue").text("呼叫中("+a+")"),a--,a>0?(tid=setTimeout(function(){e(a)},1e3),f++):0==a&&($(".ui-button-blue").text("呼叫中").addClass("none"),b.removeClass("none"),f=0,g=!1)}if(d.success){if(g=!0,1==a.type){{localSDK.tel(d.data.account)}b.removeClass("done")}if(2==a.type){var h=30;e(h),b.addClass("none").removeClass("done"),$(".ui-button-blue").removeClass("none")}}else{var i=$(".call-tips-error");c(i,d.msg)}}})}function c(a,b,c){a.removeClass("none").text(b),setTimeout(function(){a.addClass("none").text("")},c||3e3)}setTimeout(window.scrollTo(0,1),10);var d="touchstart"in window?"tap":"click";setTimeout(function(){location.href.indexOf("tel")>-1&&$("#js-call-calling").trigger(d)},1e3);var e="",f=0,g=!1;$(".button-panel li span").on(d,function(){var a=$(".call-input-text");a.hasClass("call-input-actived")||a.addClass("call-input-actived"),e+=$(this).text(),0==e.slice(0,1)&&e.length>11?e=e.substring(0,11)+$(this).text():e.length>10&&(e=e.substring(0,10)+$(this).text()),a.attr("data-code",1),a.val(e)}),$(".call-list").delegate(".ui-item,.call-sta",d,function(a){}),$(".call-input-btn").on(d,function(){var a=$(".call-input-text");e=a.val().slice(0,-1),a.val(e),0==e.length&&a.removeClass("call-input-actived")}),$(".call-input-btn").on("longTap",function(){e="",$(".call-input-text").removeClass("call-input-actived").val("").attr("placeholder","请输入或粘贴手机/座机号")}),$("#js-call-activeing").on(d,function(){var a=$(this),b=a.data("pid"),d=a.data("uid"),e=a.data("url");g||$.ajax({url:e,type:"post",data:{pid:b,uid:d,token:token},dataType:"json",success:function(b){if(b.success)b.data.redirect&&(a.addClass("none"),$(".ui-panel").html('<a class="ui-button ui-block ui-normal" href="'+b.data.redirect+'"><i class="icon-call-white"></i>免费电话</a>'));else{var d=$(".call-tips-error");c(d,b.msg)}}})}),$("#js-actionsheet-ok").on(d,function(){var a=$("#js-call-clear").data("url");a&&$.get(a,function(a){a.success&&($("#js-call-clear").remove(),$(".call-list li").not($('.call-list li[data-fixed="true"]')).remove(),$("#dialog-cancel").trigger("tap"))},"json")}),$("#js-actionsheet-cancel").on(d,function(){$("#dialog-cancel").trigger("tap")}),$("#js-call-calling").on(d,function(){var a=$(this),d=$(".call-input-text").val(),e=$("#js-input-cname").val(),g=$(this).data("url"),h=$(".call-input-tips");if(d==_CONFIG_.telphone)return void c(h,"不能拨打本机号码！");if(""==d)return void c(h,"请输入您要拨打的号码！");if(0==d.slice(0,1)){if(!/^0(10|[2]\d{1}|[3-9]\d{2})(\d{7,8})/.test(d))return void c(h,"座机号输入不正确！")}else if(!/^1[3|4|5|7|8][0-9]\d{8}$/.test(d))return void c(h,"手机号输入不正确！");return 0!==f?void c(h,"系统繁忙，请稍后！"):(a.hasClass("done")||a.addClass("done"),void("1"===_CONFIG_.isLogin?b(1==localSDK.support().code&&1==localSDK.network().code?{el:a,url:g,callee:d,name:e,type:2}:{el:a,url:g,callee:d,name:e,type:2}):login_url&&(location.href=login_url)))}),$("#link-wrap a").on(d,function(){var a=$(this).attr("href");$(this).attr("href","http://3g.gionee.com/tj/"+a)}),$("#js-radio-list .ui-radio ").on(d,function(){var a=$(this).find("input"),b=0;a.hasClass("checked")||(b=$("#js-radio-list .ui-radio input").index(a),$("#js-radio-list .ui-radio input").removeClass("checked"),a.addClass("checked"),$("#js-checkbox-list .ui-list-checkbox").addClass("none"),$("#js-checkbox-list .ui-list-checkbox").eq(b).removeClass("none"))}),$("#js-feed-submit").on(d,function(){var b=$("#js-radio-list .ui-radio input:checked").val(),c=$("#js-radio-list .ui-radio input").index(".checked"),d=$("#js-checkbox-list .ui-list-checkbox:nth-child("+(c+1)+") input:checked"),e=$(".ui-textarea").val(),f=$(".inp-tel").val(),g=[];$.each(d,function(a,b){g.push($(b).val())}),$.ajax({url:a("/feedback/ajaxPost"),type:"POST",dataType:"json",data:{react:e,contact:f,menu_id:b,checked_list:g.join(),token:token,ch:""},success:function(a){a.success?(alert(a.msg),"redirect"==a.data.type&&(location.href=a.data.url)):alert(a.msg)}})})});