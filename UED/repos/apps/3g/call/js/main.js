define(["./zepto","./ajax","./scrollfix","./dialog","./tab"],function(){var d=null;function a(f,e){_hmt=window._hmt||[];_hmt.push(["_trackEvent","gnnav-ucenter",f,e]);
}if($("#js-collect-tips")){d=setTimeout(function(){$("#js-collect-tips").hide();},10000);}$("#js-collect-tips i").on("click",function(){$.fn.cookie("stat-collect-tips",endTime,{expires:1});
clearTimeout(d);$("#js-collect-tips").hide();});if($(".pop-full-mask")[0]){if(window.localStorage&&window.localStorage.getItem("pop-full-ads")!=="on"){$(".pop-full-mask").height($(document).height()).removeClass("none");
$(".pop-full-wrap").removeClass("none");}}$("#js-btn-close,.pop-full-wrap a").on("click",function(){$(".pop-full-mask").hide();$(".pop-full-wrap").hide();
a("个人中心-用户首次进入提示框点击数","个人中心-用户首次进入提示框点击数");window.localStorage.setItem("pop-full-ads","on");});$("#award-page #js-actionsheet-ok").on("click",function(){$("#award-page .ui-actionsheet-cancel").trigger("tap");
});$(".ui-award-item .btn span").on("click",function(){a("个人中心-立即兑换点击次数","个人中心-立即兑换点击次数");var h=$(this),f=h.data("url"),e=h.data("type"),g=h.data("refurl");
if(!h.hasClass("done")){$.ajax({url:f,type:"get",data:{score_type:e,refurl:g},dataType:"json",success:function(i){if(i.success){if(i.data.redirect){location.href=i.data.redirect;
}}else{$(".js-dialog-content").find("li:first-child").html(i.msg);$("#triggerDialog").trigger("tap");}h.removeClass("done");}});}});$("#province_id").on("change",function(){var e=$(this).val(),f=$(this).data("url"),g=[];
$.ajax({url:f,type:"get",data:{province_id:e},dataType:"json",success:function(h){if(h.success){$.each(h.data,function(i,j){g.push('<option value="'+j.id+'">'+j.name+"</option>");
});$("#city_id").html(g.join());}}});});$("#setting-form").on("submit",function(i){i.preventDefault();var h=$('input[name="nickname"]').val(),l=$('input[name="email"]').val(),n=$('input[name="qq"]').val(),k=$('input[name="sex"]:checked').val(),g=$('select[name="province_id"]').val(),j=$('select[name="city_id"]').val(),m=$('input[name="address"]').val();
var f="/user/center/editPost";$.ajax({url:f,type:"post",data:{nickname:h,email:l,qq:n,province_id:g,city_id:j,sex:k,address:m,token:token},dataType:"json",success:function(e){if(e.success){if(e.data.redirect){location.href=e.data.redirect;
}}else{b(e.msg);}},error:function(){b("aaa");}});});function c(e,g,f){e.removeClass("none").text(g);setTimeout(function(){e.addClass("none").text("");},f||3000);
}function b(e){$(".toast-wrap").show();$(".toast-wrap p").html(e);setTimeout(function(){$(".toast-wrap").hide();$(".toast-wrap p").html("");},1000);}$("#js-picture-list").on("click","span",function(j){a("个人中心-看图列表点击次数","个人中心-看图列表点击次数");
var i=$(this),g=$("#js-picture-list").data("earn"),h=i.data("id"),f=i.data("type");if(!i.hasClass("done")){$.ajax({url:g,type:"get",data:{goods_id:h,score_type:f},dataType:"json",success:function(e){if(e.success){if(e.msg){a("个人中心-看图列表点击成功次数","个人中心-看图列表点击成功次数");
i.addClass("done");i.append('<span class="ui-picture-mask">已领取<span>');if(e.data.redirect){location.href=e.data.redirect;}}else{if(e.data.redirect){location.href=e.data.redirect;
}}}}});}});$("#js-award-btn").on("click",function(){var k=$(this),h=$("#award-tel"),e=h.val(),g=h.data("id"),i=k.data("refurl"),j=/\d{11}/g;var f=$("#js-award-btn").data("url");
if(!k.data("loaded")){if($("#award-tel")[0]){if(!j.test(h.val())){$("#js-error-tips").html("请输入有效的电话号码");return;}else{$("#js-error-tips").html("");}$.ajax({url:h.data("url"),type:"get",dataType:"json",data:{mobile:e,goods_id:g},success:function(p){if(p.success){$("#award-detail-page #ui-actionsheet-text").html("您确定为"+p.data.area+e+"冲值"+p.data.outprice+"元？");
$("#triggerDialog").trigger("tap");var o=false,l,m=+new Date,n=1;$("#award-detail-page #js-actionsheet-ok").on("click",function(){l=+new Date-m;if(n!=1){if(o===true||l<10000){++n;
m=+new Date;return;}}++n;var r=p.data.inprice,q=p.data.area;$.ajax({url:f,type:"post",dataType:"json",data:{token:token,refurl:i,number:e,goods_id:g,inprice:r},success:function(s){if(s.success){o=true;
a("个人中心-兑换奖品次数","个人中心-兑换话费成功次数");if(s.data.redirect){location.href=s.data.redirect;}k.attr("loaded",true);}else{$("#js-error-tips").html(s.msg);}}});});
}else{$("#js-error-tips").html(p.msg);}}});}else{if($("#award-qq")[0]){if(!/^\d{5,14}$/.test($("#award-qq").val())){$("#js-error-tips").html("请输入有效的QQ号码");
return;}else{$("#js-error-tips").html("");}$("#award-detail-page #ui-actionsheet-text").html("您确定为QQ号码为"+$("#award-qq").val()+"进行冲值？");$("#triggerDialog").trigger("tap");
$.ajax({url:f,type:"post",dataType:"json",data:{token:token,refurl:i,number:$("#award-qq").val(),goods_id:g},success:function(l){if(l.success){a("个人中心-兑换奖品次数","个人中心-兑换话费成功次数");
if(l.data.redirect){location.href=l.data.redirect;}}else{$("#js-error-tips").html(l.msg);}}});}else{$.ajax({url:f,type:"post",dataType:"json",data:{refurl:i,token:token},success:function(l){if(l.success){a("个人中心-兑换奖品次数","个人中心-兑换券成功次数");
if(l.data.redirect){location.href=l.data.redirect;}k.attr("loaded",true);}else{$("#js-error-tips").html(l.msg);}}});}}}});$.scrollPage=$.extend({},{config:{pageData:{},dataLoding:false,doneLoadData:false,canStartLoadData:false,pageNo:1,pageItem:10,currentPageItem:30,time:null,speed:10,},init:function(e){var f=$.scrollPage;
$.extend(f.config,e);return f;},showLoading:function(){if($("#page-order")[0]){var e=$(".ui-button.js-active").data("index");$("#page1-tab"+e+" .ui-loading").html("正在努力加载中...");
}else{$(".ui-loading").html("正在努力加载中...");}},closeLoading:function(){if($("#page-order")[0]){var e=$(".ui-button.js-active").data("index");$("#page1-tab"+e+" .ui-loading").html("上拉加载");
}else{$(".ui-loading").html("上拉加载");}},doneLoading:function(){if($("#page-order")[0]){var e=$(".ui-button.js-active").data("index");$("#page1-tab"+e+" .ui-loading").remove();
}else{$(".ui-loading").remove();}},loadData:function(g){var h=$.scrollPage;var e=h.config;var f=h.isPageBottom();if(f){h.showLoading();h._startLoad(h._endLoad);
}return h;},_startLoad:function(h){var g=$.scrollPage;var f=g.config;f.dataLoding=true;var e=g.getNext();if(h){h();}},getNext:function(){},_endLoad:function(){var f=$.scrollPage;
var e=f.config;e.dataLoding=false;e.canStartLoadData=false;setTimeout(function(){f.closeLoading();},2000);return f;},isPageBottom:function(f){var h=0;var e=0;
var g=0;f=f||0;h=document.documentElement.scrollTop||document.body.scrollTop;e=document.documentElement.clientHeight||window.clientHeight;g=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight);
if(h+e+f>=g){return true;}else{return false;}}});$(window).on("scroll",function(){if($("#page-order")[0]){$.scrollPage.getNext=function(){var j=$.scrollPage;
var e=$(".ui-button.js-active");var i=e.data("index");var g=e.data("pindex")||2;var h=[];var f=e.data("url");if(!e.data("loaded")){$.ajax({url:f,type:"get",dataType:"json",data:{token:token,page:g},success:function(k){if(k.success){if(k.data.hasNext===false){e.attr("data-loaded","true");
j.doneLoading();}g++;e.attr("data-pindex",g);$.each(k.data.list,function(l,m){h.push("<li><span>"+m.score_type+"</span><span>"+m.affected_score+"</span><span>"+m.add_time+"</span></li>");
});$("#page1-tab"+i+" ul").append(h.join(""));}}});}};}if($("#page-msg")[0]){$.scrollPage.getNext=function(){var i=$.scrollPage;var h=$("#js-msg-list"),f=h.data("url"),e=h.data("pindex")||2;
var g=[];if(!h.data("loaded")){$.ajax({url:f,type:"get",dataType:"json",data:{page:e},success:function(j){if(j.success){e++;h.attr("data-pindex",e);if(j.data.hasNext===false){h.attr("data-loaded","true");
i.doneLoading();}$.each(j.data.list,function(k,m){var l=m.status==1?'class="tips-success"':'class="tips-warning"';g.push('<li class="ui-item"><p '+l+">"+m.content+"</p><span>"+m.add_time+"</span></li>");
});h.append(g.join(""));}}});}};}if($("#page-picture")[0]){$.scrollPage.getNext=function(){var i=$.scrollPage;var h=$("#js-picture-list"),f=h.data("url"),e=h.data("pindex")||2;
var g=[];if(!h.data("loaded")){$.ajax({url:f,type:"get",dataType:"json",data:{token:token,page:e},success:function(j){if(j.success){e++;h.attr("data-pindex",e);
if(j.data.hasNext===false){h.attr("data-loaded","true");i.doneLoading();}$.each(j.data.list,function(k,l){if(l.get===1){g.push('<li class="ui-item"><a class="link" href="'+l.link+'" data-id="'+l.id+'" data-type="'+j.data.score_type+'"><img src="'+j.data.attachPath+"/"+l.image+'" alt=""><span class="ui-picture-mask">已领取</span></a></li>');
}else{g.push('<li class="ui-item"><span class="link" data-id="'+l.id+'" data-type="'+j.data.score_type+'"><img src="'+j.data.attachPath+"/"+l.image+'" alt=""></span></li>');
}});h.append(g.join(""));}}});}};}$.scrollPage.loadData();});});