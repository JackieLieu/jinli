(function(c){var h=window._hmt?window._hmt:[];c.PathConfig();var e=c.namespace("GNapp");e.models={};e.collections={};e.views={};e.routers={};e.hasTouch="ontouchstart" in window;
e.TAP_EV=e.hasTouch?"click":"click";e.START_EV=e.hasTouch?"touchstart":"mousedown";e.MOVE_EV=e.hasTouch?"touchmove":"mousemove";e.END_EV=e.hasTouch?"touchend":"mouseup";
e.CANCEL_EV=e.hasTouch?"touchcancel":"mouseup";var b=navigator.userAgent;e.browser={isAndroid:/android/ig.test(b),isGioneemb:/gionee/ig.test(b),isIos:/iphone|ipad/ig.test(b)};
var i={pageDataApi:"/3g/api/v1_firstcachejs.php",loadMoreApi:"/3g/api/v1_recommend_more.php",cateListApi:"/3g/api/v1_recommend_more.php",reportStatsApi:"/3g/api/v1_report_stats.php",searchApi:"/3g/api/v1_search.php",getHotWordsApi:"/3g/api/v1_hotwords.php",topicListApi:"/3g/api/v1_themelist.php",topicDetailListApi:"/3g/api/v1_themeapps.php"};
var d={pageDataApi:"/webapp/book",loadMoreApi:"/webapp/more",cateListApi:"/webapp/typelist",reportStatsApi:"/webapp/stats",searchApi:"/webapp/search",getHotWordsApi:"/webapp/keywords",topicListApi:"/webapp/themelist",topicDetailListApi:"/webapp/themeapps",};
var g={pageDataApi:"/webapp/book",loadMoreApi:"/webapp/more",cateListApi:"/webapp/typelist",reportStatsApi:"/webapp/stats",searchApi:"/webapp/search",getHotWordsApi:"/webapp/keywords",topicListApi:"/webapp/themelist",topicDetailListApi:"/webapp/themeapps",};
var j,f,a=location.protocol+"//"+location.host;if(location.host.indexOf("3g.gionee.com")>-1||location.host.indexOf("sige.gionee.com")>-1){f="http://assets.gionee.com";
j=g;}else{if(location.host.indexOf("3gtest.gionee.com")>-1){f="http://assets.3gtest.gionee.com";j=d;}else{f="http://18.8.10.194:8899";j=i;}}c.include(["lib/zepto/zepto.js","lib/underscore/underscore.js","lib/backbone/backbone.js","./slide.js","lib/zepto/touchSwipe.js"],function(){e.slider=function(){$("#J_full_slider3").slidePic({slideWrap:".ui-slider-wrap",slidePanel:".ui-slider-pic",slideItem:".ui-slider-pic li",handlePanel:".ui-slider-handle",handleItem:"#J_full_slider3 .ui-slider-handle > span",circle:true,auto:true});
};$(".index-top-bookmark").on("click",function(){h.push(["_trackEvent","轻应用Webapp","调用浏览器接口次数","接口-书签页添加次数"]);if(e.browser.isAndroid){var o=window.prompt("gn://GNNavSiteData/frombookmark","");
}});$(".app-banner-box a").live("click",function(o){var q=$(this),p=q.attr("href"),r=q.attr("data-appId");o.preventDefault();$.ajax({url:a+j.reportStatsApi,type:"get",data:{columnName:"ad",to_href:p,appId:r,action:"open-ad"},timeout:1000,success:function(){window.location.href=p;
},error:function(){window.location.href=p;}});});$.extend($.fn,{hover:function(o){var q=$(this),o=o||"hover";var p;function r(){e.hasActive=true;if($(e.touchTarget).parents("li.item").hasClass("list-loading")){$(e.touchTarget).parents("li.list-loading").addClass("app-more-hover");
}else{$(e.touchTarget).parents("li.item").addClass(o);}}q.on(e.START_EV,function(s){e.touchTarget=s.target;p=setTimeout(r,50);});q.on(e.END_EV+" "+e.CANCEL_EV,function(){if(p){clearTimeout(p);
}if(e.hasActive){setTimeout(function(){$(e.touchTarget).removeClass(o);if($(e.touchTarget).parents("li.item").hasClass("list-loading")){$(e.touchTarget).parents("li.list-loading").removeClass("app-more-hover");
}else{$(e.touchTarget).parents("li.item").removeClass(o);}e.hasActive=false;},100);}});},addTouchEffect:function(o){var q=this,o=o||"active";var p;function r(){e.hasActive=true;
q.addClass(o);}this.on(e.START_EV,function(s){p=setTimeout(r,50);});this.on(e.END_EV+" "+e.CANCEL_EV,function(){if(p){clearTimeout(p);}if(e.hasActive){setTimeout(function(){q.removeClass(o);
e.hasActive=false;},100);}});}});$("#index-search-words, #index-search-btn").addTouchEffect("active");$(".index-top-bookmark").addTouchEffect("active");
$(".back").addTouchEffect("active");$(".app-banner-box a").addTouchEffect("active");$(".btn-search").addTouchEffect("active");$("#app-search-page .input-search-btn").addTouchEffect("active");
var m=$(".J_app_list");var n={recommend:"t1",rank:"t2",category:"t3",news:"t4"};var k={recommend:"推荐页－精品推荐",must:"推荐－必备名站",rank:"排行",category:"分类",news:"新品",cate:"分类页－分类详情",search:"搜索页－搜索结果",usercomm:"搜索页－相关推荐",topics:"专题页－专题列表",theme:"专题页－专题详情",};
Backbone.imgLoad=function(){if($(".lazyload").size()>0){_.each($(".lazyload"),function(q,p){var o=new Image();var r=$(q).attr("data-src");o.src=r;o.onload=function(){setTimeout(function(){$(q).attr("src",r);
$(q).removeAttr("data-src");},100);};});}};$.ajax({url:j.pageDataApi,type:"get",dataType:"json",timeout:2000,beforeSend:function(){$("#loading").removeClass("none");
},success:function(o){$("#loading").addClass("none");window.localStorage.setItem("gnapp_v1_firstPageData",JSON.stringify(o));window.pageInitData=o;gnappRoute=new e.routers.app();
Backbone.history.start();},error:function(q,p,o){$("#loading").addClass("none");if(e.browser.isAndroid){window.prompt("gn://GNNavSiteData/tips","网络出错！");
}window.pageInitData=JSON.parse(window.localStorage.getItem("gnapp_v1_firstPageData"));gnappRoute=new e.routers.app();Backbone.history.start();}});$.ajax({url:j.getHotWordsApi,type:"get",dataType:"json",timeout:2000,success:function(o){window.localStorage.setItem("gnapp_v1_getHotWords",JSON.stringify(o));
}});e.models.app=Backbone.Model.extend({});var l=new e.models.app();e.collections.app=Backbone.Collection.extend({model:e.models.app,url:j.pageDataApi});
e.routers.app=Backbone.Router.extend({routes:{"":"index","~loop:svt=index/tab/:name":"showIndex","~loop:svt=cdetail/id/:id":"showDetail","~loop:svt=topicList":"showTopicList","~loop:svt=topic/id/:id":"showTopic","~loop:svt=search":"showSearch","~loop:svt=result":"showResult"},initialize:function(o){var p=this;
if(e.browser.isAndroid){this.on("route",function(r,q,s){document.title="轻应用市场";});}else{document.title="网页应用";}},index:function(){this.showIndex();},showTopic:function(o,q){var p=new topicView({id:q});
p.render();},showTopicList:function(o){var p=new topicListView();p.render();},showSearch:function(){window.searchView.render();},showResult:function(){var o=new resultView();
o.render();},showIndex:function(o,r){var r=r||"recommend";var t={recommend:"t1",rank:"t2",category:"t3",news:"t4"};var q=new IndexView();var v=new e.views.header({menu:r});
var s=this;v.render(r);var u=new e.collections.app({data:pageInitData.data[t[r]]});$(".J_app_list","#index").html("");if(r=="recommend"){$("#index").show();
$("#app-banner").show();$("#app-banner .app-banner-box").html(new e.views.appList({model:u,name:"ads"}).render()._slide);e.slider();var p=$(".J_app_list","#index");
p.append('<h3 class="index-must-title">必备名站</h3>');p.append(new e.views.appList({model:u,name:"must"}).render().el);p.append('<h3 class="index-recommmend-title">精品推荐</h3>');
p.append(new e.views.appList({model:u,name:"recommend"}).render().el);$(".J_app_list","#index").hover("app-item-hover");}else{$("#app-banner").hide();$(".J_app_list","#index").html(new e.views.appList({model:u,name:r,groupId:t[r]}).render().el);
$(".J_app_list","#index").hover("app-item-hover");}Backbone.imgLoad();},showDetail:function(o,q){var p=new CdetailView({id:q});p.render();}});window.IndexView=Backbone.View.extend({initialize:function(){$(".page-tile").addClass("none");
$("#index").removeClass("none");$("#index-search-words, #index-search-btn").on("click",function(){gnappRoute.navigate("#~loop:svt=search",true);});}});
window.SearchView=Backbone.View.extend({locked:false,el:$("#app-search-page"),events:{"click .input-search-btn":"showSearch",},render:function(){var w=this;
$(".page-tile").addClass("none");$("#app-search-page").removeClass("none");var v=JSON.parse(window.localStorage.getItem("gnapp_v1_getHotWords"));if(v){var x=v.data["default"];
var z=v.data.hotwords;var y=x[Math.round(Math.random()*(x.length-1))];$("#app-search-page .input-search").val(y);$("#app-search-page .input-search").on("focus",function(){if($(this).val()==y){$(this).val("");
}});var A="",u=[],o=[1,2,3,4];if(z.length<6){for(var t=0,p=z.length;t<p;t++){var r=Math.round(Math.random()*3);A=A+'<li><a class="hots-bg'+o[r]+'">'+z[t]+"</a></li>";
}$(".app-search-hots").html("<ul>"+A+"</ul>");}else{for(var s=0;s<6;s++){var r=Math.round(Math.random()*3);var q=Math.round(Math.random()*(z.length-1));
u.push('<li><a class="hots-bg'+o[r]+'">'+z[q]+"</a></li>");z.splice(q,1);}$(".app-search-hots").html("<ul>"+u.join("")+"</ul>");}}$(".app-search-hots a").on("click",function(){$("#app-search-page .input-search").val($(this).text());
w.showSearch("search-hots-link");});$("#form-search").on("submit",function(B){B.preventDefault();w.showSearch();});},showSearch:function(){var p=this;var q=new e.collections.app();
var r=JSON.parse(window.localStorage.getItem("gnapp_v1_getHotWords"));if(this.locked==false){var o=$("#app-search-page .input-search").val();if(o==""){$("#pSearchTip").removeClass("none");
$("#pSearchNoData").addClass("none");$("#pSearch1Words").addClass("none");return;}if(o.length<2){$("#pSearch1Words").removeClass("none");$("#pSearchTip").addClass("none");
$("#pSearchNoData").addClass("none");return;}if(arguments[0]=="search-hots-link"){h.push(["_trackEvent","轻应用Webapp","搜索页－搜索总量","搜索页-关键词链接搜索"]);}else{if(o==r.data["default"]){h.push(["_trackEvent","轻应用Webapp","搜索页－搜索总量","搜索页-搜索框默认搜索"]);
}else{h.push(["_trackEvent","轻应用Webapp","搜索页－搜索总量","搜索页-搜索框主动搜索"]);}}this.locked=true;window.localStorage.setItem("gnapp_v1_searchKey",'"'+o+'"');$("#app-search-page .input-search").addClass("active");
q.fetch({url:j.searchApi,data:{like:o},dataType:"json",beforeSend:function(){$("#app-search-page .input-search").val(o+" 搜索中...");},success:function(t){p.locked=false;
var s=t.models[0].get("data");if(s.total>0){$(".app-search-tips").addClass("none");$("#app-search-page .input-search").val("");window.localStorage.setItem("gnapp_v1_searchResult",JSON.stringify(t.models[0].attributes));
gnappRoute.navigate("#~loop:svt=result",true);}else{$("#app-search-page .input-search").val(o);$("#pSearchNoData").removeClass("none");$("#pSearchTip").addClass("none");
$("#pSearch1Words").addClass("none");p.locked=false;}$("#pSearchTip").addClass("none");$("#pSearch1Words").addClass("none");$("#app-search-page .input-search").removeClass("active");
},error:function(){$("#app-search-page .input-search").val("");$("#app-search-page .input-search").removeClass("active");p.locked=false;}});}return this;
}});window.searchView=new window.SearchView();window.resultView=Backbone.View.extend({initialize:function(){$(".page-tile").addClass("none");$("#app-result-page").removeClass("none");
$("#app-search-page .input-search").val("");},render:function(){var p=this;var q=JSON.parse(window.localStorage.getItem("gnapp_v1_searchResult"));var r=window.localStorage.getItem("gnapp_v1_searchKey").slice(1,-1);
var o=$(".J_app_list","#app-result-page");var s=new e.collections.app(q);o.html("");o.append('<h3 class="index-recommmend-title">'+r+" <span>搜索到"+q.data.total+"个结果</span></h3>");
o.append(new e.views.appList({model:s,name:"search",like:r}).render().el);if(q.data.usercomm){o.append('<h3 class="index-recommmend-title">相关推荐</h3>');
o.append(new e.views.appList({model:s,name:"usercomm"}).render().el);}o.hover("app-item-hover");Backbone.imgLoad();}});window.CdetailView=Backbone.View.extend({initialize:function(){},render:function(){$(".page-tile").addClass("none");
$("#app-cdetail-page").removeClass("none");var p=this;var o=$("#cate-id-"+this.options.id).text();var q=new e.collections.app();q.fetch({url:j.cateListApi,data:{type_id:this.options.id,page:1},beforeSend:function(){},success:function(){$(".J_app_list","#app-cdetail-page").html(new e.views.appList({model:q,name:"cate",typeId:p.options.id,cateName:o}).render().el);
$(".J_app_list","#app-cdetail-page").hover("app-item-hover");Backbone.imgLoad();},error:function(){}});}});window.topicView=Backbone.View.extend({render:function(){$(".page-tile").addClass("none");
$("#app-topic-page").removeClass("none");var o=this;var p=new e.collections.app();p.fetch({url:j.topicDetailListApi,data:{type:"theme",type_id:this.options.id,page:1},beforeSend:function(){},success:function(){$(".J_app_list","#app-topic-page").html(new e.views.appList({model:p,name:"theme",typeId:o.options.id}).render().el);
$(".J_app_list","#app-topic-page").hover("app-item-hover");Backbone.imgLoad();},error:function(){}});}});window.topicListView=Backbone.View.extend({render:function(){$(".page-tile").addClass("none");
$("#app-topic-list").removeClass("none");var o=this;var p=new e.collections.app();p.fetch({url:j.topicListApi,success:function(){$(".J_app_list","#app-topic-list").html(new e.views.appList({model:p,name:"topics"}).render().el);
$(".J_app_list","#app-topic-list").hover("app-item-hover");Backbone.imgLoad();}});}});e.views.header=Backbone.View.extend({el:$(".app-menu-box"),template:_.template($("#J_tabMenuView").html()),events:{},initialize:function(){this.$el.delegate(".in-tabs li",e.TAP_EV,this.swichTab);
},render:function(o){$(".app-menu-box").html(this.template());this.selectMenuItem(o);},selectMenuItem:function(p){$("#app-tabs li").removeClass("actived");
var o=this.options.menu!=undefined?this.options.menu:"recommend";console.log("start send",1);$.ajax({url:j.reportStatsApi,type:"get",data:{columnName:o},success:function(q){console.log("SEND SUCC");
}});if(p){$("#app-tabs li[data-target="+p+"]").addClass("actived");}},swichTab:function(o){var p=$(this).attr("data-link");gnappRoute.navigate(p,true);
}});e.views.backNav=Backbone.View.extend({el:$(".module").eq(0),template:_.template($("#J_backNavView").html()),initialize:function(){this.render();},render:function(){$(this.el).html(this.template({cateName:""}));
this.hideTabMenu();return this;},hideTabMenu:function(){$("#app-tabs").remove();},hideAppList:function(){$(".app-list").remove();}});e.views.appList=Backbone.View.extend({tagName:"ul",events:{"click .list-more":"showAppMore"},initialize:function(){this.events[e.TAP_EV+" .add-btn"]="addAppIcon";
this.events["click .item-cont"]="openAppLink";this.listenTo(this.model,"reset",this.changeList);},_cateName:null,changeList:function(){this.render();Backbone.imgLoad();
},render:function(){var r=[],q=[],p=0;var o=this.options.name;var s=this.model.models;if(this.options.name=="category"){this.$el.addClass("app-cate");}else{if(e.browser.isAndroid){r=this.getLocalData()||[];
}}_.each(s,function(v,t){if(this.options.name=="cate"||this.options.name=="theme"){this._cateName=this.options.cateName||v.get("data")["cateName"];if(this.options.name=="cate"){$("#app-cdetail-page .J_backNavTitle").text(this._cateName);
}if(this.options.name=="theme"){$("#app-topic-page .J_backNavTitle").text(this._cateName);$("#app-topic-box").html('<div class="app-topic-banner"><img class="lazyload" src="'+f+'/apps/3g/app/v1/assets/img/blank.gif" data-src="'+v.get("data")["cateImg"]+'"/></div>');
}console.log("start send",1);$.ajax({url:j.reportStatsApi,type:"get",data:{cloumnName:"cateList",cateId:this.options.typeId,cateName:this._cateName},success:function(){console.log("SEND SUCC");
}});q=v.get("data")[o];}else{if(this.options.name=="search"){q=v.get("data")[this.options.name];}else{if(this.options.name=="topics"){this._cateName=this.options.cateName||v.get("data")["cateName"];
$("#app-topic-list .J_backNavTitle").text(this._cateName);q=v.get("data")["theme"];}else{if(this.options.name=="ads"){q=v.get("data")["ads"];if(v.get("data")["ads"]&&v.get("data")["ads"].length>0){var u=v.get("data")["ads"];
_.each(u,function(x,w){x.no_img=f+"/apps/3g/app/v1/assets/img/no-img.png";});this._slide=_.template($("#J_slideView").html(),v.get("data"));}return this;
}else{q=v.get("data")[o];}}}}_.each(q,function(x,w){x.no_img=f+"/apps/3g/app/v1/assets/img/no-img.png";if(this.options.name!="category"){if(e.browser.isAndroid){x.status=r.indexOf(x.id)>-1?1:0;
}else{x.status=200;}}if(this.options.name!="news"){x.is_new=0;}this.$el.append(new e.views.appItem({model:v,name:this.options.name,index:w}).render().el);
},this);if(this.options.name!="must"&&this.options.name!="ads"&&this.options.name!="category"&&this.options.name!="topics"&&this.options.name!="usercomm"){$(".list-more").remove();
if(v.get("data").hasnext===true){this.$el.append('<li class="item list-loading list-more"><span class="line"></span><span class="txt">点击加载更多</span></li>');
}else{if(v.get("data").hasnext===false){this.$el.append('<li class="list-loading list-had"><span class="line"></span><span class="txt">已显示全部</span></li>');
}}}},this);if(this.options.name=="category"&&this.model.models[0].get("data")[this.options.name].length%2!=0){this.$el.append('<li class="white-space"></li>');
}return this;},getLocalData:function(){try{localData=JSON.parse(window.prompt("gn://GNNavSiteData/select",""));}catch(o){localData=0;console.log("GNapp.views.appList:getLocalData get interface data error.");
}return localData.data;},addAppIcon:function(p){var s=$(p.target),q=s.attr("data-addUrl"),r=s.attr("data-appId"),o=s.attr("data-appName");if(this.options.name=="cate"){$.ajax({url:j.reportStatsApi,type:"get",data:{cloumnName:"cateList",appId:r,cateId:this.options.typeId,cateName:this._cateName,action:"add"},success:function(){}});
}else{$.ajax({url:j.reportStatsApi,type:"get",data:{columnName:this.options.name,appId:r,action:"add"},success:function(){}});}h.push(["_trackEvent","轻应用Webapp","ADDICON"+k[this.options.name],"APPICON-"+o]);
var t=window.prompt("gn://GNNavSiteData/insert",q);if(JSON.parse(t).result=="0"){h.push(["_trackEvent","轻应用Webapp","调用浏览器接口次数","接口-ICON成功添加次数"]);window.prompt("gn://GNNavSiteData/tips","添加成功");
s.removeClass("add-btn").addClass("had-btn lock");setTimeout(function(){s.removeClass("lock");},50);}else{h.push(["_trackEvent","轻应用Webapp","调用浏览器接口次数","接口-ICON失败添加次数"]);
console.log("GNapp.views.appList:addAppIcon get interface data error.");}},openAppLink:function(p){p.preventDefault();var r=this;if(e.browser.isAndroid&&this.options.name!="topics"){target=$(p.target).parents("li").find(".button .btn");
}else{target=$(p.target).parents("li").find(".button .open-arrow");}var q=target.attr("data-link");var t=target.attr("data-appId");var o=target.attr("data-appName");
var s;h.push(["_trackEvent","轻应用Webapp","OPENICON"+k[this.options.name],"APPICON-"+o]);if(this.options.name=="cate"){s={cloumnName:"cateList",to_href:q,cateId:this.options.typeId,appId:t,cateName:this._cateName,action:"open-url"};
}else{s={cloumnName:this.options.name,appId:t,to_href:q,action:"open-url"};}$.ajax({url:j.reportStatsApi,type:"get",data:s,timeout:1000,success:function(){window.location.href=q;
},error:function(){window.location.href=q;}});},_locked:false,showAppMore:function(o){if(this._locked===false){var q=this;var r=$(o.target);var p=this.model.models[0];
var s=(p.get("data").page||1)+1;if(r.hasClass("locked")||r.parent().hasClass("locked")){return;}if(p.get("data").hasnext==false){this.$el.find(".list-more").remove();
}this.loadStatus();h.push(["_trackEvent","轻应用Webapp","LOADICON"+k[this.options.name],"点击加载更多"]);if(q.options.name=="cate"||q.options.name=="theme"){q.model.fetch({url:a+j.loadMoreApi,data:{type:q.options.name,type_id:q.options.typeId,page:s}});
}else{if(q.options.name=="search"){q.model.fetch({url:a+j.loadMoreApi,data:{type:q.options.name,like:this.options.like,page:s}});}else{q.model.fetch({url:a+j.loadMoreApi,data:{type:q.options.name,page:s}});
}}}},loadStatus:function(){this.$el.find(".list-more").addClass("locked");this.$el.find(".list-more").html('<span class="line"></span><span class="txt">正在加载数据...</span>');
return this;}});e.views.appItem=Backbone.View.extend({tagName:"li",template:_.template($("#J_itemView").html()),initialize:function(){this.model.bind("change",this.render,this);
this.model.bind("destroy",this.close,this);},render:function(){if(this.options.name=="category"){this.$el.append(_.template($("#J_appCateView").html(),this.model.get("data")[this.options.name][this.options.index]));
}else{if(this.options.name=="cate"){this.$el.addClass("item");this.$el.append(this.template(this.model.get("data")[this.options.name][this.options.index]));
}else{if(this.options.name=="search"){this.$el.addClass("item");this.$el.append(this.template(this.model.get("data")[this.options.name][this.options.index]));
}else{if(this.options.name=="topics"){this.$el.addClass("item");this.$el.append(_.template($("#J_topicView").html(),this.model.get("data")["theme"][this.options.index]));
}else{this.$el.addClass("item");this.$el.append(this.template(this.model.get("data")[this.options.name][this.options.index]));}}}}return this;},close:function(){this.$el.unbind();
this.$el.remove();},});},true,true);})(ICAT);