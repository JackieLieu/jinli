/*! navi 2015-07-01 */
$(function(){function a(){var a=new Date,b=([a.getMonth()+1,a.getDate()],window.localStorage.getItem("nav_ads_flag")&&window.localStorage.getItem("nav_ads_flag").split(",")||[0,0],""!=$("#nowtime").val()?$("#nowtime").val():[a.getFullYear(),a.getMonth()+1<10?"0"+(a.getMonth()+1):a.getMonth()+1,a.getDate()].join(""));$("#J_nav_top_ads .close").on("click",function(){k.push(["_trackEvent","GNnavi数据","顶部Banner广告关闭","导航Banner广告-关闭"]),j.cookie.set("navTopAds",b);$(this);$("#J_nav_top_ads").animate({"margin-top":"-60px"},300,"linear",function(){})})}function b(){if(window.localStorage&&window.localStorage.getItem("navi_baidu_hotwords")){var a=new Date,b=window.localStorage.getItem("navi_start_time")||0;if(a.getTime()-b>18e5)c();else{$(".baidu-hot-words").html("");var e=window.localStorage.getItem("navi_baidu_hotwords");d(JSON.parse(e))}}else c()}function c(){var a=$("#api-nav-hotwords").val();a&&$.ajax({url:a,type:"get",dataType:"jsonp",success:function(a){var b=a.data;b?(window.localStorage.setItem("navi_start_time",(new Date).getTime()),window.localStorage.setItem("navi_baidu_hotwords",JSON.stringify(b)),d(b)):$(".hot-words-box").hide()}})}function d(a){var b=a[hotWordIndex],c="",d="",e="",f=a[hotWordIndex+1],g=(a[a.length-1],"");if(hotWordIndex<a.length-1)if(b.text.length+f.text.length<=18)hotWordIndex+=2,g=1==window.initIndex?" ":' class="anima-fade"',c=b.url?b.url:"http://m.baidu.com/s?from=1670b&word="+encodeURIComponent(b.text),d=f.url?f.url:"http://m.baidu.com/s?from=1670b&word="+encodeURIComponent(f.text),$(".baidu-hot-words").html("<span"+g+"><a onclick=\"_hmt.push(['_trackEvent','GNnav数据','导航搜索-百度热词','导航百度热词搜索'])\" href=\""+c+'">'+b.text+"</a></span><span"+g+"><a onclick=\"_hmt.push(['_trackEvent','GNnav数据','导航搜索-百度热词','导航百度热词搜索'])\" href=\""+d+'">'+f.text+"</a></span>");else{var h,i=Math.max(b.text.length,f.text.length);g=1==window.initIndex?' class="center" ':' class="anima-fade center"',b.text.length==i?(hotWordIndex+=1,h=b):(hotWordIndex+=2,h=f),e=h.url?h.url:"http://m.baidu.com/s?from=1670b&word="+encodeURIComponent(h.text),$(".baidu-hot-words").html("<span"+g+"><a onclick=\"_hmt.push(['_trackEvent','GNnav数据','导航搜索-百度热词','导航百度热词搜索'])\"  href=\""+e+'">'+h.text+"</a></span>")}else hotWordIndex=0;window.initIndex++}function e(a,b){var c=[];otmpl={img1:"tmpl_img1",img2:"tmpl_img2",img3:"tmpl_img3",words3:"tmpl_words3",words5:"tmpl_words5",link:"tmpl_news_list",hotlink:"tmpl_ads_link",like:"tmpl_like",bread:"tmpl_bread",news:"tmpl_cup_news",video:"tmpl_cup_video",schedule:"tmpl_cup_notice",footer:"tmpl_cup_links"};for(var d=document.createDocumentFragment(),e=0,f=b.data.length;f>e;e++)if(b.data[e].t_bi=window.t_bi?window.t_bi:"",0!=b.data[e].list){var g=template.render(otmpl[b.data[e].tpl],b.data[e]);c.push(g)}d.innerHTML=c.join(""),$("#"+a).html(d.innerHTML),c=null}function f(){var a=o.get()||[],b=[];b.push("<p>");for(var c=1,d=a.length;d>=c;c++)b.push('<span><a class="aText" src="'+a[c-1].aHref+'" appId="'+a[c-1].appId+'">'+a[c-1].aText+"</a></span>"),c%4==0&&(b.push("</p>"),c!=a.length&&b.push("<p>"));$("#cinner60").html(b.join(""))}function g(){$(".tab-nav a").live("click",function(){$(".tab-nav a").removeClass("active"),$(".tab-con").addClass("none"),$(this).addClass("active"),$(".tab-con").eq($(this).index()).removeClass("none")})}function h(a){var b=$(".form-input");$(".form-button").on("click",function(c){a||b.attr("defaultValue");k.push(""==b.val()?["_trackEvent","GNnavi数据","导航搜索框点击","导航默认关键字搜索"]:["_trackEvent","GNnavi数据","导航搜索框点击","导航主动关键字搜索"])})}function i(a){$.ajax({url:a.url,type:"post",data:{option_num:a.optionId,topic_id:a.topicId,token:token},dataType:"json",success:function(a){if(a.success){var a=a.data.list;console.log(a),$(".opposite > p > span").each(function(b,c){$(c).css({width:a[b].percent})}),$(".opposite .people_num").each(function(b,c){$(c).text(a[b].val+"人")}),$(".opposite .words").each(function(b,c){$(c).text(a[b].txt)}),$(".opposite").show()}},error:function(a,b,c){$(".topic-vote-two").removeClass("topic-vote-done"),alert("网络连接失败，请检查网络，稍后再试"),console.log(b+"----"+c)}})}$.extend($.fn,{hover:function(a){var b=$(this),a=a||"hover";b.each(function(b,c){$(c).on("touchstart",function(){var b=setTimeout(function(){$(c).addClass(a)},50);$(document).one("touchmove touchend",function(){clearTimeout(b),$(c).removeClass(a)})})})}});var j={},k=window._hmt?window._hmt:[];window.hotWordIndex=0,window.initIndex=1,j.cookie={get:function(a){var b,c=document.cookie,d=c.indexOf(encodeURIComponent(a)+"=");return-1!=d?(d=d+encodeURIComponent(a).length+1,b=c.indexOf(";",d),-1==b&&(b=c.length),decodeURIComponent(c.substring(d,b))):""},set:function(a,b,c,d,e,f){var g=encodeURIComponent(a),h=encodeURIComponent(b),c=new Date;c.setTime(c.getTime()+7776e7),document.cookie=g+"="+h+"; expires="+c}},window.hasTouch="touchstart"in window;var l=window.hasTouch?"tap":"click";a(),b(),h(),$("#J_convert").live("click",function(){if(window.localStorage&&window.localStorage.getItem("navi_baidu_hotwords")){var a=window.localStorage.getItem("navi_baidu_hotwords");d(JSON.parse(a))}});var m=$(".nav-drapdown-title"),n="nav-drapdown-arrow-up";$(".nav-drapdown-title").on(l,function(){var a=$(this),b=a.attr("data-wrap");m.next().hide(),m.css({background:"#fff"}),a.hasClass(n)?(m.removeClass(n),a.removeClass(n)):("cinner100"==a.attr("data-wrap")&&a.css({background:"#fae013"}),k.push(["_trackEvent","GNnavi数据","一级栏目展开次数",a.find("h2").text()]),a.next().show(),m.removeClass(n),"index-hist"!==a.parent().attr("id")&&e(b,typeData[b]),a.addClass(n))});var o={storage:{},isinit:0,maxnum:8,key:"app",_init:function(){return 1===o.isinit?!0:0===o.isinit&&window.localStorage?(o.isinit=1,o.storage=window.localStorage,!0):!1},get:function(){if(o._init()){var a=o.storage.getItem(o.key);return JSON.parse(a)}return!1},set:function(a){if(o._init()){var b=o.storage.getItem(o.key),c=o.storage.getItem(o.key+"Ids");return b=JSON.parse(b),c=JSON.parse(c),console.log("appIds"),null===b&&(b=[]),null===c&&(c=[]),c.indexOf(a.appId)>-1&&(b.splice(c.indexOf(a.appId),1),c.splice(c.indexOf(a.appId),1)),b.length===o.maxnum&&(b.pop(),c.pop()),c.unshift(a.appId),b.unshift(a),b=JSON.stringify(b),c=JSON.stringify(c),o.storage.setItem(o.key,b),o.storage.setItem(o.key+"Ids",c),!0}return!1}};o.get()?$("#index-hist").show():$("#index-hist").hide(),$(".aText").live("click",function(){var a=$(this).attr("appTxt")?$(this).attr("appTxt").substr(0,4):$(this).text().substr(0,4),b=$(this).attr("appId"),c=$(this).attr("src"),d={aText:a,appId:b,aHref:c};o.set(d),f(),location.href=c}),f(),g(),$(".btn-love").on("click",function(){var a=$(this),b=$(".btn-love .num").text(),c=$("#loveUrl").val();a.hasClass("anim-done")||(a.addClass("anim-btn-love"),c&&$.getJSON(c,function(a){a.success&&$(".btn-love .num").text(+b+1)}))}),$(".btn-love").on("webkitAnimationEnd",function(){$(this).addClass("anim-done btn-love-open"),$(this).removeClass("anim-btn-love active")}),$(".tools-panel span").on("click",function(){var a=$(this).attr("data-box");$(this).hasClass("active")?($(this).removeClass("active"),$("."+a).addClass("none")):($(".topic-box").addClass("none"),$(".tools-panel span").removeClass("active"),$(this).addClass("active"),$("."+a).removeClass("none"))}),$('input[type="radio"]').on("click",function(){var a=$('input[type="radio"]:checked').val(),b=$('input[type="radio"]').last().val();a==b?($(".sel-other").show(),$(".sel-default").hide()):($(".sel-other").hide(),$(".sel-default").show())}),$("#btn-commit1,#btn-commit2").on("click",function(){var a=$(this).attr("id"),b=$('input[type="radio"]:checked').val(),c=$("textarea").val(),d=$('input[name="contact"]').val(),e=$("#topicId").val(),f=$("#feedUrl").val(),g="";g="btn-commit1"===a?{token:token,option_num:b,topic_id:e}:{token:token,option_num:b,answer:c,contact:d,topic_id:e},f&&$.ajax({url:f,type:"POST",data:g,dataType:"json",success:function(a){a.success&&($(".topic-feed").html("感谢您的参与！"),setTimeout(function(){$(".topic-feed").addClass("none done"),$(".btn-feed").removeClass("active")},500))}})}),$(".topic-vote .ui-radio input").on("click",function(){$(this).attr("checked")===!0&&100!=$(this).val()&&$(".btn-vote").addClass("btn-active"),1==$(this).attr("checked")&&100==$(this).val()?($(".topic-vote .ui-textarea textarea").val().length>0?$(".btn-vote").addClass("btn-active"):$(".btn-vote").removeClass("btn-active"),$("#js-textarea-wrap").show()):$("#js-textarea-wrap").hide()}),$(".topic-vote .ui-textarea textarea").on("keyup",function(){$(this).val().length>0?$(".btn-vote").hasClass("btn-active")||$(".btn-vote").addClass("btn-active"):$(".btn-vote").removeClass("btn-active")}),$(".btn-vote").on("click",function(){var a=$(this).data("url");$(".ui-textarea textarea").val()||"";$.ajax({url:a,type:"post",data:{answer:$(".ui-textarea textarea").val(),topic_id:$("#topicId").val(),option_num:$(".ui-radio input:checked").val(),token:token},dataType:"json",beforeSend:function(){$(".topic-vsuccess").addClass("topic-vsuccess-ease")},success:function(a){$(".vote-result li").each(function(b,c){a.data.checked==$(c).find("input").val()&&$(c).find("input").attr("checked","checked"),$(c).find("span").eq(0).css({width:a.data.list[b].percent}),$(c).find("span").eq(1).html(a.data.list[b].val+"人")}),$(".topic-vote").addClass("none"),$(".vote-result").removeClass("none"),$(".topic-vsuccess").removeClass("topic-vsuccess-ease")}})}),$(".topic-vote-two p").on(l,function(){var a,b,c,d=$(this);$(".topic-vote-two").hasClass("topic-vote-done")||d.data("index")&&(b=$("#topicId").val(),a=d.data("index"),c=$(".topic-vote-two .txt").data("url"),d.children(".plusOne").addClass("ani"),$(".topic-vote-two .main p").off(),setTimeout(function(){$(".topic-vote-two").addClass("topic-vote-done"),d.children("i").addClass("like-selected"),i({url:c,optionId:a,topicId:b})},500))})});