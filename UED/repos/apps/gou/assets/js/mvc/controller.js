(function(a){var b=GOU.platform;GOU.Controller=a.Controller.extend({config:{View:GOU.View,Model:GOU.Model},routes:{home:function(){this.fnInit("home",function(e,c,d){if(e==="activityTheme"){a.foreach(d.nav,function(f,g){f.selected=g===0})}})},cod:function(){this.fnInit("cod",function(e,c,d){if(e==="activityTheme"){a.foreach(d.nav,function(f,g){f.selected=g===1})}if(e==="list"){a.mix(c,{tmplId:"codList",ajaxUrl:GOU.fullurl("/api/@cod/index"),__base_ajaxurl:GOU.fullurl("/api/@cod/index")})}})},bargain:function(){this.fnInit("bargain",function(e,c,d){if(e==="activityTheme"){a.foreach(d.nav,function(f,g){f.selected=g===2})}if(e==="list"){a.mix(c,{tmplId:"tejiaList",ajaxUrl:GOU.fullurl("/api/@tejia/tejia"),__base_ajaxurl:GOU.fullurl("/api/@tejia/tejia")})}})},"new":function(){this.fnInit("new",function(e,c,d){if(e==="subheader"){a.mix(d,{subtitle:"新品女装",homeurl:GOU.fullurl("/index")})}if(e==="list"){a.mix(c,{tmplId:"picList",ajaxUrl:GOU.fullurl("/api/new/index"),__base_ajaxurl:GOU.fullurl("/api/new/index")})}})},mall:function(){this.fnInit("mall",function(g,d,f){if(g==="subheader"){a.mix(f,{subtitle:"手机配件",homeurl:GOU.fullurl("/index")})}if(g==="subnav"){d.ajaxUrl=GOU.fullurl("/api/fitting/type");d.events={"@click|1|0 .J_subnav li a":function(n,k,h){var l=n.getAttribute("data-ajaxurl"),j=a.View.list,i=j.config;$(n.parentNode).addClass("selected").siblings().removeClass("selected");$("wraplist").empty();h.storage("typeIndex",l);delete i.__hasnext;i.mustdo=true;i.firePulling=function(){delete i.mustdo;delete i.firePulling};j.setAjaxUrl(l)}}}if(g==="list"){var c=a.Model[d.modelId],e=(c.storage("typeIndex")||"/api/fitting/goods").replace(/\s+/g,"");a.mix(d,{tmplId:"picList",ajaxUrl:GOU.fullurl(e),__base_ajaxurl:GOU.fullurl(e)})}})},activities:function(){this.fnInit("activities",function(e,c,d){if(e==="subheader"){a.mix(d,{subtitle:"热门活动",homeurl:GOU.fullurl("/index")})}if(e==="subnav"){a.foreach(d.nav,function(f,g){f.selected=g===1})}if(e==="list"){a.mix(c,{mustdo:true,tmplId:"activityList",ajaxUrl:GOU.fullurl("/api/amigo_index/activity_list"),__base_ajaxurl:GOU.fullurl("/api/amigo_index/activity_list")})}})},goods:function(){this.fnInit("goods",function(e,c,d){if(e==="subheader"){a.mix(d,{subtitle:"热门活动",homeurl:GOU.fullurl("/index")})}if(e==="subnav"){a.foreach(d.nav,function(f,g){f.selected=g===0})}if(e==="list"){a.mix(c,{tmplId:"goodsList",ajaxUrl:GOU.fullurl("/api/amigo_index/goods_list"),__base_ajaxurl:GOU.fullurl("/api/amigo_index/goods_list")})}})},brand:function(){this.fnInit("brand",function(h,c,g){var e=$(".module"),d=e.attr("data-ajaxurl"),f=e.attr("data-cate_id")||0;e=null;if(h==="subheader"){a.mix(g,{subtitle:"品牌汇",homeurl:GOU.fullurl("/index")})}if(h==="brandBanner"){a.util.removeData("brand:brandBanner");a.mix(g,{cate_id:f,detail_url:"/brand/detail"});a.mix(c,{tmplId:"brandBanner",ajaxUrl:GOU.fullurl(d,true),__base_ajaxurl:GOU.fullurl(d,true)});setTimeout(function(){var i=$("#iHeader").find(".J_subnav");i.find('li[cate-id="'+f+'"]').addClass("selected").siblings().removeClass("selected")},500)}if(h==="list"){a.util.removeData("brand:list");a.mix(g,{cate_id:f,detail_url:"/brand/detail"});a.mix(c,{tmplId:"brandList",ajaxUrl:GOU.fullurl(d,true),__base_ajaxurl:GOU.fullurl(d,true),renderCompleted:function(){var i=$("#brand");if(i[0]){i.on("touchstart, touchmove, mousedown, mousemove",".brand-list .mask",function(){var j=$(this);j.addClass("active");setTimeout(function(){j.removeClass("active")},500)}).on("touchend, mouseup",function(){$(this).removeClass("active")})}}})}})},brandDetail:function(){this.fnInit("brandDetail",function(i,d,h){var f=$(".module"),c=f.attr("data-desc-ajaxurl"),e=f.attr("data-goods-ajaxurl"),g=f.attr("data-cate_id");f=null;if(i==="brandsubheader"){a.util.removeData("brandDetail:brandsubheader");a.mix(d,{ajaxUrl:GOU.fullurl(c),__base_ajaxurl:GOU.fullurl(c)});a.mix(h,{cate_id:g,return_url:"/brand/index"})}if(i==="branddesc"){a.util.removeData("brandDetail:branddesc");a.mix(d,{ajaxUrl:GOU.fullurl(c),__base_ajaxurl:GOU.fullurl(c),callback:function(k,j,l){if(a.isObject(l.data)){$("title").empty().html(l.data.title)}}})}if(i==="list"){a.util.removeData("brandDetail:list");a.mix(d,{ajaxConfig:{timeout:15000},tmplId:"brandGoodsList",ajaxUrl:GOU.fullurl(e),__base_ajaxurl:GOU.fullurl(e)})}})},goodshop:function(){this.fnInit("goodshop",function(e,p,i){var f,n,o;f=$("#goodshop");o=f.attr("data-uid");n=f.attr("data-ajaxurl");if(e==="subheader"){a.mix(i,{subtitle:"淘宝好店",homeurl:GOU.fullurl("/index")})}if(e==="slideTab"){var g;p.events={"@click|0|0 #J_slideTab li":function(t,A,w){var B=$(t),v=B.attr("data-tag-id"),u=B.attr("data-tag-name"),z=a.View.list,y=z.config,s;$(".J_slideWrap").attr("style","");GOU.addBaiduStatic("GOODSHOP_TAB",B.text());B.addClass("active").siblings().removeClass("active");$("wraplist").empty();delete y.__hasnext;y.mustdo=true;y.firePulling=function(){delete y.mustdo;delete y.firePulling};var x={tagId:v,tagName:u,scrollLeft:B.parent().scrollLeft()};a.util.storage("goodshop:tagInfo",JSON.stringify(x));s=n+(n.indexOf("?")>-1?"&":"?")+"tag_id="+v;y.__base_ajaxurl=s;z.setAjaxUrl(s)},"@scroll|0|0 #J_slideTab":function(w,u,t){if(!g){var x=$("#J_slideTab"),s=$("#J_slideRight"),v=x[0].scrollWidth;g=setTimeout(function(){(x.outerWidth()+x.scrollLeft()>=v)?s.hide():s.show();g=null},300)}},"@click|1|0 #J_slideRight":function(w,u,t){var x=$("#J_slideTab"),s=$("#J_slideRight"),v=x[0].scrollWidth;size=x.find("li").length,step=x[0].scrollWidth/size;if(x.outerWidth()+x.scrollLeft()<=(v-step)){x.scrollLeft(x.scrollLeft()+step)}}}}if(e==="list"){a.util.removeData("goodshop:list");var k="";var q="";var m=0;var h=a.util.storage("goodshop:tagInfo");if(h!=null){h=JSON.parse(h);k=h.tagId||"";q=h.tagName||"";m=h.scrollLeft||0}var d="/api/@favorite/addshop",c="/api/@favorite/remove";var j=$("#J_slideTab");var l=$("#J_slideRight");var r=j.find('li[data-tag-id="'+k+'"]');if(!r.length){k="";r=j.find('li[data-tag-id=""]')}r.parent().scrollLeft(m);r.addClass("active").siblings().removeClass("active");p.events.push({"click|0|0 #goodshop .J_aside":function(w,t,s){var y,x,u,z;y=$(w).find(".ico-collect");if(y.length===0){return}x=y.attr("data-shopid");if(y.hasClass("dis")){return}if(!y.hasClass("on")){u=GOU.fullurl(d);z={uid:o,item_id:x}}else{var v=y.attr("fav-id");u=GOU.fullurl(c);z={id:v,item_id:x,type:3,uid:o}}$.ajax({url:u,type:"POST",data:z,beforeSend:function(){y.addClass("dis")},complete:function(){y.removeClass("dis")},success:function(A){if(A.success=="true"||A.success==true){if(y.hasClass("on")){y.removeAttr("fav-id").removeClass("on");GOU.showtip("取消收藏")}else{y.attr("fav-id",A.data.id).addClass("on");GOU.showtip("收藏成功")}}else{GOU.showtip("操作失败，请重试")}}})}});a.mix(p,{ajaxConfig:{timeout:15000},tmplId:"goodshopList",ajaxUrl:GOU.fullurl(n+"&tag_id="+k),__base_ajaxurl:GOU.fullurl(n+"&tag_id="+k)})}})},tempt:function(){this.fnInit("tempt",function(e,c,d){if(e==="subheader"){a.mix(d,{subtitle:"淘宝热门",homeurl:GOU.fullurl("/index")})}if(e==="scrollList"){a.mix(c,{tmplId:"temptList",mustdo:true,ajaxUrl:GOU.fullurl("/api/amigo_index/activity_long"),__base_ajaxurl:GOU.fullurl("/api/amigo_index/activity_long")})}})}},fnInit:function(e,d){var c=b[e];c.baseBed=b.baseBed;this.init(c,d)}})})(ICAT);