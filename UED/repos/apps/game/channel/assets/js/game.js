(function(a,b){a.app("Gapk",function(){a.PathConfig();function c(h,g){if(!h||h.indexOf(",")==-1){return;}var f=h.split(","),e=f.length;if(navigator.gamehall){e==2?navigator.gamehall.startlistactivity(function(){},function(){},{title:f[0],url:f[1]}):navigator.gamehall.startdetailsactivity(function(){},function(){},{title:f[0],url:f[1],gameid:f[2],downurl:f[3],packagename:f[4],filesize:f[5],sdkinfo:f[6],resolution:f[7]});}else{location.href=f[1];}}var d={openMore:function(){b(".wrap").delegate(".J_openBtnWrap","click",function(){b(this).toggleClass("open").siblings("p").toggleClass("hidden");});return this;},slidePic:function(){var e=b("#J_screenshot");if(!e[0]){return this;}a.include(["lib/jquery/touchSwipe.js","./plugin/slidePic.js"],function(){e.slidePic(e.hasClass("J_slidePic")?{circle:true,auto:true,isTouch:false,}:{slidePanel:".pic-wrap",slideItem:".pic-wrap span",specialWidth:true,});d.displayImg();},true);return this;},loadMore:function(){b("#page,#list-page").delegate(".J_loadMore","click",function(){var e=b(this),g=e.attr("data-hasnext");if(g==0||g=="false"){return false;}var f=parseInt(e.attr("data-curpage"));e.html('<img src="'+GameApk.loadingPic+'" />');b.post(e.attr("data-ajaxUrl"),{page:f+1,token:token},function(l){var j=b(".J_gameItem ul"),k="",i='<li>										<a data-infpage="{profile}">											<span class="icon"><img src="'+GameApk.blankPic+'" data-src="{img}"></span>											<span class="desc">												<em>{name}</em>												<p><em>大小：{size}</em></p>												<b>{resume}</b>											</span>										</a>									</li>',h=function(m,p,n){if(!a.isString(m)||!/\{|\}/g.test(m)){return false;}var o=m.match(/\{\w+\}/g);if(!o.length){return false;}a.foreach(o,function(){var q=this.replace(/\{|\}/g,""),s=new RegExp("{"+q+"}"),r=p[q];m=m.replace(s,r?r:(n?"{"+q+"}":""));});return m;};if(b(".J_categoryItem")[0]){j=b(".first-grade ul");i='<li>										<a data-infpage="{profile}">											<span class="pic"><img src="'+GameApk.blankPic+'" data-src="{img}"></span>										</a>									</li>';}else{if(b(".J_subjectItem")[0]){j=b(".first-grade ul");i='<li>										<a data-infpage="{profile}">											<span class="pic"><img src="'+GameApk.blankPic+'" data-src="{img}"></span>											<span class="desc">{title}</span>											<span class="mask"></span>										</a>									</li>';}}a.foreach(l.data.list,function(n,m){k+=h(i,m);});j.append(k);d.lazyLoad(document.body,100);if(l.data.hasnext==0||l.data.hasnext=="false"){e.hide();}e.attr("data-hasnext",l.data.hasnext).attr("data-curpage",l.data.curpage).html("<span>加载更多</span>");},"json");});return this;},openPage:function(e){b("body").delegate("a[data-infpage]","click",function(){var f=b(this).attr("data-infpage")||"";c(f);});},displayImg:function(){var f=b("#J_screenshot"),g=f.find("img");if(!f[0]){return this;}var e=[];g.each(function(h){e[h]=b(this).attr("data-bigpic");b(this).attr("data-index",h);});g.swipe({click:function(){var h=b(this).attr("data-index");var i=[];i=i.concat(h,e);if(navigator.gamehall){navigator.gamehall.startimagescanactivity(function(){a.log("正在为您跳转页面");},function(){},{url:i.join("|")});}}});},lazyLoad:function(f,e){var h=f.querySelectorAll('img[src$="blank.gif"]'),g=function(k){var j=k.getAttribute("data-src");a.__IMAGE_CACHE=a.__IMAGE_CACHE||{};if(!j){return;}if(!a.__IMAGE_CACHE[j]){var i=new Image();i.src=j;i.onload=function(){k.src=j;a.__IMAGE_CACHE[j]=true;i=null;};}else{k.src=j;}};a.foreach(h,function(k,j){e?setTimeout(function(){g(j);},k*e):g(j);});},};return{init:function(){d.slidePic();d.openMore().loadMore();d.openPage();d.lazyLoad(document.body,100);}};});})(ICAT,jQuery);