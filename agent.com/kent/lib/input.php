<?php function get($name){$result='';if(isset($_GET[$name]))$result=trim($_GET[$name]);return $result;}function post($name){$result='';if(isset($_POST[$name]))$result=trim($_POST[$name]);return $result;}function is_email($email){return preg_match('/^[a-zA-Z0-9_\.]+@[a-zA-Z0-9\-]+\.[a-zA-Z0-9\-\.]+$/i',$email);}function is_alpha($str){return preg_match('/^[a-zA-Z]+$/i',$str);}function is_alpha_num($str){return preg_match('/^[a-zA-Z0-9]+$/i',$str);}function is_alpha_num_line($str){return preg_match('/^[a-zA-Z0-9_]+$/i',$str);}function is_chinese($str){return preg_match("/^[\x{4e00}-\x{9fa5}]+$/u",$str);}function is_date($date){list($y,$m,$d)=preg_split('/[\/.-]/',$date);if(strlen($y)<4)$y='19'.$y;if(strlen($m)<2)$m='0'.$m;if(strlen($d)<2)$d='0'.$d;$date=$y.'-'.$m.'-'.$d;$unixdate=strtotime($date);$realdate=date('Y-m-d',$unixdate);if($date==$realdate)return true;else return false;}function is_idcard($idcard){$idlen=strlen($idcard);if($idlen!==15&&$idlen!==18)return 0;if($idlen==15){$birthday=get_birthday($idcard);if(!$birthday)return 0;else return substr($idcard,15,1)%2+1;}else{$idcard17=substr($idcard,0,17);$birthday=get_birthday($idcard);if(!$birthday){return 0;}else{$factor=array(7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2);$ckcode=array('0'=>1,'1'=>0,'2'=>'X','3'=>9,'4'=>8,'5'=>7,'6'=>6,'7'=>5,'8'=>4,'9'=>3,'10'=>2);$idsum=0;for($i=0;$i<$idlen-1;$i++){$idsum+=substr($idcard17,$i,1)*$factor[$i];}$lastid=$ckcode[$idsum%11];if(strtoupper($lastid)==strtoupper(substr($idcard,17,1))){return substr($idcard,16,1)%2+1;}else{return 0;}}}}function get_ip(){$ip='';if(getenv('HTTP_CLIENT_IP')&&strcasecmp(getenv('HTTP_CLIENT_IP'),'unknown')){$ip=getenv('HTTP_CLIENT_IP');}elseif(getenv('HTTP_X_FORWARDED_FOR')&&strcasecmp(getenv('HTTP_X_FORWARDED_FOR'),'unknown')){$ip=getenv('HTTP_X_FORWARDED_FOR');}elseif(getenv('REMOTE_ADDR')&&strcasecmp(getenv('REMOTE_ADDR'),'unknown')){$ip=getenv('REMOTE_ADDR');}elseif(isset($_SERVER['REMOTE_ADDR'])&&$_SERVER['REMOTE_ADDR']&&strcasecmp($_SERVER['REMOTE_ADDR'],'unknown')){$ip=$_SERVER['REMOTE_ADDR'];}return $ip;}function get_birthday($idcard){$result=false;$idlen=strlen($idcard);if($idlen==15){if(is_numeric($idcard)){$birthday=substr($idcard,6,6);$arrdate=str_split($birthday,2);$birthday=$arrdate[0].'-'.$arrdate[1].'-'.$arrdate[2];if(is_date($birthday))$result=$birthday;unset($idlen,$birthday,$arrdate);}}if($idlen==18){if(is_numeric(substr($idcard,0,17))){$birthday=substr($idcard,6,8);$arrdate=str_split($birthday,2);$birthday=$arrdate[0].$arrdate[1].'-'.$arrdate[2].'-'.$arrdate[3];if(is_date($birthday))$result=$birthday;unset($idlen,$birthday,$arrdate);}}return $result;}function slashes_add($data){if(is_array($data)){$data=array_map('slashes_add',$data);}else{if($data&&(!is_numeric($data))){$data=addslashes($data);}}return $data;}function slashes_strip($data){if(is_array($data)){$data=array_map('slashes_strip',$data);}else{if($data&&(!is_numeric($data))){$data=stripslashes($data);}}return $data;}function badword_exists($str){$result=true;$url=BADWORD_FILTER_URL.'/?check='.urlencode($str);$ch=curl_init();curl_setopt($ch,CURLOPT_URL,$url);curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);$str=curl_exec($ch);curl_close($ch);if(stripos($str,'FAIL')===false)$result=false;return $result;}function badword_strip($str){$url=BADWORD_FILTER_URL.'/?hexie='.urlencode($str);$ch=curl_init();curl_setopt($ch,CURLOPT_URL,$url);curl_setopt($ch,CURLOPT_RETURNTRANSFER,true);$result=curl_exec($ch);curl_close($ch);if($result&&(stripos(CHARSET,'GB')===false))$result=iconv('GB2312',CHARSET,$result);return $result;}?>