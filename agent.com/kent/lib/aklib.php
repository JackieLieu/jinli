<?php function akerr($num,$msg,$file,$line){header('Content-type:text/html;charset='.CHARSET);$msg=str_replace("\r\n",'',$msg);$msg=iconv('GB2312',CHARSET,$msg);if(strpos($msg,'|')===false){$msgnum=0;$msgstr=$msg;}else{$arrmsg=explode('|',$msg);$msgnum=$arrmsg[0];$msgstr=$arrmsg[1];}if(DEBUG){$file=str_replace(SROOT,'',$file);$file=str_replace('\\','/',$file);$msgstr.=('<br/>on line '.$line.' in '.$file);$html=file_get_contents(TEMPLATE_ERROR_DEV);$html=str_ireplace('{NUMBER}',$msgnum,$html);$html=str_ireplace('{MESSAGE}',$msgstr,$html);$html=str_ireplace('</body>','',$html);$html=str_ireplace('</html>','',$html);echo $html;debug();echo '</body></html>';}else{$msgstr=date('Y-m-d H:i:s')."\t".get_uri()."\t$msgstr\t on line $line in $file";file::write(SYS_LOG_FILE,$msgstr);$ini_error=$GLOBALS['ini_error'];if(key_exists($msgnum,$ini_error))$msgstr=$ini_error[$msgnum];if(empty($msgstr))$msgstr=$GLOBALS['$ini_error'][0];$html=file_get_contents(TEMPLATE_ERROR_UI);$html=str_ireplace('{NUMBER}',$msgnum,$html);$html=str_ireplace('{MESSAGE}',$msgstr,$html);echo $html;}exit();}function debug(){if(DEBUG){$execution=get_performance();echo '<div id="debug">';$included_files=get_included_files();if($included_files){echo '<h6>Included Files</h6>';echo '<ul>';$size=count($included_files);for($i=0;$i<$size;$i++){$file=$included_files[$i];if(strpos($file,'aklib.php')!==false)continue;$file=str_replace(SROOT,'',$file);$file=str_replace('\\','/',$file);echo '<li>'.$file.'</li>';}echo '</ul>';}$loaded_extensions=get_loaded_extensions();if($loaded_extensions){echo '<h6>Loaded Extensions</h6>';echo '<ul class="ext">';$size=count($loaded_extensions);for($i=0;$i<$size;$i++){echo '<li>'.$loaded_extensions[$i].'</li>';}echo '</ul>';}if($_GET){echo '<h6>GET List</h6>';echo '<table><tbody>';foreach($_GET as $k=>$v){echo '<tr><th>'.$k.'</th><td>';if(is_array($v))print_r($v);else echo $v;echo '</td></tr>';}echo '</tbody></table>';}if($_POST){echo '<h6>POST List</h6>';echo '<table><tbody>';foreach($_POST as $k=>$v){echo '<tr><th>'.$k.'</th><td>';if(is_array($v))print_r($v);else echo $v;echo '</td></tr>';}echo '</tbody></table>';}if($_COOKIE){echo '<h6>Cookie List</h6>';echo '<table><tbody>';foreach($_COOKIE as $k=>$v){echo '<tr><th>'.$k.'</th><td>';if(is_array($v))print_r($v);else echo $v;echo '</td></tr>';}echo '</tbody></table>';}if($_SESSION){echo '<h6>Session List</h6>';echo '<table><tbody>';foreach($_SESSION as $k=>$v){echo '<tr><th>'.$k.'</th><td>';if(is_array($v))print_r($v);else echo $v;echo '</td></tr>';}echo '</tbody></table>';}if($_SERVER){echo '<h6>Server Information</h6>';echo '<table><tbody>';foreach($_SERVER as $k=>$v){echo '<tr><th>'.$k.'</th><td>';if(is_array($v))print_r($v);else echo $v;echo '</td></tr>';}echo '</tbody></table>';}if($_ENV){echo '<h6>Environment Variable</h6>';echo '<table><tbody>';foreach($_ENV as $k=>$v){echo '<tr><th>'.$k.'</th><td>';if(is_array($v))print_r($v);else echo $v;echo '</td></tr>';}echo '</tbody></table>';}echo '<div>Page Execution Time:<span>'.$execution['usetime'].'</span>ms,Used Memory:<span>'.$execution['usememory'].'</span>MB</div>';echo '</div>';}}?>